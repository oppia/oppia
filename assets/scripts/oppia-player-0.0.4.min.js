(function(window,document){if(window.hasOwnProperty('OPPIA_EMBED_GLOBALS')){return}window.OPPIA_EMBED_GLOBALS={version:'0.0.3'};var _debug=function(message){if(console&&window.location.host.indexOf('localhost')===0){console.log(message)}};var _log=function(message){if(console){console.log(message)}};var SECRET_LENGTH=64;var secret='';for(var i=0;i<SECRET_LENGTH;i+=1){secret+=String.fromCharCode(65+Math.floor(Math.random()*26))}var OppiaEmbed=(function(){function OppiaEmbed(oppiaNode){if(oppiaNode.tagName!=='OPPIA'){throw('Error: expected OppiaEmbed to be defined using a node of type <oppia>, not '+oppiaNode.tagName)}this.contentHasLoaded=false;this.targetDomain=null;this.oppiaNode=oppiaNode;this.iframe=null}var LOADING_TIMEOUT_SECS=10000;var warningBoxStyle=('background-color: #ddd; border-radius: 5px; margin: 1px auto; max-width: 700px; padding: 30px; text-align: center');OppiaEmbed.prototype.init=function(){if(this.contentHasLoaded){_log('Error: tried to re-initialize Oppia node after its content was loaded.');return}if(this.iframe!==null){_log('Error: tried to initialize Oppia node, but the exploration iframe is already loaded.');return}var that=this;if(!this.oppiaNode.getAttribute('oppia-id')){var strongTag=document.createElement('strong');strongTag.textContent='Warning: ';var spanTag=document.createElement('span');spanTag.textContent=('This Oppia exploration could not be loaded because no oppia-id attribute was specified in the HTML tag.');var div=document.createElement('div');div.appendChild(strongTag);div.appendChild(spanTag);div.setAttribute('style',warningBoxStyle);this.oppiaNode.parentNode.replaceChild(div,this.oppiaNode);return}this.iframe=document.createElement('iframe');var currLoc=window.location.protocol+'//'+window.location.host;this.targetDomain=this.oppiaNode.getAttribute('src')||currLoc;var locale=this.oppiaNode.getAttribute('locale')||'en';var height=this.oppiaNode.getAttribute('height');var width=this.oppiaNode.getAttribute('width');var fixedHeight='false';var fixedWidth='false';var explorationVersion=(this.oppiaNode.getAttribute('exploration-version')||'');if(!height||height=='auto'){height='600px'}else{fixedHeight='true'}if(!width||width=='auto'){width='700px'}else{fixedWidth='true'}var VERSION_KEY='version=';var SECRET_KEY='secret=';var versionString=explorationVersion?'&v='+explorationVersion:'';this.iframe.src=encodeURI(this.targetDomain+'/embed/exploration/'+this.oppiaNode.getAttribute('oppia-id')+'?locale=en'+versionString+'#'+VERSION_KEY+OPPIA_EMBED_GLOBALS.version+'&'+SECRET_KEY+secret);var iframeAttrs={seamless:'seamless',height:height,width:width,fixedheight:fixedHeight,fixedwidth:fixedWidth,frameborder:0};for(var key in iframeAttrs){this.iframe.setAttribute(key,iframeAttrs[key])}this.oppiaNode.parentNode.replaceChild(this.iframe,this.oppiaNode);window.addEventListener('message',function(evt){if(evt.origin!==that.targetDomain){return false}if(evt.source!==that.iframe.contentWindow){return false}try{var data=JSON.parse(evt.data);_debug(data)}catch(error){return false}var iframeNode=that.iframe;switch(data.title){case 'explorationLoaded':that.explorationHasLoaded=true;window.OPPIA_PLAYER.onExplorationLoaded(iframeNode,data.payload.explorationTitle);break;case 'heightChange':window.OPPIA_PLAYER.onHeightChange(iframeNode,data.payload.height,data.payload.scroll);break;case 'answerSubmit':window.OPPIA_PLAYER.onAnswerSubmit(iframeNode,data.payload.stateName,data.payload.jsonAnswer);break;case 'stateTransition':window.OPPIA_PLAYER.onStateTransition(iframeNode,data.payload.oldStateName,data.payload.jsonAnswer,data.payload.newStateName);break;case 'explorationReset':iframeNode.style.height='auto';window.OPPIA_PLAYER.onExplorationReset(iframeNode,data.payload.stateName);break;case 'explorationCompleted':window.OPPIA_PLAYER.onExplorationCompleted(iframeNode);break;default:_log('Error: event '+data.title+' not recognized.')}},false)};return OppiaEmbed})();window.onload=function(){var oppiaElementsFromDOM=document.getElementsByTagName('oppia');var oppiaElements=[];for(var i=0;i<oppiaElementsFromDOM.length;i+=1){oppiaElements.push(oppiaElementsFromDOM[i])}for(var i=0;i<oppiaElements.length;i+=1){var oppiaElement=new OppiaEmbed(oppiaElements[i]);oppiaElement.init()}};window.OPPIA_PLAYER={onHeightChange:function(iframeNode,newHeight,doScroll){_debug('onHeightChange event triggered on '+iframeNode+' for '+newHeight);iframeNode.style.height='';if(iframeNode.getAttribute('fixedheight')==='false'){iframeNode.height=newHeight+'px'}if(doScroll){iframeNode.scrollIntoView(false)}window.OPPIA_PLAYER.onHeightChangePostHook(iframeNode,newHeight)},onExplorationLoaded:function(iframeNode,explorationTitle){setTimeout(function(){iframeNode.style.position='inherit';iframeNode.style.visibility='inherit';iframeNode.style.top='inherit'},0);window.OPPIA_PLAYER.onExplorationLoadedPostHook(iframeNode,explorationTitle)},onAnswerSubmit:function(iframeNode,stateName,jsonAnswer){window.OPPIA_PLAYER.onAnswerSubmitHook(iframeNode,stateName,jsonAnswer)},onStateTransition:function(iframeNode,oldStateName,jsonAnswer,newStateName){window.OPPIA_PLAYER.onStateTransitionPostHook(iframeNode,oldStateName,jsonAnswer,newStateName)},onExplorationReset:function(iframeNode,stateName){window.OPPIA_PLAYER.onExplorationResetPostHook(iframeNode,stateName)},onExplorationCompleted:function(iframeNode){window.OPPIA_PLAYER.onExplorationCompletedPostHook(iframeNode)}}}(window,document));window.OPPIA_PLAYER.onHeightChangePostHook=function(iframeNode,newHeight){};window.OPPIA_PLAYER.onExplorationLoadedPostHook=function(iframeNode,explorationTitle){};window.OPPIA_PLAYER.onAnswerSubmitHook=function(iframeNode,stateName,jsonAnswer){};window.OPPIA_PLAYER.onStateTransitionPostHook=function(iframeNode,oldStateName,jsonAnswer,newStateName){};window.OPPIA_PLAYER.onExplorationResetPostHook=function(iframeNode,stateName){};window.OPPIA_PLAYER.onExplorationCompletedPostHook=function(iframeNode){};
