<h2>v0.0.2 (minified)</h2>
<p>For instructions: see the README file in /assets/scripts.</p>
<p>
  NB: When you complete an exploration the text "Exploration completed" should
  appear in the paragraph below it. This checks that events are being sent from
  the Oppia iframe to the containing page.
</p>

<script src="/assets/scripts/oppia-player-0.0.2.min.js"></script>
<script src="/assets/scripts/embedding_tests.js"></script>

<div>
  <h3>Iframe embedding</h3>
  <iframe src="/embed/exploration/12" width="700" height="600">
  </iframe>
</div>

<div class="protractor-test-standard">
  <h3>Standard embedding of the latest version</h3>
  <oppia oppia-id="12"></oppia>
</div>

<div class="protractor-test-old-version">
  <h3>Standard embedding of version 2 of the exploration</h3>
  <oppia oppia-id="12" exploration-version="2"></oppia>
</div>

<div class="protractor-test-missing-id">
  <h3>ERROR: No oppia id specified</h3>
  <oppia></oppia>
</div>

<div class="protractor-test-invalid-id">
  <h3>ERROR: 404 error</h3>
  <oppia oppia-id="fake_id"></oppia>
</div>

<script type="text/javascript">
  // Get exploration id of newly created exploration in embedding.js and
  // replace old exploration id (12) with new one.
  (function (){
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {        
        var res = xhttp.responseText.slice(5);
        res = JSON.parse(res);
        var activity_list = res['activity_list'];
        if(activity_list.length === 0){
          console.error('No explorations found');
        }else if(activity_list.length > 1){
          console.error('More than 1 explorations found');
        }
        // Get exploration id.
        explorationId = activity_list[0]['id'];
        document.getElementsByTagName('iframe')[0].src = '/embed/exploration/' + explorationId;
        var elems = document.getElementsByTagName('oppia');
        for(var i = 0; i < elems.length; i++){
          if(elems[i].hasAttribute('oppia-id') && elems[i].getAttribute('oppia-id') === '12'){
            elems[i].setAttribute('oppia-id', explorationId);
          }
        }  
      }
    };
    xhttp.open("GET", "/searchhandler/data?q=Protractor Test", false);
    xhttp.send(null);
  })();
</script>
