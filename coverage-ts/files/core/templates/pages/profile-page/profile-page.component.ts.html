
  <!DOCTYPE html>
  <html>
    <head>
      <title>profile-page.component.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">core/templates/pages/profile-page/profile-page.component.ts</td><td class="">100.00%</td><td class="">100%</td><td class="">374</td><td class="">374</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">// Copyright 2014 The Oppia Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview Component for the Oppia profile page.
 */

import { Component } from &#x27;@angular/core&#x27;;
import { downgradeComponent } from &#x27;@angular/upgrade/static&#x27;;
import { RatingComputationService } from &#x27;components/ratings/rating-computation/rating-computation.service&#x27;;
import { LearnerExplorationSummary } from &#x27;domain/summary/learner-exploration-summary.model&#x27;;
import { UserProfile } from &#x27;domain/user/user-profile.model&#x27;;
import { UrlInterpolationService } from &#x27;domain/utilities/url-interpolation.service&#x27;;
import { LoggerService } from &#x27;services/contextual/logger.service&#x27;;
import { WindowRef } from &#x27;services/contextual/window-ref.service&#x27;;
import { DateTimeFormatService } from &#x27;services/date-time-format.service&#x27;;
import { LoaderService } from &#x27;services/loader.service&#x27;;
import { UserService } from &#x27;services/user.service&#x27;;
import { ProfilePageBackendApiService } from &#x27;./profile-page-backend-api.service&#x27;;

interface ViewedProfileUsername {
  title: string;
  value: string;
  helpText: string;
}

interface UserDisplayedStatistic {
  title: string;
  value: number;
  helpText: string | null;
}

@Component({
  selector: &#x27;oppia-profile-page&#x27;,
  templateUrl: &#x27;./profile-page.component.html&#x27;
})
export class ProfilePageComponent {
  DEFAULT_PROFILE_PICTURE_URL: string = &#x27;&#x27;;
  username: ViewedProfileUsername = {
    title: &#x27;&#x27;,
    value: &#x27;&#x27;,
    helpText: &#x27;&#x27;
  };
  usernameIsLong: boolean;
  userBio: string = &#x27;&#x27;;
  userDisplayedStatistics: UserDisplayedStatistic[] = [];
  userEditedExplorations: LearnerExplorationSummary[] = [];
  userNotLoggedIn: boolean;
  isAlreadySubscribed: boolean;
  isUserVisitingOwnProfile: boolean;
  subscriptionButtonPopoverText: string = &#x27;&#x27;;
  currentPageNumber: number = 0;
  PAGE_SIZE: number = 6;
  startingExplorationNumber: number = 1;
  endingExplorationNumber: number = 6;
  profileIsOfCurrentUser: boolean;
  data: UserProfile;
  numUserPortfolioExplorations: number;
  explorationsOnPage: LearnerExplorationSummary[] = [];
  explorationIndexEnd: number;
  explorationIndexStart: number;
  subjectInterests: string[] = [];
  profilePictureDataUrl: string = &#x27;&#x27;;
  firstContributionMsec: number;

  constructor(
    private dateTimeFormatService: DateTimeFormatService,
    private loaderService: LoaderService,
    private loggerService: LoggerService,
    private profilePageBackendApiService: ProfilePageBackendApiService,
    private ratingComputationService: RatingComputationService,
    private urlInterpolationService: UrlInterpolationService,
    private userService: UserService,
    private windowRef: WindowRef
  ) { }

  ngOnInit(): void {
    this.DEFAULT_PROFILE_PICTURE_URL = this.urlInterpolationService
      .getStaticImageUrl(&#x27;/general/no_profile_picture.png&#x27;);
    this.loaderService.showLoadingScreen(&#x27;Loading&#x27;);
    this.profilePageBackendApiService.fetchProfileDataAsync()
      .then((data) =&gt; {
        this.data = data;
        this.username = {
          title: &#x27;Username&#x27;,
          value: data.usernameOfViewedProfile,
          helpText: data.usernameOfViewedProfile
        };
        this.usernameIsLong = data.usernameOfViewedProfile.length &gt; 16;
        this.userBio = data.userBio;
        this.userDisplayedStatistics = [{
          title: &#x27;Impact&#x27;,
          value: data.userImpactScore,
          helpText: (
            &#x27;A rough measure of the impact of explorations created by &#x27; +
            &#x27;this user. Better ratings and more playthroughs improve &#x27; +
            &#x27;this score.&#x27;)
        }, {
          title: &#x27;Created&#x27;,
          value: data.createdExpSummaries.length,
          helpText: null
        }, {
          title: &#x27;Edited&#x27;,
          value: data.createdExpSummaries.length,
          helpText: null
        }];

        this.userEditedExplorations = data.editedExpSummaries.sort(
          (exploration1, exploration2) =&gt; {
            const avgRating1 = (
              this.ratingComputationService.computeAverageRating(
                exploration1.ratings));
            const avgRating2 = (
              this.ratingComputationService.computeAverageRating(
                exploration2.ratings));

            if (avgRating1 &gt; avgRating2) {
              return 1;
            } else if (avgRating1 === avgRating2) {
              if (exploration1.numViews &gt; exploration2.numViews) {
                return 1;
              } else if (
                exploration1.numViews === exploration2.numViews) {
                return 0;
              } else {
                return -1;
              }
            } else {
              return -1;
            }
          }
        );

        this.userNotLoggedIn = !data.username;
        this.isAlreadySubscribed = data.isAlreadySubscribed;
        this.isUserVisitingOwnProfile = data.isUserVisitingOwnProfile;

        this.subscriptionButtonPopoverText = &#x27;&#x27;;
        this.currentPageNumber = 0;
        this.PAGE_SIZE = 6;
        this.startingExplorationNumber = 1;
        this.endingExplorationNumber = 6;
        this.profileIsOfCurrentUser = data.profileIsOfCurrentUser;

        this.updateSubscriptionButtonPopoverText();
        this.numUserPortfolioExplorations = data.editedExpSummaries.length;
        this.subjectInterests = data.subjectInterests;
        this.firstContributionMsec = data.firstContributionMsec;
        this.profilePictureDataUrl = decodeURIComponent((
          data.profilePictureDataUrl || this.DEFAULT_PROFILE_PICTURE_URL));
        this.loaderService.hideLoadingScreen();
      });
  }

  changeSubscriptionStatus(): void {
    if (this.userNotLoggedIn) {
      this.userService.getLoginUrlAsync().then(
        (loginUrl) =&gt; {
          if (loginUrl) {
            this.windowRef.nativeWindow.location.href = loginUrl;
          } else {
            this.windowRef.nativeWindow.location.reload();
          }
        }
      );
    } else {
      if (!this.isAlreadySubscribed) {
        this.profilePageBackendApiService.subscribeAsync(
          this.data.usernameOfViewedProfile
        ).then(() =&gt; {
          this.isAlreadySubscribed = true;
          this.updateSubscriptionButtonPopoverText();
        });
      } else {
        this.profilePageBackendApiService.unsubscribeAsync(
          this.data.usernameOfViewedProfile
        ).then(() =&gt; {
          this.isAlreadySubscribed = false;
          this.updateSubscriptionButtonPopoverText();
        });
      }
    }
  }

  updateSubscriptionButtonPopoverText(): void {
    if (this.userNotLoggedIn) {
      this.subscriptionButtonPopoverText = (
        &#x27;Log in or sign up to subscribe to your &#x27; +
        &#x27;favorite creators.&#x27;);
    } else if (this.isAlreadySubscribed) {
      this.subscriptionButtonPopoverText = (
        &#x27;Unsubscribe to stop receiving email notifications &#x27; +
        &#x27;regarding new explorations published by &#x27; +
        this.username.value + &#x27;.&#x27;);
    } else {
      this.subscriptionButtonPopoverText = (
        &#x27;Receive email notifications, whenever &#x27; +
        this.username.value + &#x27; publishes a new exploration.&#x27;
      );
    }
  }

  goToPreviousPage(): void {
    if (this.currentPageNumber === 0) {
      this.loggerService.error(&#x27;Error: cannot decrement page&#x27;);
    } else {
      this.currentPageNumber--;
      this.startingExplorationNumber = (
        this.currentPageNumber * this.PAGE_SIZE + 1);
      this.endingExplorationNumber = (
        (this.currentPageNumber + 1) * this.PAGE_SIZE);
    }
  }

  goToNextPage(): void {
    let summariesLength = this.data.editedExpSummaries.length;
    if ((this.currentPageNumber + 1) * this.PAGE_SIZE &gt;= summariesLength) {
      this.loggerService.error(&#x27;Error: Cannot increment page&#x27;);
    } else {
      this.currentPageNumber++;
      this.startingExplorationNumber = (
        this.currentPageNumber * this.PAGE_SIZE + 1);
      this.endingExplorationNumber = Math.min(
        this.numUserPortfolioExplorations,
        (this.currentPageNumber + 1) * this.PAGE_SIZE);
    }
  }

  getExplorationsToDisplay(): Object[] {
    this.explorationsOnPage = [];
    if (this.userEditedExplorations.length === 0) {
      return this.explorationsOnPage;
    }
    this.explorationIndexStart = this.currentPageNumber * this.PAGE_SIZE;
    this.explorationIndexEnd = this.explorationIndexStart + this.PAGE_SIZE - 1;
    for (
      let ind = this.explorationIndexStart;
      ind &lt;= this.explorationIndexEnd;
      ind++
    ) {
      this.explorationsOnPage.push(this.userEditedExplorations[ind]);
      if (ind === this.userEditedExplorations.length - 1) {
        break;
      }
    }
    return this.explorationsOnPage;
  }

  getLocaleDateString(millisSinceEpoch: number): string {
    return this.dateTimeFormatService.getLocaleDateString(millisSinceEpoch);
  }
}

angular.module(&#x27;oppia&#x27;).directive(&#x27;oppiaProfilePage&#x27;,
  downgradeComponent({
    component: ProfilePageComponent
  }) as angular.IDirectiveFactory);
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 17 Jun 2021 20:43:58 GMT</p>
    </body>
  </html>
  