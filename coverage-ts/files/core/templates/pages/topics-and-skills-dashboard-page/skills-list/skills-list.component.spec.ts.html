
  <!DOCTYPE html>
  <html>
    <head>
      <title>skills-list.component.spec.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="negative"><td class="">core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.spec.ts</td><td class="">98.03%</td><td class="">100%</td><td class="">456</td><td class="">447</td><td class="">9</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">// Copyright 2020 The Oppia Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview Unit tests for the skills list component.
 */

import { EventEmitter } from &#x27;@angular/core&#x27;;
import { ComponentFixture, fakeAsync, TestBed, tick, waitForAsync } from &#x27;@angular/core/testing&#x27;;
import { FormsModule } from &#x27;@angular/forms&#x27;;
import { MatCardModule } from &#x27;@angular/material/card&#x27;;
import { MatCheckboxModule } from &#x27;@angular/material/checkbox&#x27;;
import { MatRadioModule } from &#x27;@angular/material/radio&#x27;;
import { NgbModal } from &#x27;@ng-bootstrap/ng-bootstrap&#x27;;
import { MergeSkillModalComponent } from &#x27;components/skill-selector/merge-skill-modal.component&#x27;;
import { SkillSelectorComponent } from &#x27;components/skill-selector/skill-selector.component&#x27;;
import { AugmentedSkillSummary, AugmentedSkillSummaryBackendDict } from &#x27;domain/skill/augmented-skill-summary.model&#x27;;
import { SkillBackendApiService } from &#x27;domain/skill/skill-backend-api.service&#x27;;
import { EditableTopicBackendApiService } from &#x27;domain/topic/editable-topic-backend-api.service&#x27;;
import { TopicSummary } from &#x27;domain/topic/topic-summary.model&#x27;;
import { TopicsAndSkillsDashboardBackendApiService } from &#x27;domain/topics_and_skills_dashboard/topics-and-skills-dashboard-backend-api.service&#x27;;
import { UrlInterpolationService } from &#x27;domain/utilities/url-interpolation.service&#x27;;
import { AlertsService } from &#x27;services/alerts.service&#x27;;
import { AssignSkillToTopicModalComponent } from &#x27;../modals/assign-skill-to-topic-modal.component&#x27;;
import { DeleteSkillModalComponent } from &#x27;../modals/delete-skill-modal.component&#x27;;
import { TopicAssignmentsSummary, UnassignSkillFromTopicsModalComponent } from &#x27;../modals/unassign-skill-from-topics-modal.component&#x27;;
import { SelectTopicsComponent } from &#x27;../topic-selector/select-topics.component&#x27;;
import { SkillsListComponent } from &#x27;./skills-list.component&#x27;;

describe(&#x27;Skills List Component&#x27;, () =&gt; {
  let fixture: ComponentFixture&lt;SkillsListComponent&gt;;
  let componentInstance: SkillsListComponent;
  let topicsAndSkillsDashboardBackendApiService:
    MockTopicsAndSkillsDashboardBackendApiService;
  let alertsService: AlertsService;
  let mockNgbModal: MockNgbModal;
  let mockSkillBackendApiService: MockSkillBackendApiService;
  let augmentedSkillSummaryBackendDict: AugmentedSkillSummaryBackendDict = {
    id: &#x27;test_id&#x27;,
    description: &#x27;description&#x27;,
    language_code: &#x27;sadf&#x27;,
    version: 10,
    misconception_count: 0,
    worked_examples_count: 1,
    skill_model_created_on: 2,
    skill_model_last_updated: 3,
    topic_names: [&#x27;a&#x27;],
    classroom_names: [&#x27;a&#x27;]
  };
  let topicAssignmentsSummary: { [key: string]: TopicAssignmentsSummary } = {
    topic1: {
      subtopicId: 12,
      topicVersion: 7,
      topicId: &#x27;topic_id&#x27;
    }
  };


  class MockNgbModal {
    modal: string;
    success: boolean = true;
    open(content, options) {
      if (this.modal === &#x27;delete_skill&#x27;) {
        return {
          componentInstance: {
            skillId: &#x27;&#x27;
          },
          result: {
            then: (
                successCallback: () =&gt; void,
                errorCallback: () =&gt; void
            ) =&gt; {
              if (this.success) {
                successCallback();
              } else {
                errorCallback();
              }
              return {
                then: (callback: () =&gt; void) =&gt; {
                  callback();
                }
              };
            }
          }
        };
      } else if (this.modal === &#x27;merge_skill&#x27;) {
        return {
          componentInstance: {
            skillSummaries: null,
            skill: null,
            categorizedSkills: null,
            allowSkillsFromOtherTopics: null,
            untriagedSkillSummaries: null
          },
          result: {
            then: (
                successCallback: (result) =&gt; void,
                cancelCallback: () =&gt; void
            ) =&gt; {
              if (this.success) {
                successCallback({
                  skill: {},
                  supersedingSkillId: &#x27;test_id&#x27;
                });
              } else {
                cancelCallback();
              }
            }
          }
        };
      } else if (this.modal === &#x27;unassign_skill&#x27;) {
        return {
          componentInstance: {
            skillId: &#x27;&#x27;,
          },
          result: {
            then: (
                successCallback: (topicsToUnassign) =&gt; void,
                cancelCallback: () =&gt; void
            ) =&gt; {
              if (this.success) {
                successCallback(topicAssignmentsSummary);
              } else {
                cancelCallback();
              }
            }
          }
        };
      } else if (this.modal === &#x27;assign_skill_to_topic&#x27;) {
        return {
          componentInstance: {
            topicSummaries: null
          },
          result: {
            then: (
                successCallback: (topicsToUnassign) =&gt; void,
                cancelCallback: () =&gt; void
            ) =&gt; {
              if (this.success) {
                successCallback([&#x27;test_id&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]);
              } else {
                cancelCallback();
              }
            }
          }
        };
      }
    }
  }

  class MockSkillBackendApiService {
    doesNotHaveSkillLinked: boolean = false;
    deleteSkillAsync(skillId: string) {
      return {
        then: (callb: () =&gt; void) =&gt; {
          callb();
          return {
            &#x27;catch&#x27;: (callback: (errorMessage: string) =&gt; void) =&gt; {
              if (this.doesNotHaveSkillLinked) {
                callback(&#x27;does not have any skills linked&#x27;);
              } else {
                callback(&#x27;&#x27;);
              }
            }
          };
        }
      };
    }
  }

  class MockTopicsAndSkillsDashboardBackendApiService {
    error: boolean = false;
    onTopicsAndSkillsDashboardReinitialized: EventEmitter&lt;boolean&gt; =
    new EventEmitter();
    mergeSkillsAsync(skillId: string, supersedingSkillId: string) {
      return {
        then: (
            successCallback: () =&gt; void,
            errorCallback: (errorMessage: { error: { error: string } }) =&gt; void
        ) =&gt; {
          if (this.error) {
            errorCallback({
              error: {
                error: &#x27;error&#x27;
              }
            });
          } else {
            successCallback();
          }
        }
      };
    }
  }

  class MockEditableBackendApiService {
    updateTopicAsync(
        topicId: string,
        topicVersion: number,
        msg: string,
        changeList: []
    ) {
      return {
        then: (
            successCallback: () =&gt; void
        ) =&gt; {
          successCallback();
          return {
            then: (successCallback: () =&gt; void) =&gt; {
              successCallback();
            }
          };
        }
      };
    }
  }

  beforeEach(waitForAsync(() =&gt; {
    TestBed.configureTestingModule({
      imports: [
        MatCardModule,
        MatCheckboxModule,
        MatRadioModule,
        FormsModule
      ],
      declarations: [
        SkillsListComponent,
        DeleteSkillModalComponent,
        UnassignSkillFromTopicsModalComponent,
        AssignSkillToTopicModalComponent,
        MergeSkillModalComponent,
        SelectTopicsComponent,
        SkillSelectorComponent
      ],
      providers: [
        AlertsService,
        UrlInterpolationService,
        {
          provide: NgbModal,
          useClass: MockNgbModal
        },
        {
          provide: EditableTopicBackendApiService,
          useClass: MockEditableBackendApiService
        },
        {
          provide: SkillBackendApiService,
          useClass: MockSkillBackendApiService
        },
        {
          provide: TopicsAndSkillsDashboardBackendApiService,
          useClass: MockTopicsAndSkillsDashboardBackendApiService
        }
      ]
    }).compileComponents();
  }));

  beforeEach(() =&gt; {
    fixture = TestBed.createComponent(SkillsListComponent);
    componentInstance = fixture.componentInstance;
    componentInstance.skillSummaries = [];
    componentInstance.pageNumber = 0;
    componentInstance.itemsPerPage = 5;
    componentInstance.editableTopicSummaries = [];
    componentInstance.mergeableSkillSummaries = [];
    componentInstance.untriagedSkillSummaries = [];

    topicsAndSkillsDashboardBackendApiService = (
      TestBed.inject(TopicsAndSkillsDashboardBackendApiService) as
    unknown) as jasmine.SpyObj&lt;MockTopicsAndSkillsDashboardBackendApiService&gt;;
    alertsService = TestBed.inject(AlertsService);
    alertsService = (alertsService as unknown) as jasmine.SpyObj&lt;AlertsService&gt;;
    mockNgbModal = (TestBed.inject(NgbModal) as unknown) as
      jasmine.SpyObj&lt;MockNgbModal&gt;;
    mockSkillBackendApiService = (
      TestBed.inject(SkillBackendApiService) as
    unknown) as jasmine.SpyObj&lt;MockSkillBackendApiService&gt;;
  });

  it(&#x27;should create&#x27;, () =&gt; {
    expect(componentInstance).toBeDefined();
  });

  it(&#x27;should destroy&#x27;, () =&gt; {
    spyOn(componentInstance.directiveSubscriptions, &#x27;unsubscribe&#x27;);
    componentInstance.ngOnDestroy();
    expect(componentInstance.directiveSubscriptions.unsubscribe)
      .toHaveBeenCalled();
  });

  it(&#x27;should show edit options&#x27;, () =&gt; {
    componentInstance.selectedIndex = &#x27;test_index&#x27;;
    expect(componentInstance.showEditOptions(&#x27;test_index&#x27;)).toBeTrue();
    expect(componentInstance.showEditOptions(&#x27;test&#x27;)).toBeFalse();
  });

  it(&#x27;should change edit options&#x27;, () =&gt; {
    componentInstance.selectedIndex = &#x27;&#x27;;
    let skillId: string = &#x27;test_id&#x27;;
    componentInstance.changeEditOptions(skillId);
    expect(componentInstance.selectedIndex).toEqual(skillId);
    componentInstance.selectedIndex = &#x27;not_empty&#x27;;
    componentInstance.changeEditOptions(skillId);
    expect(componentInstance.selectedIndex).toEqual(&#x27;&#x27;);
  });

  it(&#x27;should get serial number for skill&#x27;, () =&gt; {
    expect(componentInstance.getSerialNumberForSkill(5)).toEqual(6);
  });

  it(&#x27;should get skill editor url&#x27;, () =&gt; {
    expect(componentInstance.getSkillEditorUrl(&#x27;test_id&#x27;))
      .toEqual(&#x27;/skill_editor/test_id#/&#x27;);
  });

  it(&#x27;should delete skill&#x27;, fakeAsync(() =&gt; {
    mockNgbModal.modal = &#x27;delete_skill&#x27;;
    spyOn(
      topicsAndSkillsDashboardBackendApiService
        .onTopicsAndSkillsDashboardReinitialized, &#x27;emit&#x27;);
    spyOn(alertsService, &#x27;addSuccessMessage&#x27;);
    componentInstance.deleteSkill(&#x27;skill_id&#x27;);
    tick(500);
    expect(
      topicsAndSkillsDashboardBackendApiService
        .onTopicsAndSkillsDashboardReinitialized.emit).toHaveBeenCalled();
    expect(alertsService.addSuccessMessage).toHaveBeenCalledWith(
      &#x27;The skill has been deleted.&#x27;,
      1000
    );
    mockSkillBackendApiService.doesNotHaveSkillLinked = true;
    componentInstance.deleteSkill(&#x27;skill_id&#x27;);
    tick(500);
  }));

  it(&#x27;should cancel delete skil modal&#x27;, () =&gt; {
    mockNgbModal.modal = &#x27;delete_skill&#x27;;
    mockNgbModal.success = false;
    componentInstance.deleteSkill(&#x27;test_skill&#x27;);
  });

  it(&#x27;should merge skill&#x27;, fakeAsync(() =&gt; {
    mockNgbModal.modal = &#x27;merge_skill&#x27;;
    spyOn(
      topicsAndSkillsDashboardBackendApiService
        .onTopicsAndSkillsDashboardReinitialized,
      &#x27;emit&#x27;
    );
    spyOn(alertsService, &#x27;addSuccessMessage&#x27;);
    componentInstance.mergeSkill(
      AugmentedSkillSummary
        .createFromBackendDict(augmentedSkillSummaryBackendDict));
    tick(300);
    expect(
      topicsAndSkillsDashboardBackendApiService
        .onTopicsAndSkillsDashboardReinitialized.emit).toHaveBeenCalled();
    expect(alertsService.addSuccessMessage).toHaveBeenCalled();
    topicsAndSkillsDashboardBackendApiService.error = true;
    componentInstance.mergeSkill(
      AugmentedSkillSummary
        .createFromBackendDict(augmentedSkillSummaryBackendDict));
  }));

  it(&#x27;should handle cancel on merge skill modal&#x27;, fakeAsync(() =&gt; {
    mockNgbModal.modal = &#x27;merge_skill&#x27;;
    mockNgbModal.success = false;
    componentInstance.mergeSkill(
      AugmentedSkillSummary.createFromBackendDict(
        augmentedSkillSummaryBackendDict));
  }));

  it(&#x27;should unassign skill&#x27;, fakeAsync(() =&gt; {
    mockNgbModal.modal = &#x27;unassign_skill&#x27;;
    let skillId: string = &#x27;test_skill&#x27;;
    spyOn(
      topicsAndSkillsDashboardBackendApiService
        .onTopicsAndSkillsDashboardReinitialized, &#x27;emit&#x27;);
    spyOn(alertsService, &#x27;addSuccessMessage&#x27;);
    componentInstance.unassignSkill(skillId);
    tick(500);
    expect(
      topicsAndSkillsDashboardBackendApiService
        .onTopicsAndSkillsDashboardReinitialized.emit)
      .toHaveBeenCalledWith(true);
    expect(alertsService.addSuccessMessage).toHaveBeenCalledWith(
      &#x27;The skill has been unassigned to the topic.&#x27;
      , 1000);
    mockNgbModal.success = false;
    componentInstance.unassignSkill(&#x27;skill_id&#x27;);
  }));

  it(&#x27;should assign skill to topic&#x27;, fakeAsync(() =&gt; {
    mockNgbModal.modal = &#x27;assign_skill_to_topic&#x27;;
    componentInstance.editableTopicSummaries = [new TopicSummary(
      &#x27;test_id&#x27;,
      &#x27;asd&#x27;,
      1,
      2,
      3,
      4,
      23,
      &#x27;sadf&#x27;,
      &#x27;asdf&#x27;,
      12,
      21,
      123,
      23,
      true,
      false,
      &#x27;sad&#x27;,
      &#x27;asdf&#x27;,
      &#x27;asdf&#x27;,
      &#x27;sdf&#x27;
    )];
    spyOn(
      topicsAndSkillsDashboardBackendApiService
        .onTopicsAndSkillsDashboardReinitialized, &#x27;emit&#x27;);
    spyOn(alertsService, &#x27;addSuccessMessage&#x27;);
    componentInstance.assignSkillToTopic(
      AugmentedSkillSummary.createFromBackendDict(
        augmentedSkillSummaryBackendDict)
    );
    tick(500);
    expect(
      topicsAndSkillsDashboardBackendApiService
        .onTopicsAndSkillsDashboardReinitialized.emit)
      .toHaveBeenCalledWith(true);
    expect(alertsService.addSuccessMessage).toHaveBeenCalledWith(
      &#x27;The skill has been assigned to the topic.&#x27;,
      1000
    );
    mockNgbModal.success = false;
    componentInstance.assignSkillToTopic(
      AugmentedSkillSummary.createFromBackendDict(
        augmentedSkillSummaryBackendDict));
  }));
});
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.spec.ts&quot;,&quot;line&quot;:72,&quot;character&quot;:9,&quot;text&quot;:&quot;content&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.spec.ts&quot;,&quot;line&quot;:72,&quot;character&quot;:18,&quot;text&quot;:&quot;options&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.spec.ts&quot;,&quot;line&quot;:107,&quot;character&quot;:34,&quot;text&quot;:&quot;result&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.spec.ts&quot;,&quot;line&quot;:128,&quot;character&quot;:34,&quot;text&quot;:&quot;topicsToUnassign&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.spec.ts&quot;,&quot;line&quot;:146,&quot;character&quot;:34,&quot;text&quot;:&quot;topicsToUnassign&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.spec.ts&quot;,&quot;line&quot;:277,&quot;character&quot;:48,&quot;text&quot;:&quot;(\n      TestBed.inject(TopicsAndSkillsDashboardBackendApiService) as\n    unknown) as jasmine.SpyObj&lt;MockTopicsAndSkillsDashboardBackendApiService&gt;&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.spec.ts&quot;,&quot;line&quot;:281,&quot;character&quot;:20,&quot;text&quot;:&quot;(alertsService as unknown) as jasmine.SpyObj&lt;AlertsService&gt;&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.spec.ts&quot;,&quot;line&quot;:282,&quot;character&quot;:19,&quot;text&quot;:&quot;(TestBed.inject(NgbModal) as unknown) as\n      jasmine.SpyObj&lt;MockNgbModal&gt;&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.spec.ts&quot;,&quot;line&quot;:284,&quot;character&quot;:33,&quot;text&quot;:&quot;(\n      TestBed.inject(SkillBackendApiService) as\n    unknown) as jasmine.SpyObj&lt;MockSkillBackendApiService&gt;&quot;,&quot;kind&quot;:3}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 17 Jun 2021 20:43:59 GMT</p>
    </body>
  </html>
  