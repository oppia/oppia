
  <!DOCTYPE html>
  <html>
    <head>
      <title>skills-list.component.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="negative"><td class="">core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts</td><td class="">93.78%</td><td class="">100%</td><td class="">386</td><td class="">362</td><td class="">24</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">// Copyright 2018 The Oppia Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview Component for the skills list viewer.
 */

import { Component, Input } from &#x27;@angular/core&#x27;;
import { downgradeComponent } from &#x27;@angular/upgrade/static&#x27;;
import { NgbModal, NgbModalRef } from &#x27;@ng-bootstrap/ng-bootstrap&#x27;;
import { MergeSkillModalComponent } from &#x27;components/skill-selector/merge-skill-modal.component&#x27;;
import { BackendChangeObject } from &#x27;domain/editor/undo_redo/change.model&#x27;;
import { AugmentedSkillSummary } from &#x27;domain/skill/augmented-skill-summary.model&#x27;;
import { ShortSkillSummary } from &#x27;domain/skill/short-skill-summary.model&#x27;;
import { SkillBackendApiService } from &#x27;domain/skill/skill-backend-api.service&#x27;;
import { SkillSummary } from &#x27;domain/skill/skill-summary.model&#x27;;
import { EditableTopicBackendApiService } from &#x27;domain/topic/editable-topic-backend-api.service&#x27;;
import { TopicSummary } from &#x27;domain/topic/topic-summary.model&#x27;;
import { TopicsAndSkillsDashboardBackendApiService } from &#x27;domain/topics_and_skills_dashboard/topics-and-skills-dashboard-backend-api.service&#x27;;
import { UrlInterpolationService } from &#x27;domain/utilities/url-interpolation.service&#x27;;
import { Subscription } from &#x27;rxjs&#x27;;
import { AlertsService } from &#x27;services/alerts.service&#x27;;
import { AssignSkillToTopicModalComponent } from &#x27;../modals/assign-skill-to-topic-modal.component&#x27;;
import { DeleteSkillModalComponent } from &#x27;../modals/delete-skill-modal.component&#x27;;
import { TopicAssignmentsSummary, UnassignSkillFromTopicsModalComponent } from &#x27;../modals/unassign-skill-from-topics-modal.component&#x27;;

export interface SkillsCategorizedByTopics {
  [topicName: string]: {
    [subtopicName: string]: ShortSkillSummary[]
  }
}

interface MergeModalResult {
  skill: AugmentedSkillSummary,
  supersedingSkillId: string
}

@Component({
  selector: &#x27;oppia-skills-list&#x27;,
  templateUrl: &#x27;./skills-list.component.html&#x27;
})
export class SkillsListComponent {
  @Input() skillSummaries: AugmentedSkillSummary[];
  @Input() pageNumber: number;
  @Input() itemsPerPage: number;
  @Input() editableTopicSummaries: TopicSummary[];
  @Input() mergeableSkillSummaries: SkillSummary[];
  @Input() untriagedSkillSummaries: SkillSummary[];
  @Input() userCanDeleteSkill: boolean;
  @Input() userCanCreateSkill: boolean;
  @Input() skillsCategorizedByTopics: SkillsCategorizedByTopics;
  directiveSubscriptions: Subscription = new Subscription();
  selectedIndex: string;
  SKILL_HEADINGS: string[] = [
    &#x27;index&#x27;, &#x27;description&#x27;, &#x27;worked_examples_count&#x27;,
    &#x27;misconception_count&#x27;, &#x27;status&#x27;];

  constructor(
    private alertsService: AlertsService,
    private urlInterpolationService: UrlInterpolationService,
    private ngbModal: NgbModal,
    private editableTopicBackendApiService: EditableTopicBackendApiService,
    private skillBackendApiService: SkillBackendApiService,
    private topicsAndSkillsDashboardBackendApiService:
    TopicsAndSkillsDashboardBackendApiService
  ) {}

  getSkillEditorUrl(skillId: string): string {
    let SKILL_EDITOR_URL_TEMPLATE: string = &#x27;/skill_editor/&lt;skill_id&gt;#/&#x27;;
    return this.urlInterpolationService.interpolateUrl(
      SKILL_EDITOR_URL_TEMPLATE, {
        skill_id: skillId
      }
    );
  }

  deleteSkill(skillId: string): void {
    let modalRef: NgbModalRef =
    this.ngbModal.open(DeleteSkillModalComponent, {
      backdrop: true,
      windowClass: &#x27;delete-skill-modal&#x27;
    });

    modalRef.componentInstance.skillId = skillId;

    modalRef.result.then(() =&gt; {
      this.skillBackendApiService.deleteSkillAsync(skillId).then(
        () =&gt; {
          setTimeout(() =&gt; {
            this.topicsAndSkillsDashboardBackendApiService.
              onTopicsAndSkillsDashboardReinitialized.emit();
            let successToast = &#x27;The skill has been deleted.&#x27;;
            this.alertsService.addSuccessMessage(successToast, 1000);
          }, 100);
        }
      ).catch((errorMessage: string) =&gt; {
        let errorToast: string = null;
        // This error is thrown as part of a final validation check in
        // the backend, hence the message does not include instructions
        // for the user to follow.
        if (errorMessage.includes(&#x27;does not have any skills linked&#x27;)) {
          errorToast = (
            &#x27;The skill is assigned to a subtopic in a published &#x27; +
            &#x27;topic. Please unpublish the topic before deleting &#x27; +
            &#x27;this skill.&#x27;);
        } else {
          errorToast = errorMessage;
        }
        setTimeout(() =&gt; {
          this.topicsAndSkillsDashboardBackendApiService.
            onTopicsAndSkillsDashboardReinitialized.emit();
        }, 100);
        this.alertsService.addInfoMessage(errorToast, 5000);
      });
    }, () =&gt; {
      // Note to developers:
      // This callback is triggered when the Cancel button is clicked.
      // No further action is needed.
    }).then(() =&gt; {});
  }

  unassignSkill(skillId: string): void {
    let modalRef: NgbModalRef = this.ngbModal.
      open(UnassignSkillFromTopicsModalComponent, {
        backdrop: &#x27;static&#x27;
      });
    modalRef.componentInstance.skillId = skillId;
    modalRef.result.then(
      (topicsToUnassign: {[key: string]: TopicAssignmentsSummary}) =&gt; {
        for (let topic in topicsToUnassign) {
          let changeList: BackendChangeObject[] = [];
          if (topicsToUnassign[topic].subtopicId) {
            changeList.push({
              cmd: &#x27;remove_skill_id_from_subtopic&#x27;,
              subtopic_id: topicsToUnassign[topic].subtopicId,
              skill_id: skillId
            });
          }

          changeList.push({
            cmd: &#x27;remove_uncategorized_skill_id&#x27;,
            uncategorized_skill_id: skillId
          });

          this.editableTopicBackendApiService.updateTopicAsync(
            topicsToUnassign[topic].topicId,
            topicsToUnassign[topic].topicVersion,
            `Unassigned skill with id ${skillId} from the topic.`,
            changeList
          ).then(() =&gt; {
            setTimeout(() =&gt; {
              this.topicsAndSkillsDashboardBackendApiService.
                onTopicsAndSkillsDashboardReinitialized.emit(true);
            }, 100);
          }).then(() =&gt; {
            let successToast: string = (
              &#x27;The skill has been unassigned to the topic.&#x27;);
            this.alertsService.addSuccessMessage(successToast, 1000);
          });
        }
      }, () =&gt; {
      // Note to developers:
      // This callback is triggered when the Cancel button is clicked.
      // No further action is needed.
      });
  }

  assignSkillToTopic(skill: AugmentedSkillSummary): void {
    let skillId: string = skill.id;
    let topicSummaries: TopicSummary[] = this.editableTopicSummaries.filter(
      topicSummary =&gt; !skill.topicNames.includes(topicSummary.name));
    let modalRef: NgbModalRef = this.ngbModal
      .open(AssignSkillToTopicModalComponent, {
        backdrop: &#x27;static&#x27;,
        windowClass: &#x27;assign-skill-to-topic-modal&#x27;
      });
    modalRef.componentInstance.topicSummaries = topicSummaries;
    modalRef.result.then((topicIds: string[]) =&gt; {
      let changeList: BackendChangeObject[] = [{
        cmd: &#x27;add_uncategorized_skill_id&#x27;,
        new_uncategorized_skill_id: skillId
      }];
      let topicSummaries: TopicSummary[] = this.editableTopicSummaries;
      for (let i = 0; i &lt; topicIds.length; i++) {
        for (let j = 0; j &lt; topicSummaries.length; j++) {
          if (topicSummaries[j].id === topicIds[i]) {
            this.editableTopicBackendApiService.updateTopicAsync(
              topicIds[i], topicSummaries[j].version,
              &#x27;Added skill with id &#x27; + skillId + &#x27; to topic.&#x27;,
              changeList
            ).then(() =&gt; {
              setTimeout(() =&gt; {
                this.topicsAndSkillsDashboardBackendApiService.
                  onTopicsAndSkillsDashboardReinitialized.emit(true);
              }, 100);
            }).then(() =&gt; {
              let successToast = (
                &#x27;The skill has been assigned to the topic.&#x27;);
              this.alertsService.addSuccessMessage(successToast, 1000);
            });
          }
        }
      }
    }, () =&gt; {
      // Note to developers:
      // This callback is triggered when the Cancel button is clicked.
      // No further action is needed.
    });
  }

  mergeSkill(skill: AugmentedSkillSummary): void {
    let skillSummaries: SkillSummary[] = this.mergeableSkillSummaries;
    let categorizedSkills: SkillsCategorizedByTopics =
    this.skillsCategorizedByTopics;
    let untriagedSkillSummaries: SkillSummary[] = this.untriagedSkillSummaries;
    let allowSkillsFromOtherTopics: boolean = true;

    let modalRef: NgbModalRef = this.ngbModal.open(MergeSkillModalComponent, {
      backdrop: &#x27;static&#x27;,
      windowClass: &#x27;skill-select-modal&#x27;,
      size: &#x27;xl&#x27;
    });
    modalRef.componentInstance.skillSummaries = skillSummaries;
    modalRef.componentInstance.skill = skill;
    modalRef.componentInstance.categorizedSkills = categorizedSkills;
    modalRef.componentInstance.allowSkillsFromOtherTopics =
    allowSkillsFromOtherTopics;
    modalRef.componentInstance.untriagedSkillSummaries =
    untriagedSkillSummaries;

    modalRef.result.then((result: MergeModalResult) =&gt; {
      let skill: AugmentedSkillSummary = result.skill;
      let supersedingSkillId: string = result.supersedingSkillId;
      // Transfer questions from the old skill to the new skill.
      this.topicsAndSkillsDashboardBackendApiService.mergeSkillsAsync(
        skill.id, supersedingSkillId).then(() =&gt; {
        // Broadcast will update the skills list in the dashboard so
        // that the merged skills are not shown anymore.
        setTimeout(() =&gt; {
          this.topicsAndSkillsDashboardBackendApiService.
            onTopicsAndSkillsDashboardReinitialized.emit(true);
          let successToast: string = &#x27;Merged Skills.&#x27;;
          this.alertsService.addSuccessMessage(successToast, 1000);
        }, 100);
      }, (errorResponse) =&gt; {
        this.alertsService.addWarning(errorResponse.error.error);
      });
    }, () =&gt; {
      // Note to developers:
      // This callback is triggered when the Cancel button is clicked.
      // No further action is needed.
    });
  }

  getSerialNumberForSkill(skillIndex: number): number {
    const skillSerialNumber: number = (
      skillIndex + (this.pageNumber * this.itemsPerPage));
    return (skillSerialNumber + 1);
  }

  changeEditOptions(skillId: string): void {
    this.selectedIndex = this.selectedIndex ? &#x27;&#x27; : skillId;
  }

  showEditOptions(skillId: string): boolean {
    return this.selectedIndex === skillId;
  }

  ngOnDestroy(): void {
    this.directiveSubscriptions.unsubscribe();
  }
}

angular.module(&#x27;oppia&#x27;).directive(&#x27;oppiaSkillsList&#x27;,
  downgradeComponent({ component: SkillsListComponent }));
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:94,&quot;character&quot;:13,&quot;text&quot;:&quot;componentInstance&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:94,&quot;character&quot;:31,&quot;text&quot;:&quot;skillId&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:96,&quot;character&quot;:13,&quot;text&quot;:&quot;result&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:137,&quot;character&quot;:13,&quot;text&quot;:&quot;componentInstance&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:137,&quot;character&quot;:31,&quot;text&quot;:&quot;skillId&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:138,&quot;character&quot;:13,&quot;text&quot;:&quot;result&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:187,&quot;character&quot;:13,&quot;text&quot;:&quot;componentInstance&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:187,&quot;character&quot;:31,&quot;text&quot;:&quot;topicSummaries&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:188,&quot;character&quot;:13,&quot;text&quot;:&quot;result&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:233,&quot;character&quot;:13,&quot;text&quot;:&quot;componentInstance&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:233,&quot;character&quot;:31,&quot;text&quot;:&quot;skillSummaries&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:234,&quot;character&quot;:13,&quot;text&quot;:&quot;componentInstance&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:234,&quot;character&quot;:31,&quot;text&quot;:&quot;skill&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:235,&quot;character&quot;:13,&quot;text&quot;:&quot;componentInstance&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:235,&quot;character&quot;:31,&quot;text&quot;:&quot;categorizedSkills&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:236,&quot;character&quot;:13,&quot;text&quot;:&quot;componentInstance&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:236,&quot;character&quot;:31,&quot;text&quot;:&quot;allowSkillsFromOtherTopics&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:238,&quot;character&quot;:13,&quot;text&quot;:&quot;componentInstance&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:238,&quot;character&quot;:31,&quot;text&quot;:&quot;untriagedSkillSummaries&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:241,&quot;character&quot;:13,&quot;text&quot;:&quot;result&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:255,&quot;character&quot;:10,&quot;text&quot;:&quot;errorResponse&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:256,&quot;character&quot;:38,&quot;text&quot;:&quot;errorResponse&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:256,&quot;character&quot;:52,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/pages/topics-and-skills-dashboard-page/skills-list/skills-list.component.ts&quot;,&quot;line&quot;:256,&quot;character&quot;:58,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 17 Jun 2021 20:43:56 GMT</p>
    </body>
  </html>
  