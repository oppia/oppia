
  <!DOCTYPE html>
  <html>
    <head>
      <title>QuestionObjectFactory.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="negative"><td class="">core/templates/domain/question/QuestionObjectFactory.ts</td><td class="">98.88%</td><td class="">100%</td><td class="">268</td><td class="">265</td><td class="">3</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">// Copyright 2018 The Oppia Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview Factory for creating and mutating instances of frontend
 * question domain objects.
 */

import { downgradeInjectable } from &#x27;@angular/upgrade/static&#x27;;
import { Injectable } from &#x27;@angular/core&#x27;;
import { State, StateBackendDict, StateObjectFactory }
  from &#x27;domain/state/StateObjectFactory&#x27;;
import INTERACTION_SPECS from &#x27;interactions/interaction_specs.json&#x27;;
import constants from &#x27;assets/constants&#x27;;

export interface QuestionBackendDict {
  &#x27;id&#x27;: string;
  &#x27;question_state_data&#x27;: StateBackendDict,
  &#x27;question_state_data_schema_version&#x27;: number;
  &#x27;language_code&#x27;: string;
  &#x27;version&#x27;: number;
  &#x27;linked_skill_ids&#x27;: string[];
  &#x27;inapplicable_skill_misconception_ids&#x27;: string[];
}

export class Question {
  _id: string;
  _stateData: State;
  _languageCode: string;
  _version: number;
  _linkedSkillIds: string[];
  _inapplicableSkillMisconceptionIds: string[];

  constructor(
      id: string, stateData: State, languageCode: string,
      version: number, linkedSkillIds: string[],
      inapplicableSkillMisconceptionIds: string[]) {
    this._id = id;
    this._stateData = stateData;
    this._languageCode = languageCode;
    this._version = version;
    this._linkedSkillIds = linkedSkillIds;
    this._inapplicableSkillMisconceptionIds = (
      inapplicableSkillMisconceptionIds);
  }

  getId(): string {
    return this._id;
  }

  getStateData(): State {
    return this._stateData;
  }

  setStateData(newStateData: State): void {
    this._stateData = angular.copy(newStateData);
  }

  getLanguageCode(): string {
    return this._languageCode;
  }

  setLanguageCode(languageCode: string): void {
    this._languageCode = languageCode;
  }

  getVersion(): number {
    return this._version;
  }

  getLinkedSkillIds(): string[] {
    return this._linkedSkillIds;
  }

  setLinkedSkillIds(linkedSkillIds: string[]): void {
    this._linkedSkillIds = linkedSkillIds;
  }

  getInapplicableSkillMisconceptionIds(): string[] {
    return this._inapplicableSkillMisconceptionIds;
  }

  setInapplicableSkillMisconceptionIds(
      inapplicableSkillMisconceptionIds: string[]): void {
    this._inapplicableSkillMisconceptionIds = (
      inapplicableSkillMisconceptionIds);
  }

  getValidationErrorMessage(): string {
    var interaction = this._stateData.interaction;
    var questionContent = this._stateData.content._html;
    if (questionContent.length === 0) {
      return &#x27;Please enter a question.&#x27;;
    }
    if (interaction.id === null) {
      return &#x27;An interaction must be specified&#x27;;
    }

    if (interaction.defaultOutcome.feedback._html.length === 0) {
      return &#x27;Please enter a feedback for the default outcome.&#x27;;
    }

    if (interaction.hints.length === 0) {
      return &#x27;At least 1 hint should be specified&#x27;;
    }
    if (
      !interaction.solution &amp;&amp;
      INTERACTION_SPECS[interaction.id].can_have_solution) {
      return &#x27;A solution must be specified&#x27;;
    }
    var answerGroups = this._stateData.interaction.answerGroups;
    var atLeastOneAnswerCorrect = false;
    for (var i = 0; i &lt; answerGroups.length; i++) {
      if (answerGroups[i].outcome.labelledAsCorrect) {
        atLeastOneAnswerCorrect = true;
        continue;
      }
    }
    if (!atLeastOneAnswerCorrect) {
      return &#x27;At least one answer should be marked correct&#x27;;
    }
    return null;
  }

  getUnaddressedMisconceptionNames(misconceptionsBySkill: {}): string[] {
    var answerGroups = this._stateData.interaction.answerGroups;
    var taggedSkillMisconceptionIds = {};
    for (var i = 0; i &lt; answerGroups.length; i++) {
      if (!answerGroups[i].outcome.labelledAsCorrect &amp;&amp;
          answerGroups[i].taggedSkillMisconceptionId !== null) {
        taggedSkillMisconceptionIds[
          answerGroups[i].taggedSkillMisconceptionId] = true;
      }
    }
    var unaddressedMisconceptionNames = [];
    var self = this;
    Object.keys(misconceptionsBySkill).forEach(function(skillId) {
      for (var i = 0; i &lt; misconceptionsBySkill[skillId].length; i++) {
        var skillMisconceptionIdIsNotApplicable = (
          self._inapplicableSkillMisconceptionIds.includes(
            `${skillId}-${misconceptionsBySkill[skillId][i].getId()}`));
        if (!misconceptionsBySkill[skillId][i].isMandatory() &amp;&amp;
            skillMisconceptionIdIsNotApplicable) {
          continue;
        }
        var skillMisconceptionId = (
          skillId + &#x27;-&#x27; + misconceptionsBySkill[skillId][i].getId());
        if (!taggedSkillMisconceptionIds.hasOwnProperty(
          skillMisconceptionId)) {
          unaddressedMisconceptionNames.push(
            misconceptionsBySkill[skillId][i].getName());
        }
      }
    });
    return unaddressedMisconceptionNames;
  }

  toBackendDict(isNewQuestion: boolean): QuestionBackendDict {
    var questionBackendDict = {
      id: null,
      question_state_data: this._stateData.toBackendDict(),
      question_state_data_schema_version: this._version,
      language_code: this._languageCode,
      linked_skill_ids: this._linkedSkillIds,
      inapplicable_skill_misconception_ids: (
        this._inapplicableSkillMisconceptionIds),
      version: 0,
    };
    if (!isNewQuestion) {
      questionBackendDict.id = this._id;
      questionBackendDict.version = this._version;
    }
    return questionBackendDict;
  }
}

@Injectable({
  providedIn: &#x27;root&#x27;
})
export class QuestionObjectFactory {
  constructor(
    private stateObject: StateObjectFactory) {}

  createDefaultQuestion(skillIds: string[]): Question {
    return new Question(
      null, this.stateObject.createDefaultState(null),
      constants.DEFAULT_LANGUAGE_CODE, 1, skillIds, []);
  }

  createFromBackendDict(questionBackendDict: QuestionBackendDict): Question {
    return new Question(
      questionBackendDict.id,
      this.stateObject.createFromBackendDict(
        &#x27;question&#x27;, questionBackendDict.question_state_data),
      questionBackendDict.language_code, questionBackendDict.version,
      questionBackendDict.linked_skill_ids,
      questionBackendDict.inapplicable_skill_misconception_ids
    );
  }
}

angular.module(&#x27;oppia&#x27;).factory(
  &#x27;QuestionObjectFactory&#x27;,
  downgradeInjectable(QuestionObjectFactory));
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;core/templates/domain/question/QuestionObjectFactory.ts&quot;,&quot;line&quot;:145,&quot;character&quot;:8,&quot;text&quot;:&quot;unaddressedMisconceptionNames&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;core/templates/domain/question/QuestionObjectFactory.ts&quot;,&quot;line&quot;:160,&quot;character&quot;:10,&quot;text&quot;:&quot;unaddressedMisconceptionNames&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;core/templates/domain/question/QuestionObjectFactory.ts&quot;,&quot;line&quot;:180,&quot;character&quot;:26,&quot;text&quot;:&quot;id&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 17 Jun 2021 20:43:55 GMT</p>
    </body>
  </html>
  