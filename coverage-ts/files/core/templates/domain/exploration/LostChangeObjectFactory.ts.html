
  <!DOCTYPE html>
  <html>
    <head>
      <title>LostChangeObjectFactory.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="negative"><td class="">core/templates/domain/exploration/LostChangeObjectFactory.ts</td><td class="">93.69%</td><td class="">100%</td><td class="">301</td><td class="">282</td><td class="">19</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">// Copyright 2020 The Oppia Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview Factory for creating new frontend instances of LostChange
 * domain objects.
 */

import { Injectable } from &#x27;@angular/core&#x27;;
import { downgradeInjectable } from &#x27;@angular/upgrade/static&#x27;;
import { UtilsService } from &#x27;services/utils.service&#x27;;
import isEqual from &#x27;lodash/isEqual&#x27;;

import { Outcome } from
  &#x27;domain/exploration/OutcomeObjectFactory&#x27;;
import { SubtitledHtml, SubtitledHtmlBackendDict } from
  &#x27;domain/exploration/subtitled-html.model&#x27;;
import { ExplorationChange } from &#x27;./exploration-draft.model&#x27;;
import { InteractionBackendDict } from &#x27;./InteractionObjectFactory&#x27;;
import { ParamChangeBackendDict } from &#x27;./ParamChangeObjectFactory&#x27;;
import { ParamSpecBackendDict } from &#x27;./ParamSpecObjectFactory&#x27;;
import { RecordedVoiceOverBackendDict } from &#x27;./recorded-voiceovers.model&#x27;;
import { WrittenTranslationsBackendDict } from &#x27;./WrittenTranslationsObjectFactory&#x27;;

interface LostChangeValues {
  &#x27;outcome&#x27;?: Outcome;
  &#x27;dest&#x27;?: string;
  &#x27;feedback&#x27;?: SubtitledHtml;
  &#x27;rules&#x27;?: Object;
  &#x27;html&#x27;?: string;
}

type LostChangeValue = LostChangeValues | SubtitledHtmlBackendDict |
  InteractionBackendDict | ParamChangeBackendDict[] |
  RecordedVoiceOverBackendDict | WrittenTranslationsBackendDict |
  ParamChangeBackendDict[] | ParamSpecBackendDict | boolean | number | string |
  string[];

// Properties are optional in &#x27;LostChangeBackendDict&#x27; because all of them may
// not be present in the dict and may change according to the cmd.
export interface LostChangeBackendDict {
  &#x27;cmd&#x27;: string;
  &#x27;new_state_name&#x27;?: string;
  &#x27;old_state_name&#x27;?: string;
  &#x27;state_name&#x27;?: string;
  &#x27;new_value&#x27;?: LostChangeValue;
  &#x27;old_value&#x27;?: LostChangeValue;
  &#x27;property_name&#x27;?: string;
}

export class LostChange {
  cmd: string;
  stateName: string;
  newStateName: string;
  oldStateName: string;
  newValue: LostChangeValue;
  oldValue: LostChangeValue;
  propertyName: string;
  utilsService: UtilsService;

  constructor(
      utilsService: UtilsService, cmd: string, newStateName: string,
      oldStateName: string, stateName: string, newValue: LostChangeValue,
      oldValue: LostChangeValue, propertyName: string) {
    this.utilsService = utilsService;
    this.cmd = cmd;
    this.newStateName = newStateName;
    this.oldStateName = oldStateName;
    this.stateName = stateName;
    this.newValue = newValue;
    this.oldValue = oldValue;
    this.propertyName = propertyName;
  }

  // An edit is represented either as an object or an array. If it&#x27;s an
  // object, then simply return that object. In case of an array, return
  // the last item.
  getStatePropertyValue(
      statePropertyValue: string[] | Object): string | Object {
    return Array.isArray(statePropertyValue) ?
      statePropertyValue[statePropertyValue.length - 1] : statePropertyValue;
  }

  isEndingExploration(): boolean {
    return this.oldValue === null &amp;&amp; this.newValue === &#x27;EndExploration&#x27;;
  }

  isAddingInteraction(): boolean {
    return this.oldValue === null &amp;&amp; this.newValue !== &#x27;EndExploration&#x27;;
  }

  isOldValueEmpty(): boolean {
    return this.utilsService.isEmpty(this.oldValue);
  }

  isNewValueEmpty(): boolean {
    return this.utilsService.isEmpty(this.newValue);
  }

  isOutcomeFeedbackEqual(): boolean {
    if ((&lt;LostChangeValues&gt; this.newValue).outcome &amp;&amp;
      (&lt;LostChangeValues&gt; this.newValue).outcome.feedback &amp;&amp;
      (&lt;LostChangeValues&gt; this.oldValue).outcome &amp;&amp;
      (&lt;LostChangeValues&gt; this.oldValue).outcome.feedback) {
      return (
        (&lt;LostChangeValues&gt; this.newValue).outcome.feedback.html ===
        (&lt;LostChangeValues&gt; this.oldValue).outcome.feedback.html);
    }
    return false;
  }

  isOutcomeDestEqual(): boolean {
    if ((&lt;LostChangeValues&gt; this.newValue).outcome &amp;&amp;
      (&lt;LostChangeValues&gt; this.oldValue).outcome) {
      return (
        (&lt;LostChangeValues&gt; this.oldValue).outcome.dest ===
        (&lt;LostChangeValues&gt; this.newValue).outcome.dest);
    }
    return false;
  }

  isDestEqual(): boolean {
    return (&lt;LostChangeValues&gt; this.oldValue).dest ===
      (&lt;LostChangeValues&gt; this.newValue).dest;
  }

  isFeedbackEqual(): boolean {
    if ((&lt;LostChangeValues&gt; this.newValue).feedback &amp;&amp;
    (&lt;LostChangeValues&gt; this.oldValue).feedback) {
      return (
        (&lt;LostChangeValues&gt; this.newValue).feedback.html ===
        (&lt;LostChangeValues&gt; this.oldValue).feedback.html);
    }
    return false;
  }

  isRulesEqual(): boolean {
    return isEqual(
      (&lt;LostChangeValues&gt; this.newValue).rules,
      (&lt;LostChangeValues&gt; this.oldValue).rules);
  }

  // Detects whether an object of the type &#x27;answer_group&#x27; or
  // &#x27;default_outcome&#x27; has been added, edited or deleted.
  // Returns - &#x27;addded&#x27;, &#x27;edited&#x27; or &#x27;deleted&#x27; accordingly.
  getRelativeChangeToGroups(): string {
    let result = &#x27;&#x27;;

    if (Array.isArray(this.newValue) &amp;&amp; Array.isArray(this.oldValue)) {
      if (this.newValue.length &gt; this.oldValue.length) {
        result = &#x27;added&#x27;;
      } else if (this.newValue.length === this.oldValue.length) {
        result = &#x27;edited&#x27;;
      } else {
        result = &#x27;deleted&#x27;;
      }
    } else {
      if (!this.utilsService.isEmpty(this.oldValue)) {
        if (!this.utilsService.isEmpty(this.newValue)) {
          result = &#x27;edited&#x27;;
        } else {
          result = &#x27;deleted&#x27;;
        }
      } else if (!this.utilsService.isEmpty(this.newValue)) {
        result = &#x27;added&#x27;;
      }
    }
    return result;
  }
}

@Injectable({
  providedIn: &#x27;root&#x27;
})
export class LostChangeObjectFactory {
  constructor(private utilsService: UtilsService) {
    // The createNew function needs to be binded because it&#x27;s used a lot in
    // calbacks and then `this` would refer to window instead of the service
    // itself.
    this.createNew = this.createNew.bind(this);
  }

  /**
   * @param {String} lostChangeDict - the name of the type to fetch.
   * @returns {LostChange} - The associated type, if any.
   */
  createNew(
      lostChangeDict: ExplorationChange | LostChangeBackendDict): LostChange {
    lostChangeDict = lostChangeDict as unknown as LostChangeBackendDict;
    return new LostChange(
      this.utilsService,
      lostChangeDict.cmd,
      lostChangeDict.new_state_name,
      lostChangeDict.old_state_name,
      lostChangeDict.state_name,
      lostChangeDict.new_value,
      lostChangeDict.old_value,
      lostChangeDict.property_name
    );
  }
}

angular.module(&#x27;oppia&#x27;).factory(
  &#x27;LostChangeObjectFactory&#x27;, downgradeInjectable(LostChangeObjectFactory));
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:111,&quot;character&quot;:9,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.newValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:112,&quot;character&quot;:7,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.newValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:113,&quot;character&quot;:7,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.oldValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:114,&quot;character&quot;:7,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.oldValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:116,&quot;character&quot;:9,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.newValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:117,&quot;character&quot;:9,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.oldValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:123,&quot;character&quot;:9,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.newValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:124,&quot;character&quot;:7,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.oldValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:126,&quot;character&quot;:9,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.oldValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:127,&quot;character&quot;:9,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.newValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:133,&quot;character&quot;:12,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.oldValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:134,&quot;character&quot;:7,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.newValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:138,&quot;character&quot;:9,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.newValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:139,&quot;character&quot;:5,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.oldValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:141,&quot;character&quot;:9,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.newValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:142,&quot;character&quot;:9,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.oldValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:149,&quot;character&quot;:7,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.newValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:150,&quot;character&quot;:7,&quot;text&quot;:&quot;&lt;LostChangeValues&gt; this.oldValue&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/domain/exploration/LostChangeObjectFactory.ts&quot;,&quot;line&quot;:199,&quot;character&quot;:21,&quot;text&quot;:&quot;lostChangeDict as unknown as LostChangeBackendDict&quot;,&quot;kind&quot;:3}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 17 Jun 2021 20:43:55 GMT</p>
    </body>
  </html>
  