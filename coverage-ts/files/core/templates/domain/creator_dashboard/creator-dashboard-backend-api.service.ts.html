
  <!DOCTYPE html>
  <html>
    <head>
      <title>creator-dashboard-backend-api.service.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="negative"><td class="">core/templates/domain/creator_dashboard/creator-dashboard-backend-api.service.ts</td><td class="">98.35%</td><td class="">100%</td><td class="">242</td><td class="">238</td><td class="">4</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">// Copyright 2015 The Oppia Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview Service to retrieve information of creator dashboard from the
 * backend.
 */

import { downgradeInjectable } from &#x27;@angular/upgrade/static&#x27;;
import { HttpClient } from &#x27;@angular/common/http&#x27;;
import { Injectable } from &#x27;@angular/core&#x27;;

import {
  CollectionSummary,
  CollectionSummaryBackendDict,
} from &#x27;domain/collection/collection-summary.model&#x27;;
import {
  CreatorDashboardStatsBackendDict,
  CreatorDashboardStats,
} from &#x27;domain/creator_dashboard/creator-dashboard-stats.model&#x27;;
import {
  CreatorExplorationSummary,
  CreatorExplorationSummaryBackendDict
} from &#x27;domain/summary/creator-exploration-summary.model&#x27;;
import {
  FeedbackThread,
  FeedbackThreadObjectFactory,
  FeedbackThreadBackendDict
} from &#x27;domain/feedback_thread/FeedbackThreadObjectFactory&#x27;;
import {
  SuggestionBackendDict,
  Suggestion,
} from &#x27;domain/suggestion/suggestion.model&#x27;;
import {
  ProfileSummary,
  SubscriberSummaryBackendDict,
} from &#x27;domain/user/profile-summary.model&#x27;;
import {
  SuggestionThread,
  SuggestionThreadObjectFactory
} from &#x27;domain/suggestion/SuggestionThreadObjectFactory&#x27;;
import {
  TopicSummary,
  TopicSummaryBackendDict
} from &#x27;domain/topic/topic-summary.model&#x27;;
import { LoggerService } from &#x27;services/contextual/logger.service&#x27;;
import { SuggestionsService } from
  &#x27;services/suggestions.service&#x27;;

interface CreatorDashboardDataBackendDict {
  &#x27;dashboard_stats&#x27;: CreatorDashboardStatsBackendDict;
  &#x27;last_week_stats&#x27;: CreatorDashboardStatsBackendDict;
  &#x27;display_preference&#x27;: &#x27;card&#x27; | &#x27;list&#x27;;
  &#x27;subscribers_list&#x27;: SubscriberSummaryBackendDict[];
  &#x27;threads_for_created_suggestions_list&#x27;: FeedbackThreadBackendDict[];
  &#x27;threads_for_suggestions_to_review_list&#x27;: FeedbackThreadBackendDict[];
  &#x27;created_suggestions_list&#x27;: SuggestionBackendDict[];
  &#x27;suggestions_to_review_list&#x27;: SuggestionBackendDict[];
  &#x27;explorations_list&#x27;: CreatorExplorationSummaryBackendDict[];
  &#x27;collections_list&#x27;: CollectionSummaryBackendDict[];
  &#x27;topic_summary_dicts&#x27;: TopicSummaryBackendDict[];
}

interface CreatorDashboardData {
  dashboardStats: CreatorDashboardStats;
  lastWeekStats: CreatorDashboardStats;
  displayPreference: &#x27;card&#x27; | &#x27;list&#x27;;
  subscribersList: ProfileSummary[];
  threadsForCreatedSuggestionsList: FeedbackThread[];
  threadsForSuggestionsToReviewList: FeedbackThread[];
  createdSuggestionsList: Suggestion[];
  suggestionsToReviewList: Suggestion[];
  createdSuggestionThreadsList: SuggestionThread[];
  suggestionThreadsToReviewList: SuggestionThread[];
  explorationsList: CreatorExplorationSummary[];
  collectionsList: CollectionSummary[];
  topicSummaries: TopicSummary[];
}

@Injectable({
  providedIn: &#x27;root&#x27;
})
export class CreatorDashboardBackendApiService {
  constructor(
    private http: HttpClient,
    private feedbackThreadObjectFactory: FeedbackThreadObjectFactory,
    private suggestionThreadObjectFactory: SuggestionThreadObjectFactory,
    private suggestionsService: SuggestionsService,
    private loggerService: LoggerService) {}

  _getSuggestionThreads(
      feedbackDicts: FeedbackThreadBackendDict[],
      suggestionDicts: SuggestionBackendDict[]): SuggestionThread[] {
    var numberOfSuggestions = feedbackDicts.length;
    var suggestionThreads: SuggestionThread[] = [];

    if (suggestionDicts.length !== numberOfSuggestions) {
      this.loggerService.error(
        &#x27;Number of suggestions does not match number of suggestion threads&#x27;);
    }

    for (var i = 0; i &lt; numberOfSuggestions; i++) {
      for (var j = 0; j &lt; numberOfSuggestions; j++) {
        var suggestionThreadId = this.suggestionsService
          .getThreadIdFromSuggestionBackendDict(suggestionDicts[j]);
        var threadDict = feedbackDicts[i];
        if (threadDict.thread_id === suggestionThreadId) {
          var suggestionThread = (
            this.suggestionThreadObjectFactory.createFromBackendDicts(
              threadDict, suggestionDicts[j]));
          suggestionThreads.push(suggestionThread);
        }
      }
    }

    return suggestionThreads;
  }

  async _fetchDashboardDataAsync(): Promise&lt;CreatorDashboardData&gt; {
    return this.http.get&lt;CreatorDashboardDataBackendDict&gt;(
      &#x27;/creatordashboardhandler/data&#x27;).toPromise().then(dashboardData =&gt; {
      return {
        dashboardStats: CreatorDashboardStats
          .createFromBackendDict(dashboardData.dashboard_stats),
        // Because lastWeekStats may be null.
        lastWeekStats: dashboardData.last_week_stats ? (
          CreatorDashboardStats
            .createFromBackendDict(dashboardData.last_week_stats)) : null,
        displayPreference: dashboardData.display_preference,
        subscribersList: dashboardData.subscribers_list.map(
          subscriber =&gt; ProfileSummary
            .createFromSubscriberBackendDict(subscriber)),
        threadsForCreatedSuggestionsList: (
          dashboardData.threads_for_created_suggestions_list.map(
            feedbackThread =&gt; this.feedbackThreadObjectFactory
              .createFromBackendDict(feedbackThread))),
        threadsForSuggestionsToReviewList: (
          dashboardData.threads_for_suggestions_to_review_list.map(
            feedbackThread =&gt; this.feedbackThreadObjectFactory
              .createFromBackendDict(feedbackThread))),
        createdSuggestionsList: (
          dashboardData.created_suggestions_list.map(
            suggestionDict =&gt; Suggestion.createFromBackendDict(
              suggestionDict))),
        suggestionsToReviewList: (
          dashboardData.suggestions_to_review_list.map(
            suggestionDict =&gt; Suggestion.createFromBackendDict(
              suggestionDict))),
        createdSuggestionThreadsList: this._getSuggestionThreads(
          dashboardData.threads_for_created_suggestions_list,
          dashboardData.created_suggestions_list),
        suggestionThreadsToReviewList: this._getSuggestionThreads(
          dashboardData.threads_for_suggestions_to_review_list,
          dashboardData.suggestions_to_review_list),
        explorationsList: dashboardData.explorations_list.map(
          expSummary =&gt; CreatorExplorationSummary
            .createFromBackendDict(expSummary)),
        collectionsList: dashboardData.collections_list.map(
          collectionSummary =&gt; CollectionSummary
            .createFromBackendDict(collectionSummary)),
        topicSummaries: (
          dashboardData.topic_summary_dicts ? (
            dashboardData.topic_summary_dicts.map(
              topicSummaryDict =&gt; TopicSummary.createFromBackendDict(
                topicSummaryDict))) : null)
      };
    }, errorResponse =&gt; {
      throw new Error(errorResponse.error.error);
    });
  }

  async fetchDashboardDataAsync(): Promise&lt;CreatorDashboardData&gt; {
    return this._fetchDashboardDataAsync();
  }
}

angular.module(&#x27;oppia&#x27;).factory(
  &#x27;CreatorDashboardBackendApiService&#x27;,
  downgradeInjectable(CreatorDashboardBackendApiService));
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;core/templates/domain/creator_dashboard/creator-dashboard-backend-api.service.ts&quot;,&quot;line&quot;:177,&quot;character&quot;:7,&quot;text&quot;:&quot;errorResponse&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/domain/creator_dashboard/creator-dashboard-backend-api.service.ts&quot;,&quot;line&quot;:178,&quot;character&quot;:22,&quot;text&quot;:&quot;errorResponse&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/domain/creator_dashboard/creator-dashboard-backend-api.service.ts&quot;,&quot;line&quot;:178,&quot;character&quot;:36,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;core/templates/domain/creator_dashboard/creator-dashboard-backend-api.service.ts&quot;,&quot;line&quot;:178,&quot;character&quot;:42,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 17 Jun 2021 20:43:55 GMT</p>
    </body>
  </html>
  