
  <!DOCTYPE html>
  <html>
    <head>
      <title>state-editor.service.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="negative"><td class="">core/templates/components/state-editor/state-editor-properties-services/state-editor.service.ts</td><td class="">98.63%</td><td class="">100%</td><td class="">365</td><td class="">360</td><td class="">5</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">// Copyright 2014 The Oppia Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview A service that maintains a record of the objects exclusive to
 * a state.
 */

import cloneDeep from &#x27;lodash/cloneDeep&#x27;;
import { Observable } from &#x27;rxjs&#x27;;

import { downgradeInjectable } from &#x27;@angular/upgrade/static&#x27;;
import { EventEmitter, Injectable } from &#x27;@angular/core&#x27;;

import { AnswerGroup } from
  &#x27;domain/exploration/AnswerGroupObjectFactory&#x27;;
import { Hint } from &#x27;domain/exploration/HintObjectFactory&#x27;;
import { SubtitledHtml } from
  &#x27;domain/exploration/subtitled-html.model&#x27;;
import {
  DragAndDropSortInputCustomizationArgs,
  ImageClickInputCustomizationArgs,
  InteractionCustomizationArgs,
  ItemSelectionInputCustomizationArgs,
  MultipleChoiceInputCustomizationArgs
} from &#x27;extensions/interactions/customization-args-defs&#x27;;
import { Interaction } from &#x27;domain/exploration/InteractionObjectFactory&#x27;;
import { Outcome } from &#x27;domain/exploration/OutcomeObjectFactory&#x27;;
import { Solution } from &#x27;domain/exploration/SolutionObjectFactory&#x27;;
import { SolutionValidityService } from
  &#x27;pages/exploration-editor-page/editor-tab/services/solution-validity.service&#x27;;
import { State } from &#x27;domain/state/StateObjectFactory&#x27;;

export interface AnswerChoice {
  val: string | number | SubtitledHtml;
  label: string;
}

@Injectable({
  providedIn: &#x27;root&#x27;
})
export class StateEditorService {
  constructor(private solutionValidityService: SolutionValidityService) {}

  private _stateEditorInitializedEventEmitter = new EventEmitter&lt;State&gt;();
  private _stateEditorDirectiveInitializedEventEmitter =
    new EventEmitter&lt;void&gt;();
  private _interactionEditorInitializedEventEmitter = new EventEmitter&lt;void&gt;();
  private _showTranslationTabBusyModalEventEmitter = new EventEmitter&lt;void&gt;();
  private _refreshStateTranslationEventEmitter = new EventEmitter&lt;void&gt;();
  private _updateAnswerChoicesEventEmitter = new EventEmitter&lt;AnswerChoice[]&gt;();
  private _saveOutcomeDestDetailsEventEmitter = new EventEmitter&lt;void&gt;();
  private _handleCustomArgsUpdateEventEmitter =
    new EventEmitter&lt;AnswerChoice[]&gt;();
  private _stateNamesChangedEventEmitter = new EventEmitter&lt;void&gt;();
  private _objectFormValidityChangeEventEmitter = new EventEmitter&lt;boolean&gt;();

  activeStateName: string = null;
  stateNames: string[] = [];
  correctnessFeedbackEnabled: boolean = null;
  inQuestionMode: boolean = null;
  // Currently, the only place where this is used in the state editor
  // is in solution verification. So, once the interaction is set in this
  // service, the given solutions would be automatically verified for the set
  // interaction.
  interaction: Interaction = null;
  misconceptionsBySkill: {} = {};
  linkedSkillId: string = null;
  explorationIsWhitelisted: boolean = false;
  solicitAnswerDetails: boolean = null;
  cardIsCheckpoint: boolean = null;
  stateContentEditorInitialised: boolean = false;
  stateInteractionEditorInitialised: boolean = false;
  stateResponsesInitialised: boolean = false;
  stateHintsEditorInitialised: boolean = false;
  stateSolutionEditorInitialised: boolean = false;
  stateEditorDirectiveInitialised: boolean = false;
  currentRuleInputIsValid: boolean = false;
  inapplicableSkillMisconceptionIds: string[] = [];

  updateStateContentEditorInitialised(): void {
    this.stateContentEditorInitialised = true;
  }

  updateStateInteractionEditorInitialised(): void {
    this.stateInteractionEditorInitialised = true;
  }

  updateStateResponsesInitialised(): void {
    this.stateResponsesInitialised = true;
  }

  updateStateHintsEditorInitialised(): void {
    this.stateHintsEditorInitialised = true;
  }

  updateStateSolutionEditorInitialised(): void {
    this.stateSolutionEditorInitialised = true;
  }

  updateStateEditorDirectiveInitialised(): void {
    this.stateEditorDirectiveInitialised = true;
  }

  updateCurrentRuleInputIsValid(value: boolean): void {
    this.currentRuleInputIsValid = value;
  }

  get onStateNamesChanged(): Observable&lt;void&gt; {
    return this._stateNamesChangedEventEmitter;
  }

  checkCurrentRuleInputIsValid(): boolean {
    return this.currentRuleInputIsValid;
  }

  checkEventListenerRegistrationStatus(): boolean {
    return (
      this.stateInteractionEditorInitialised &amp;&amp;
      this.stateResponsesInitialised &amp;&amp;
      this.stateEditorDirectiveInitialised);
  }

  getActiveStateName(): string {
    return this.activeStateName;
  }

  setActiveStateName(newActiveStateName: string): void {
    if (newActiveStateName === &#x27;&#x27; || newActiveStateName === null) {
      console.error(&#x27;Invalid active state name: &#x27; + newActiveStateName);
      return;
    }
    this.activeStateName = newActiveStateName;
  }

  isExplorationWhitelisted(): boolean {
    return this.explorationIsWhitelisted;
  }

  updateExplorationWhitelistedStatus(value: boolean): void {
    this.explorationIsWhitelisted = value;
  }

  setMisconceptionsBySkill(newMisconceptionsBySkill: {}): void {
    this.misconceptionsBySkill = newMisconceptionsBySkill;
  }

  getMisconceptionsBySkill(): {} {
    return this.misconceptionsBySkill;
  }

  setInteraction(newInteraction: Interaction): void {
    this.interaction = newInteraction;
  }

  setInteractionId(newId: string): void {
    this.interaction.setId(newId);
  }

  setLinkedSkillId(newLinkedSkillId: string): void {
    this.linkedSkillId = newLinkedSkillId;
  }

  getLinkedSkillId(): string {
    return this.linkedSkillId;
  }

  setInteractionAnswerGroups(newAnswerGroups: AnswerGroup[]): void {
    this.interaction.setAnswerGroups(newAnswerGroups);
  }

  setInteractionDefaultOutcome(newOutcome: Outcome): void {
    this.interaction.setDefaultOutcome(newOutcome);
  }

  setInteractionCustomizationArgs(
      newArgs: InteractionCustomizationArgs): void {
    this.interaction.setCustomizationArgs(newArgs);
  }

  setInteractionSolution(solution: Solution): void {
    this.interaction.setSolution(solution);
  }

  setInteractionHints(hints: Hint[]): void {
    this.interaction.setHints(hints);
  }

  getInteraction(): Interaction {
    return cloneDeep(this.interaction);
  }

  getAnswerChoices(
      interactionId: string,
      customizationArgs: InteractionCustomizationArgs): AnswerChoice[] {
    if (!interactionId) {
      return null;
    }
    // Special cases for multiple choice input and image click input.
    if (interactionId === &#x27;MultipleChoiceInput&#x27;) {
      return (&lt;MultipleChoiceInputCustomizationArgs&gt; customizationArgs)
        .choices.value.map((val, ind) =&gt; ({ val: ind, label: val.html }));
    } else if (interactionId === &#x27;ImageClickInput&#x27;) {
      var _answerChoices = [];
      var imageWithRegions = (
        &lt;ImageClickInputCustomizationArgs&gt; customizationArgs)
        .imageAndRegions.value;
      for (
        var j = 0; j &lt; imageWithRegions.labeledRegions.length; j++) {
        _answerChoices.push({
          val: imageWithRegions.labeledRegions[j].label,
          label: imageWithRegions.labeledRegions[j].label
        });
      }
      return _answerChoices;
    } else if (
      interactionId === &#x27;ItemSelectionInput&#x27; ||
      interactionId === &#x27;DragAndDropSortInput&#x27;
    ) {
      return (
        &lt;
          ItemSelectionInputCustomizationArgs|
          DragAndDropSortInputCustomizationArgs
        &gt; customizationArgs)
        .choices.value.map(val =&gt; (
          { val: val.contentId, label: val.html}
        ));
    } else {
      return null;
    }
  }

  setInQuestionMode(newModeValue: boolean): void {
    this.inQuestionMode = newModeValue;
  }

  isInQuestionMode(): boolean {
    return this.inQuestionMode;
  }

  setCorrectnessFeedbackEnabled(newCorrectnessFeedbackEnabled: boolean): void {
    this.correctnessFeedbackEnabled = newCorrectnessFeedbackEnabled;
  }

  getCorrectnessFeedbackEnabled(): boolean {
    return this.correctnessFeedbackEnabled;
  }

  setSolicitAnswerDetails(newSolicitAnswerDetails: boolean): void {
    this.solicitAnswerDetails = newSolicitAnswerDetails;
  }

  getSolicitAnswerDetails(): boolean {
    return this.solicitAnswerDetails;
  }

  setCardIsCheckpoint(newCardIsCheckpoint: boolean): void {
    this.cardIsCheckpoint = newCardIsCheckpoint;
  }

  getCardIsCheckpoint(): boolean {
    return this.cardIsCheckpoint;
  }

  setStateNames(newStateNames: string[]): void {
    this.stateNames = newStateNames;
    this._stateNamesChangedEventEmitter.emit();
  }

  getStateNames(): string[] {
    return this.stateNames;
  }

  setInapplicableSkillMisconceptionIds(
      newInapplicableSkillMisconceptionIds: string[]): void {
    this.inapplicableSkillMisconceptionIds = (
      newInapplicableSkillMisconceptionIds);
  }

  getInapplicableSkillMisconceptionIds(): string[] {
    return this.inapplicableSkillMisconceptionIds;
  }

  isCurrentSolutionValid(): boolean {
    return this.solutionValidityService.isSolutionValid(this.activeStateName);
  }

  deleteCurrentSolutionValidity(): void {
    this.solutionValidityService.deleteSolutionValidity(this.activeStateName);
  }

  get onStateEditorInitialized(): EventEmitter&lt;State&gt; {
    return this._stateEditorInitializedEventEmitter;
  }

  get onStateEditorDirectiveInitialized(): EventEmitter&lt;void&gt; {
    return this._stateEditorDirectiveInitializedEventEmitter;
  }

  get onInteractionEditorInitialized(): EventEmitter&lt;void&gt; {
    return this._interactionEditorInitializedEventEmitter;
  }

  get onShowTranslationTabBusyModal(): EventEmitter&lt;void&gt; {
    return this._showTranslationTabBusyModalEventEmitter;
  }

  get onRefreshStateTranslation(): EventEmitter&lt;void&gt; {
    return this._refreshStateTranslationEventEmitter;
  }

  get onUpdateAnswerChoices(): EventEmitter&lt;AnswerChoice[]&gt; {
    return this._updateAnswerChoicesEventEmitter;
  }

  get onSaveOutcomeDestDetails(): EventEmitter&lt;void&gt; {
    return this._saveOutcomeDestDetailsEventEmitter;
  }

  get onHandleCustomArgsUpdate(): EventEmitter&lt;AnswerChoice[]&gt; {
    return this._handleCustomArgsUpdateEventEmitter;
  }

  get onObjectFormValidityChange(): EventEmitter&lt;boolean&gt; {
    return this._objectFormValidityChangeEventEmitter;
  }
}

angular.module(&#x27;oppia&#x27;).factory(
  &#x27;StateEditorService&#x27;, downgradeInjectable(StateEditorService));
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;core/templates/components/state-editor/state-editor-properties-services/state-editor.service.ts&quot;,&quot;line&quot;:211,&quot;character&quot;:14,&quot;text&quot;:&quot;&lt;MultipleChoiceInputCustomizationArgs&gt; customizationArgs&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/components/state-editor/state-editor-properties-services/state-editor.service.ts&quot;,&quot;line&quot;:214,&quot;character&quot;:10,&quot;text&quot;:&quot;_answerChoices&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;core/templates/components/state-editor/state-editor-properties-services/state-editor.service.ts&quot;,&quot;line&quot;:216,&quot;character&quot;:8,&quot;text&quot;:&quot;&lt;ImageClickInputCustomizationArgs&gt; customizationArgs&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;core/templates/components/state-editor/state-editor-properties-services/state-editor.service.ts&quot;,&quot;line&quot;:220,&quot;character&quot;:8,&quot;text&quot;:&quot;_answerChoices&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;core/templates/components/state-editor/state-editor-properties-services/state-editor.service.ts&quot;,&quot;line&quot;:231,&quot;character&quot;:8,&quot;text&quot;:&quot;&lt;\n          ItemSelectionInputCustomizationArgs|\n          DragAndDropSortInputCustomizationArgs\n        &gt; customizationArgs&quot;,&quot;kind&quot;:4}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 17 Jun 2021 20:43:55 GMT</p>
    </body>
  </html>
  