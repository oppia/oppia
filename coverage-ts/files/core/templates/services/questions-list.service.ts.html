
  <!DOCTYPE html>
  <html>
    <head>
      <title>questions-list.service.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">core/templates/services/questions-list.service.ts</td><td class="">100.00%</td><td class="">100%</td><td class="">168</td><td class="">168</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">// Copyright 2019 The Oppia Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview Service to fetch questions and returns questions to the
 * questions list in editors.
 */

import { downgradeInjectable } from &#x27;@angular/upgrade/static&#x27;;
import { Injectable } from &#x27;@angular/core&#x27;;

import { AppConstants } from &#x27;app.constants&#x27;;
import { EventEmitter } from &#x27;@angular/core&#x27;;
import { FormatRtePreviewPipe } from &#x27;filters/format-rte-preview.pipe&#x27;;
import { QuestionBackendApiService } from
  &#x27;domain/question/question-backend-api.service&#x27;;
import { QuestionSummaryForOneSkill } from
  &#x27;domain/question/question-summary-for-one-skill-object.model&#x27;;
import { TruncatePipe } from &#x27;filters/string-utility-filters/truncate.pipe&#x27;;

@Injectable({
  providedIn: &#x27;root&#x27;
})
export class QuestionsListService {
  private _questionSummariesForOneSkill: QuestionSummaryForOneSkill[] = [];
  private _nextOffsetForQuestions: number = 0;
  // Whether there are more questions available to fetch.
  private _moreQuestionsAvailable: boolean = true;
  private _currentPage: number = 0;
  private _questionSummartiesInitializedEventEmitter: EventEmitter&lt;void&gt; = (
    new EventEmitter&lt;void&gt;());

  constructor(
    private formatRtePreviewPipe: FormatRtePreviewPipe,
    private questionBackendApiService: QuestionBackendApiService,
    private truncatePipe: TruncatePipe) {}

  private _setQuestionSummariesForOneSkill(
      newQuestionSummaries: QuestionSummaryForOneSkill[],
      resetHistory: boolean): void {
    if (resetHistory) {
      this._questionSummariesForOneSkill = [];
    }

    this._questionSummariesForOneSkill = (
      this._questionSummariesForOneSkill.concat(newQuestionSummaries));

    this._questionSummartiesInitializedEventEmitter.emit();
  }

  private _changeNextQuestionsOffset(resetHistory: boolean): void {
    if (resetHistory) {
      this._nextOffsetForQuestions = 0;
    }
    this._nextOffsetForQuestions += AppConstants.NUM_QUESTIONS_PER_PAGE;
  }

  private _setMoreQuestionsAvailable(moreQuestionsAvailable: boolean): void {
    this._moreQuestionsAvailable = moreQuestionsAvailable;
  }

  isLastQuestionBatch(): boolean {
    return (
      this._moreQuestionsAvailable === false &amp;&amp;
      (this._currentPage + 1) * AppConstants.NUM_QUESTIONS_PER_PAGE &gt;=
        this._questionSummariesForOneSkill.length);
  }

  getQuestionSummariesAsync(
      skillId: string, fetchMore: boolean, resetHistory: boolean): void {
    if (resetHistory) {
      this._questionSummariesForOneSkill = [];
      this._nextOffsetForQuestions = 0;
      this._moreQuestionsAvailable = true;
    }

    const num = AppConstants.NUM_QUESTIONS_PER_PAGE;

    if (!skillId) {
      return;
    }

    if (
      (this._currentPage + 1) * num &gt;
       this._questionSummariesForOneSkill.length &amp;&amp;
       this._moreQuestionsAvailable === true &amp;&amp; fetchMore) {
      this.questionBackendApiService.fetchQuestionSummariesAsync(
        skillId, this._nextOffsetForQuestions).then(response =&gt; {
        let questionSummaries = response.questionSummaries.map(summary =&gt; {
          return (
            QuestionSummaryForOneSkill.
              createFromBackendDict(summary));
        });

        this._changeNextQuestionsOffset(resetHistory);
        this._setMoreQuestionsAvailable(response.more);
        this._setQuestionSummariesForOneSkill(
          questionSummaries, resetHistory);
      });
    }
  }

  getCachedQuestionSummaries(): QuestionSummaryForOneSkill[] {
    const num = AppConstants.NUM_QUESTIONS_PER_PAGE;

    return this._questionSummariesForOneSkill.slice(
      this._currentPage * num, (this._currentPage + 1) * num).map(question =&gt; {
      const summary = this.formatRtePreviewPipe.transform(
        question.getQuestionSummary().getQuestionContent());

      question.getQuestionSummary().setQuestionContent(
        this.truncatePipe.transform(summary, 100));

      return question;
    });
  }

  incrementPageNumber(): void {
    this._currentPage++;
  }

  decrementPageNumber(): void {
    this._currentPage--;
  }

  resetPageNumber(): void {
    this._currentPage = 0;
  }

  getCurrentPageNumber(): number {
    return this._currentPage;
  }

  get onQuestionSummariesInitialized(): EventEmitter&lt;void&gt; {
    return this._questionSummartiesInitializedEventEmitter;
  }
}

angular.module(&#x27;oppia&#x27;).factory(
  &#x27;QuestionsListService&#x27;,
  downgradeInjectable(QuestionsListService));
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 17 Jun 2021 20:43:56 GMT</p>
    </body>
  </html>
  