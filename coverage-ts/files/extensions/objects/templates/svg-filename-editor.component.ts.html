
  <!DOCTYPE html>
  <html>
    <head>
      <title>svg-filename-editor.component.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="negative"><td class="">extensions/objects/templates/svg-filename-editor.component.ts</td><td class="">91.93%</td><td class="">100%</td><td class="">2924</td><td class="">2688</td><td class="">236</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">// Copyright 2020 The Oppia Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

/**
 * @fileoverview Component for svg filename editor.
 */

import { ChangeDetectorRef, Component, EventEmitter, Input, OnInit, Output } from &#x27;@angular/core&#x27;;
import { SafeResourceUrl } from &#x27;@angular/platform-browser&#x27;;
import { downgradeComponent } from &#x27;@angular/upgrade/static&#x27;;
import { AppConstants } from &#x27;app.constants&#x27;;
import { fabric } from &#x27;fabric&#x27;;
import { ImagePreloaderService } from &#x27;pages/exploration-player-page/services/image-preloader.service&#x27;;
import { AlertsService } from &#x27;services/alerts.service&#x27;;
import { AssetsBackendApiService } from &#x27;services/assets-backend-api.service&#x27;;
import { ContextService } from &#x27;services/context.service&#x27;;
import { DeviceInfoService } from &#x27;services/contextual/device-info.service&#x27;;
import { ImageLocalStorageService } from &#x27;services/image-local-storage.service&#x27;;
import { ImageUploadHelperService } from &#x27;services/image-upload-helper.service&#x27;;
import { SvgSanitizerService } from &#x27;services/svg-sanitizer.service&#x27;;
import Picker from &#x27;vanilla-picker&#x27;;
import { SvgFileFetcherBackendApiService } from &#x27;./svg-file-fetcher-backend-api.service&#x27;;
import { SvgFilenameEditorConstants } from &#x27;./svg-filename-editor.constants&#x27;;

export interface Dimensions {
  height: number;
  width: number;
}

export class PolyPoint {
  constructor(
    public x: number,
    public y: number
  ) {}
}

@Component({
  selector: &#x27;svg-filename-editor&#x27;,
  templateUrl: &#x27;./svg-filename-editor.component.html&#x27;
})
export class SvgFilenameEditorComponent implements OnInit {
  @Input() value;
  @Output() valueChanged = new EventEmitter();
  // These constants are used to identify the tool that is currently being
  // used so that other tools can be disabled accordingly.
  STATUS_EDITING = &#x27;editing&#x27;;
  STATUS_SAVED = &#x27;saved&#x27;;
  DRAW_MODE_POLY = &#x27;polygon&#x27;;
  DRAW_MODE_PENCIL = &#x27;pencil&#x27;;
  DRAW_MODE_BEZIER = &#x27;bezier&#x27;;
  DRAW_MODE_PIECHART = &#x27;piechart&#x27;;
  DRAW_MODE_SVG_UPLOAD = &#x27;svgupload&#x27;;
  DRAW_MODE_NONE = &#x27;none&#x27;;
  OPEN_POLYGON_MODE = &#x27;open&#x27;;
  CLOSED_POLYGON_MODE = &#x27;closed&#x27;;
  // The canvas height and width were determined based on the initial
  // modal dimensions.
  CANVAS_WIDTH = 494;
  CANVAS_HEIGHT = 368;
  drawMode = this.DRAW_MODE_NONE;
  polygonMode = this.CLOSED_POLYGON_MODE;
  isTouchDevice = this.deviceInfoService.hasTouchEvents();
  // The polyOptions is used to store the points of the polygon in the
  // open and closed polygon tool.
  polyOptions = {
    x: 0,
    y: 0,
    bboxPoints: [],
    lines: [],
    lineCounter: 0,
    shape: null
  };
  // These sizes are used in the strokeWidth options dropdown.
  sizes = [
    &#x27;1px&#x27;, &#x27;2px&#x27;, &#x27;3px&#x27;, &#x27;5px&#x27;, &#x27;9px&#x27;, &#x27;10px&#x27;, &#x27;12px&#x27;,
    &#x27;14px&#x27;, &#x27;18px&#x27;, &#x27;24px&#x27;, &#x27;30px&#x27;, &#x27;36px&#x27;];
  // These fonts are used in the font family options dropdown.
  fontFamily = [
    &#x27;Arial&#x27;,
    &#x27;Helvetica&#x27;,
    &#x27;Myriad Pro&#x27;,
    &#x27;Delicious&#x27;,
    &#x27;Verdana&#x27;,
    &#x27;Georgia&#x27;,
    &#x27;Courier&#x27;,
    &#x27;Comic Sans MS&#x27;,
    &#x27;Impact&#x27;,
    &#x27;Monaco&#x27;,
    &#x27;Optima&#x27;,
    &#x27;Plaster&#x27;,
    &#x27;Engagement&#x27;
  ];
  // Dynamically assign a unique id to each lc editor to avoid clashes
  // when there are multiple RTEs in the same page.
  randomId = Math.floor(Math.random() * 100000).toString();
  // The canvasId is used to identify the fabric js
  // canvas element in the editor.
  canvasID = &#x27;canvas&#x27; + this.randomId;
  // The following picker variables are used to store the objects returned
  // from the vanilla color picker.
  fillPicker = null;
  strokePicker = null;
  bgPicker = null;
  diagramWidth = 450;
  currentDiagramWidth = 450;
  diagramHeight = 350;
  currentDiagramHeight = 350;
  // The data variable is used to store the saved svg data
  // and the filename.
  data: {
    savedSvgUrl?: SafeResourceUrl | string,
    savedSvgFileName?: string;
  } = {};
  // The diagramStatus stores the mode of the tool that is being used.
  diagramStatus = this.STATUS_EDITING;
  displayFontStyles = false;
  objectUndoStack = [];
  objectRedoStack = [];
  canvasObjects = [];
  undoFlag = false;
  isRedo = false;
  undoLimit = 5;
  savedSvgDiagram = &#x27;&#x27;;
  entityId = this.contextService.getEntityId();
  entityType = this.contextService.getEntityType();
  imageSaveDestination = this.contextService.getImageSaveDestination();
  svgContainerStyle = {};
  layerNum = 0;
  fabricjsOptions = {
    stroke: &#x27;rgba(0, 0, 0, 1)&#x27;,
    fill: &#x27;rgba(0, 0, 0, 0)&#x27;,
    bg: &#x27;rgba(0, 0, 0, 0)&#x27;,
    fontFamily: &#x27;Helvetica&#x27;,
    size: &#x27;3px&#x27;,
    bold: false,
    italic: false
  };
  objectIsSelected = false;
  pieChartDataLimit = 10;
  groupCount = 0;
  pieChartDataInput = [{
    name: &#x27;Data name 1&#x27;,
    data: 10,
    color: &#x27;#ff0000&#x27;,
    angle: 0
  },
  {
    name: &#x27;Data name 2&#x27;,
    data: 10,
    color: &#x27;#00ff00&#x27;,
    angle: 0
  }];
  allowedImageFormats = [&#x27;svg&#x27;];
  uploadedSvgDataUrl: {
    safeUrl: SafeResourceUrl,
    unsafeUrl: string
  } = null;
  loadType = &#x27;group&#x27;;
  defaultTopCoordinate = 50;
  defaultLeftCoordinate = 50;
  defaultRadius = 30;

  canvas: fabric.Canvas;
  filepath: string;
  loadingIndicatorIsShown: boolean;
  x: number;
  y: number;
  constructor(
    private alertsService: AlertsService,
    private assetsBackendApiService: AssetsBackendApiService,
    private changeDetectorRef: ChangeDetectorRef,
    private contextService: ContextService,
    private deviceInfoService: DeviceInfoService,
    private imageLocalStorageService: ImageLocalStorageService,
    private imagePreloaderService: ImagePreloaderService,
    private imageUploadHelperService: ImageUploadHelperService,
    private svgFileFetcherBackendApiService: SvgFileFetcherBackendApiService,
    private svgSanitizerService: SvgSanitizerService) { }

  ngOnInit(): void {
    const domReady = new Promise((resolve, reject) =&gt; {
      if (document.readyState === &#x27;loading&#x27;) {
        document.addEventListener(&#x27;DOMContentLoaded&#x27;, resolve);
      } else {
        resolve(0);
      }
    });
    if (this.value) {
      this.setSavedSvgFilename(this.value, true);
      var dimensions = (
        this.imagePreloaderService.getDimensionsOfImage(this.value));
      this.svgContainerStyle = {
        height: dimensions.height + &#x27;px&#x27;,
        width: dimensions.width + &#x27;px&#x27;
      };
    } else {
      domReady.then(() =&gt; {
        this.initializeFabricJs();
        this.changeDetectorRef.detectChanges();
      });
    }
  }

  onWidthInputBlur(): void {
    if (this.diagramWidth &gt; SvgFilenameEditorConstants.MAX_SVG_DIAGRAM_WIDTH) {
      this.diagramWidth = SvgFilenameEditorConstants.MAX_SVG_DIAGRAM_WIDTH;
    } else if (
      this.diagramWidth &lt; SvgFilenameEditorConstants.MIN_SVG_DIAGRAM_WIDTH) {
      this.diagramWidth = SvgFilenameEditorConstants.MIN_SVG_DIAGRAM_WIDTH;
    }
    this.currentDiagramWidth = this.diagramWidth;
  }

  onHeightInputBlur(): void {
    if (
      this.diagramHeight &gt; SvgFilenameEditorConstants.MAX_SVG_DIAGRAM_HEIGHT) {
      this.diagramHeight = SvgFilenameEditorConstants.MAX_SVG_DIAGRAM_HEIGHT;
    } else if (
      this.diagramHeight &lt; SvgFilenameEditorConstants.MIN_SVG_DIAGRAM_HEIGHT) {
      this.diagramHeight = SvgFilenameEditorConstants.MIN_SVG_DIAGRAM_HEIGHT;
    }
    this.currentDiagramHeight = this.diagramHeight;
  }

  isDiagramCreated(): boolean {
    // This function checks if any shape has been created or not.
    return Boolean(
      !this.isUserDrawing() &amp;&amp;
      this.diagramStatus === this.STATUS_EDITING &amp;&amp;
      this.canvas &amp;&amp; this.canvas.getObjects().length &gt; 0);
  }

  isUserDrawing(): boolean {
    return Boolean(this.canvas &amp;&amp; this.drawMode !== this.DRAW_MODE_NONE);
  }

  private getTrustedResourceUrlForSvgFileName(
      svgFileName: string): {
        safeUrl: SafeResourceUrl | string, unsafeUrl: string} {
    if (
      this.imageSaveDestination ===
      AppConstants.IMAGE_SAVE_DESTINATION_LOCAL_STORAGE &amp;&amp; (
        this.imageLocalStorageService.isInStorage(svgFileName))) {
      const imageUrl = this.imageLocalStorageService.getRawImageData(
        svgFileName);
      return {
        safeUrl: this.svgSanitizerService.getTrustedSvgResourceUrl(imageUrl),
        unsafeUrl: imageUrl
      };
    }
    const encodedFilepath = window.encodeURIComponent(svgFileName);
    const imageUrl = this.assetsBackendApiService.getImageUrlForPreview(
      this.entityType, this.entityId, encodedFilepath);
    return {
      safeUrl: imageUrl,
      unsafeUrl: imageUrl
    };
  }

  setSavedSvgFilename(filename: string, setData: boolean): void {
    this.diagramStatus = this.STATUS_SAVED;
    // Reset fabric js parameters.
    this.onClear();
    this.data = {
      savedSvgFileName: filename,
      savedSvgUrl: this.getTrustedResourceUrlForSvgFileName(filename).safeUrl
    };
    this.value = filename;
    this.valueChanged.emit(this.value);
    if (setData) {
      const dimensions = (
        this.imagePreloaderService.getDimensionsOfImage(filename));
      this.svgContainerStyle = {
        height: dimensions.height + &#x27;px&#x27;,
        width: dimensions.width + &#x27;px&#x27;
      };
      this.diagramWidth = dimensions.width;
      this.diagramHeight = dimensions.height;
      this.svgFileFetcherBackendApiService.fetchSvg(
        this.data.savedSvgUrl as string
      ).subscribe(
        response =&gt; {
          this.savedSvgDiagram = response;
        }
      );
    }
  }

  postSvgToServer(
      dimensions: Dimensions,
      resampledFile: Blob
  ): Promise&lt;{filename: string}&gt; {
    return this.svgFileFetcherBackendApiService.postSvgFile(
      resampledFile, dimensions, this.entityType, this.entityId).toPromise();
  }

  saveImageToLocalStorage(
      dimensions: Dimensions,
      resampledFile: Blob
  ): void {
    const filename = this.imageUploadHelperService.generateImageFilename(
      dimensions.height, dimensions.width, &#x27;svg&#x27;);
    const reader = new FileReader();
    reader.onload = () =&gt; {
      const imageData = reader.result as string;
      this.imageLocalStorageService.saveImage(filename, imageData);
      const img = new Image();
      img.onload = () =&gt; {
        this.setSavedSvgFilename(filename, false);
        const dimensions = (
          this.imagePreloaderService.getDimensionsOfImage(filename));
        this.svgContainerStyle = {
          height: dimensions.height + &#x27;px&#x27;,
          width: dimensions.width + &#x27;px&#x27;
        };
      };
      img.src = this.getTrustedResourceUrlForSvgFileName(filename).unsafeUrl;
    };
    reader.readAsDataURL(resampledFile);
  }

  getSvgString(): string {
    const svgString = this.canvas.toSVG().replace(&#x27;\t\t&#x27;, &#x27;&#x27;);
    const domParser = new DOMParser();
    const doc = domParser.parseFromString(svgString, &#x27;text/xml&#x27;);
    const svg = doc.querySelector(&#x27;svg&#x27;);
    svg.removeAttribute(&#x27;xml:space&#x27;);
    const textTags = doc.querySelectorAll(&#x27;text&#x27;);
    textTags.forEach((obj) =&gt; {
      obj.removeAttribute(&#x27;xml:space&#x27;);
    });
    const elements = svg.querySelectorAll(&#x27;*&#x27;);
    // Fabric js adds vector-effect as an attribute which is not part of
    // the svg attribute whitelist, so here it is removed
    // and added as part of the style attribute.
    for (let i = 0; i &lt; elements.length; i++) {
      if (
        elements[i].getAttributeNames().indexOf(&#x27;vector-effect&#x27;) !== -1) {
        elements[i].removeAttribute(&#x27;vector-effect&#x27;);
        let style = elements[i].getAttribute(&#x27;style&#x27;);
        style += &#x27; vector-effect: non-scaling-stroke&#x27;;
        elements[i].setAttribute(&#x27;style&#x27;, style);
      }
    }
    return svg.outerHTML;
  }

  isSvgTagValid(svgString: string): true {
    const dataURI = (
      &#x27;data:image/svg+xml;base64,&#x27; +
      btoa(unescape(encodeURIComponent(svgString))));
    const invalidTagsAndAttr = (
      this.svgSanitizerService.getInvalidSvgTagsAndAttrsFromDataUri(dataURI));
    if (invalidTagsAndAttr.tags.length !== 0) {
      const errorText = (
        &#x27;Invalid tags in svg:&#x27; + invalidTagsAndAttr.tags.join());
      throw new Error(errorText);
    } else if (invalidTagsAndAttr.attrs.length !== 0) {
      const errorText = (
        &#x27;Invalid attributes in svg:&#x27; + invalidTagsAndAttr.attrs.join());
      throw new Error(errorText);
    }
    return true;
  }

  saveSvgFile(): void {
    this.alertsService.clearWarnings();

    if (!this.isDiagramCreated()) {
      this.alertsService.addWarning(&#x27;Custom Diagram not created.&#x27;);
      return;
    }

    const svgString = this.getSvgString();
    const svgDataURI = (
      &#x27;data:image/svg+xml;base64,&#x27; +
      btoa(unescape(encodeURIComponent(svgString))));
    const dimensions: Dimensions = {
      width: this.diagramWidth,
      height: this.diagramHeight,
    };
    let resampledFile: Blob;

    if (this.isSvgTagValid(svgString)) {
      this.savedSvgDiagram = svgString;
      resampledFile = (
        this.imageUploadHelperService.convertImageDataToImageFile(
          svgDataURI));
      if (
        this.imageSaveDestination ===
        AppConstants.IMAGE_SAVE_DESTINATION_LOCAL_STORAGE
      ) {
        this.saveImageToLocalStorage(dimensions, resampledFile);
      } else {
        this.loadingIndicatorIsShown = true;
        this.postSvgToServer(
          dimensions, resampledFile).then((data) =&gt; {
          // Pre-load image before marking the image as saved.
          const img = new Image();
          img.onload = () =&gt; {
            this.setSavedSvgFilename(data.filename, false);
            var dimensions = (
              this.imagePreloaderService.getDimensionsOfImage(data.filename));
            this.svgContainerStyle = {
              height: dimensions.height + &#x27;px&#x27;,
              width: dimensions.width + &#x27;px&#x27;
            };
            this.loadingIndicatorIsShown = false;
          };
          img.src = this.getTrustedResourceUrlForSvgFileName(
            data.filename).unsafeUrl;
        }, (parsedResponse) =&gt; {
          this.loadingIndicatorIsShown = false;
          this.alertsService.addWarning(
            parsedResponse.error.error || &#x27;Error communicating with server.&#x27;);
        });
      }
    }
  }

  isDiagramSaved(): boolean {
    return this.diagramStatus === this.STATUS_SAVED;
  }

  createCustomToSVG(
      toSVG: () =&gt; string, selector: string, id: string, ctx: unknown
  ): () =&gt; string {
    return (): string =&gt; {
      const svgString = toSVG.call(ctx);
      const domParser = new DOMParser();
      const doc = domParser.parseFromString(svgString, &#x27;image/svg+xml&#x27;);
      const parentG = doc.querySelector(selector);
      parentG.setAttribute(&#x27;id&#x27;, id);
      return doc.documentElement.outerHTML;
    };
  }

  loadGroupedObject(
      objId: string,
      obj: fabric.Object,
      groupedObjects: fabric.Object[][]
  ): fabric.Object[][] {
    // Checks if the id starts with &#x27;group&#x27; to identify whether the
    // svg objects are grouped together.
    if (objId.startsWith(&#x27;group&#x27;)) {
      // The objId is of the form &quot;group&quot; + number.
      const GROUP_ID_PREFIX_LENGTH = 5;
      const groupId = parseInt(objId.slice(GROUP_ID_PREFIX_LENGTH));
      // Checks whether the object belongs to an already existing group
      // or not.
      if (groupedObjects.length &lt;= groupId) {
        groupedObjects.push([]);
      }
      obj.toSVG = this.createCustomToSVG(
        obj.toSVG, obj.type, (obj as unknown as {id: string}).id, obj);
      groupedObjects[groupId].push(obj);
    }
    return groupedObjects;
  }

  loadTextObject(
      element: Element,
      obj: fabric.Object
  ): void {
    const childNodes = [].slice.call(element.childNodes);
    let value = &#x27;&#x27;;
    const coloredTextIndex = [];
    // Extracts the text from the tspan tags and appends
    // with a \n tag to ensure that the texts are subsequent lines.
    childNodes.forEach((el, index) =&gt; {
      if (el.nodeName === &#x27;tspan&#x27;) {
        value += el.childNodes[0].nodeValue;
        if (el.style.fill !== &#x27;&#x27;) {
          // Fetches the position of the coloured text so
          // it can be given color after the text is rendered.
          coloredTextIndex.push({
            startIndex: (
              value.length - el.childNodes[0].nodeValue.length),
            endIndex: value.length,
            fill: el.style.fill,
            stroke: el.style.stroke,
            strokeWidth: el.style.strokeWidth
          });
        } else if (index &lt; childNodes.length - 1) {
          value += &#x27;\n&#x27;;
        }
      }
    });

    value = (
      obj[&#x27;text-transform&#x27;] === &#x27;uppercase&#x27; ?
      value.toUpperCase() : value);

    obj.set({
      text: value,
    } as unknown);
    var text = new fabric.Textbox(
      (obj as unknown as {text: string}).text,
      obj.toObject()
    );
    text.set({
      type: &#x27;textbox&#x27;,
      strokeUniform: true,
    });
    // The text moves to the right every time the svg is
    // rendered so this is to ensure that the text doesn&#x27;t
    // render outside the canvas.
    // https://github.com/fabricjs/fabric.js/issues/1280
    if (text.left &gt; this.CANVAS_WIDTH) {
      text.set({
        left: this.CANVAS_WIDTH
      });
    }
    coloredTextIndex.forEach((obj) =&gt; {
      text.setSelectionStart(obj.startIndex);
      text.setSelectionEnd(obj.endIndex);
      text.setSelectionStyles({
        stroke: obj.stroke,
        strokeWidth: obj.strokeWidth,
        fill: obj.fill
      });
    });
    this.canvas.add(text);
  }

  isFullRectangle(element: SVGRectElement): boolean {
    return (
      element.width.baseVal.valueAsString === &#x27;100%&#x27; &amp;&amp;
      element.height.baseVal.valueAsString === &#x27;100%&#x27;);
  }

  continueDiagramEditing(): void {
    if (
      this.data.savedSvgFileName &amp;&amp;
      this.imageSaveDestination === (
        AppConstants.IMAGE_SAVE_DESTINATION_LOCAL_STORAGE)
    ) {
      this.imageLocalStorageService.deleteImage(this.data.savedSvgFileName);
    }
    this.diagramStatus = this.STATUS_EDITING;
    this.data = {};
    const domReady = new Promise((resolve, reject) =&gt; {
      if (document.readyState === &#x27;loading&#x27;) {
        document.addEventListener(&#x27;DOMContentLoaded&#x27;, resolve);
      } else {
        resolve(0);
      }
    });
    this.changeDetectorRef.detectChanges();
    domReady.then(() =&gt; {
      this.initializeFabricJs();
      fabric.loadSVGFromString(
        this.savedSvgDiagram, ((objects, options, elements) =&gt; {
          let groupedObjects = [];
          objects.forEach((obj, index) =&gt; {
            const objId = elements[index].id;
            if (objId !== &#x27;&#x27;) {
              groupedObjects = this.loadGroupedObject(
                objId, obj, groupedObjects);
            } else {
              // Detects the background color from the rectangle.
              if (
                obj.get(&#x27;type&#x27;) === &#x27;rect&#x27; &amp;&amp;
                this.isFullRectangle(elements[index])) {
                this.canvas.setBackgroundColor(obj.get(&#x27;fill&#x27;), () =&gt; {});
                this.fabricjsOptions.bg = obj.get(&#x27;fill&#x27;);
                this.bgPicker.setOptions({
                  color: obj.get(&#x27;fill&#x27;)
                });
              } else if (obj.type === &#x27;text&#x27;) {
                this.loadTextObject(elements[index], obj);
              } else {
                this.canvas.add(obj);
              }
            }
          });
          groupedObjects.forEach((objs) =&gt; {
            this.canvas.add(new fabric.Group(objs));
            this.groupCount += 1;
          });
        }) as unknown as (results: Object[], options) =&gt; void
      );
      this.changeDetectorRef.detectChanges();
    });
  }

  validate(): boolean {
    return (
      this.isDiagramSaved() &amp;&amp; this.data.savedSvgFileName &amp;&amp;
      this.data.savedSvgFileName.length &gt; 0);
  }

  getSize(): number {
    const size = this.fabricjsOptions.size;
    // Removes the word &quot;px&quot; from the end of the string and converts
    // into an int.
    return parseInt(size);
  }

  createRect(): void {
    this.canvas.discardActiveObject();
    const defaultWidth = 60;
    const defaultHeight = 70;
    const rect = new fabric.Rect({
      top: this.defaultTopCoordinate,
      left: this.defaultLeftCoordinate,
      width: defaultWidth,
      height: defaultHeight,
      fill: this.fabricjsOptions.fill,
      stroke: this.fabricjsOptions.stroke,
      strokeWidth: this.getSize(),
      strokeUniform: true
    });
    this.canvas.add(rect);
  }

  createLine(): void {
    this.canvas.discardActiveObject();
    const defaultBottomCoordinate = 100;
    const defaultRightCoordinate = 100;
    const line = new fabric.Line(
      [
        this.defaultTopCoordinate,
        this.defaultLeftCoordinate,
        defaultBottomCoordinate,
        defaultRightCoordinate
      ], {
        stroke: this.fabricjsOptions.stroke,
        strokeWidth: this.getSize(),
        strokeUniform: true
      });
    this.canvas.add(line);
  }

  createCircle(): void {
    this.canvas.discardActiveObject();
    const circle = new fabric.Circle({
      top: this.defaultTopCoordinate,
      left: this.defaultLeftCoordinate,
      radius: this.defaultRadius,
      fill: this.fabricjsOptions.fill,
      stroke: this.fabricjsOptions.stroke,
      strokeWidth: this.getSize(),
      strokeUniform: true
    });
    this.canvas.add(circle);
  }

  createText(): void {
    this.canvas.discardActiveObject();
    // The defaultTextSize is necessary to prevent the text
    // from being too small. This can be changed later in the editor.
    var defaultTextSize = &#x27;18px&#x27;;
    this.fillPicker.setOptions({
      color: &#x27;rgba(0,0,0,1)&#x27;
    });
    this.fabricjsOptions.size = defaultTextSize;
    var text = new fabric.Textbox(&#x27;Enter Text&#x27;, {
      top: this.defaultTopCoordinate,
      left: this.defaultLeftCoordinate,
      fontFamily: this.fabricjsOptions.fontFamily,
      fontSize: this.getSize(),
      fill: this.fabricjsOptions.fill,
      fontWeight: this.fabricjsOptions.bold ? &#x27;bold&#x27; : &#x27;normal&#x27;,
      fontStyle: this.fabricjsOptions.italic ? &#x27;italic&#x27; : &#x27;normal&#x27;,
    });
    this.canvas.add(text);
  }

  areAllToolsEnabled(): boolean {
    return this.drawMode === this.DRAW_MODE_NONE;
  }

  isDrawModePencil(): boolean {
    return this.drawMode === this.DRAW_MODE_PENCIL;
  }

  isPencilEnabled(): boolean {
    return this.areAllToolsEnabled() || this.isDrawModePencil();
  }

  togglePencilDrawing(): void {
    this.canvas.discardActiveObject();
    this.canvas.isDrawingMode = !this.canvas.isDrawingMode;
    this.canvas.freeDrawingBrush.color = this.fabricjsOptions.stroke;
    this.canvas.freeDrawingBrush.width = this.getSize();
    this.drawMode = this.DRAW_MODE_NONE;
    if (this.canvas.isDrawingMode) {
      this.drawMode = this.DRAW_MODE_PENCIL;
    }
  }

  private makePolygon(): fabric.Polyline {
    // The startPt is the initial point in the polygon and it is also the
    // last point if the polygon is closed.
    const startPt = this.polyOptions.bboxPoints[0];
    if (this.polygonMode === this.CLOSED_POLYGON_MODE) {
      this.polyOptions.bboxPoints.push(
        new PolyPoint(startPt.x, startPt.y));
    }
    var shape = new fabric.Polyline(this.polyOptions.bboxPoints, {
      fill: this.fabricjsOptions.fill,
      stroke: this.fabricjsOptions.stroke,
      strokeWidth: this.getSize(),
      strokeUniform: true,
      strokeLineCap: &#x27;round&#x27;
    });
    return shape;
  }

  private createPolyShape(): void {
    // This function removes the individual lines and draws the polygon.
    this.polyOptions.lines.forEach((value) =&gt; {
      this.canvas.remove(value);
    });
    if (this.polyOptions.bboxPoints.length &gt; 0) {
      this.polyOptions.shape = this.makePolygon();
      this.canvas.add(this.polyOptions.shape);
    }
    this.canvas.hoverCursor = &#x27;move&#x27;;
    // While drawing the polygon the objects are treated as nonselectable
    // and once the polygon is created the objects are converted into
    // selectable.
    this.canvas.forEachObject((object) =&gt; {
      object.selectable = true;
    });
    this.canvas.renderAll();
    this.polyOptions.bboxPoints = [];
    this.polyOptions.lines = [];
    this.polyOptions.lineCounter = 0;
  }

  private setPolyStartingPoint(options): void {
    var mouse = this.canvas.getPointer(options.e);
    this.polyOptions.x = mouse.x;
    this.polyOptions.y = mouse.y;
  }

  private createPolygon() {
    if (this.drawMode === this.DRAW_MODE_POLY) {
      this.drawMode = this.DRAW_MODE_NONE;
      this.createPolyShape();
    } else {
      this.canvas.discardActiveObject();
      this.drawMode = this.DRAW_MODE_POLY;
      this.canvas.hoverCursor = &#x27;default&#x27;;
      this.canvas.forEachObject((object) =&gt; {
        object.selectable = false;
      });
    }
  }

  isDrawModePolygon(): boolean {
    return this.drawMode === this.DRAW_MODE_POLY;
  }

  isOpenPolygonEnabled(): boolean {
    return (
      this.areAllToolsEnabled() || (
        this.isDrawModePolygon() &amp;&amp;
        this.polygonMode === this.OPEN_POLYGON_MODE));
  }

  createOpenPolygon(): void {
    this.polygonMode = this.OPEN_POLYGON_MODE;
    this.createPolygon();
  }

  isClosedPolygonEnabled(): boolean {
    return (
      this.areAllToolsEnabled() || (
        this.isDrawModePolygon() &amp;&amp;
        this.polygonMode === this.CLOSED_POLYGON_MODE));
  }

  createClosedPolygon(): void {
    this.polygonMode = this.CLOSED_POLYGON_MODE;
    this.createPolygon();
  }

  private createBezierControlPoints(left: number, top: number): fabric.Circle {
    // This function is used to add the control points for the quadratic
    // bezier curve which is used to control the position of the curve.
    // A size 2 is added so that the control circles is not rendered
    // too small.
    var circle = new fabric.Circle({
      left: left,
      top: top,
      radius: this.getSize() + 2,
      fill: &#x27;#666666&#x27;,
      stroke: &#x27;#666666&#x27;,
      hasBorders: false,
      hasControls: false
    });
    return circle;
  }

  private drawQuadraticCurve(): void {
    const defaultCurve = &#x27;M 40 40 Q 95, 100, 150, 40&#x27;;
    const defaultP1TopCoordinate = 95;
    const defaultP1LeftCoordinate = 100;
    const defaultP0TopCoordinate = 40;
    const defaultP0LeftCoordinate = 40;
    const defaultP2TopCoordinate = 150;
    const defaultP2LeftCoordinate = 40;
    const curve = new fabric.Path(defaultCurve, {
      stroke: this.fabricjsOptions.stroke,
      fill: this.fabricjsOptions.fill,
      strokeWidth: this.getSize(),
      objectCaching: false,
      selectable: false
    });
    this.canvas.add(curve);

    const p1 = this.createBezierControlPoints(
      defaultP1TopCoordinate, defaultP1LeftCoordinate);
    p1.name = &#x27;p1&#x27;;
    p1.set({
      radius: 12,
      fill: &#x27;#ffffff&#x27;,
      strokeWidth: 5
    });
    this.canvas.add(p1);

    const p0 = this.createBezierControlPoints(
      defaultP0TopCoordinate, defaultP0LeftCoordinate);
    p0.name = &#x27;p0&#x27;;
    this.canvas.add(p0);

    const p2 = this.createBezierControlPoints(
      defaultP2TopCoordinate, defaultP2LeftCoordinate);
    p2.name = &#x27;p2&#x27;;
    this.canvas.add(p2);
  }

  private getQuadraticBezierCurve() {
    if (this.drawMode === this.DRAW_MODE_BEZIER) {
      // The order of objects being added are the path followed by
      // three control points. Therefore the 4th from the last is the
      // quadratic curve.
      return this.canvas.getObjects().slice(-4, -3)[0];
    }
  }

  createQuadraticBezier(): void {
    if (this.drawMode === this.DRAW_MODE_NONE) {
      this.canvas.discardActiveObject();
      this.drawMode = this.DRAW_MODE_BEZIER;
      this.canvas.getObjects().forEach((item) =&gt; {
        item.set({
          hoverCursor: &#x27;default&#x27;,
          selectable: false
        });
      });
      this.drawQuadraticCurve();
    } else {
      // This is the case when the user clicks the tool after drawing the
      // curve. The current path and the circles are removed and new path
      // is added.
      this.canvas.getObjects().slice(-3).forEach((item) =&gt; {
        this.canvas.remove(item);
      });
      const path = this.canvas.getObjects().slice(-1)[0].get(
        &#x27;path&#x27; as keyof fabric.Object);
      this.canvas.remove(this.canvas.getObjects().slice(-1)[0]);
      this.canvas.getObjects().forEach((item) =&gt; {
        item.set({
          hoverCursor: &#x27;move&#x27;,
          selectable: true
        });
      });
      // Change mode and then add the path so that the object is added in
      // cavasObjects array.
      this.drawMode = this.DRAW_MODE_NONE;
      // Adding a new path so that the bbox is computed correctly.
      const curve = new fabric.Path(path, {
        stroke: this.fabricjsOptions.stroke,
        fill: this.fabricjsOptions.fill,
        strokeWidth: this.getSize(),
      });
      this.canvas.add(curve);
    }
  }

  isDrawModeBezier(): boolean {
    return this.drawMode === this.DRAW_MODE_BEZIER;
  }

  onAddItem(): void {
    if (this.pieChartDataInput.length &lt; this.pieChartDataLimit) {
      var defaultData = 10;
      var dataInput = {
        name: &#x27;Data name&#x27;,
        data: defaultData,
        color: &#x27;#000000&#x27;,
        angle: 0
      };
      this.pieChartDataInput.push(dataInput);
    }
  }

  getPieSlice(
      center: {x: number, y: number},
      radius: number,
      startAngle: number,
      endAngle: number,
      color: string): fabric.Group {
    // The pie slice is a combination of a semicircle and a triangle.
    // The following code is used to calculate the angle of the arc and
    // the points for drawing the polygon.
    const angle = endAngle - startAngle;
    const halfAngle = angle / 2;
    const halfChord = radius * Math.sin(angle / 2);
    const height = Math.sqrt(Math.pow(radius, 2) - Math.pow(halfChord, 2));
    const radiansToDegrees = 180 / Math.PI;

    const arc = new fabric.Circle({
      radius: radius,
      startAngle: -halfAngle,
      endAngle: halfAngle,
      left: center.x,
      top: center.y,
      originX: &#x27;center&#x27;,
      originY: &#x27;center&#x27;,
      fill: color,
      stroke: color,
      strokeWidth: 1,
      strokeUniform: true,
      id: &#x27;group&#x27; + this.groupCount
    } as unknown as fabric.ICircleOptions);
    arc.toSVG = this.createCustomToSVG(
      arc.toSVG, &#x27;path&#x27;, (arc as unknown as {id: string}).id, arc);
    const p1 = new PolyPoint (height + center.x, center.y + halfChord);
    const p2 = new PolyPoint (height + center.x, center.y - halfChord);
    const tri = new fabric.Polygon([center, p1, p2, center], {
      fill: color,
      stroke: color,
      strokeWidth: 1,
      strokeUniform: true,
      id: &#x27;group&#x27; + this.groupCount
    } as unknown as fabric.IPolylineOptions);
    tri.toSVG = this.createCustomToSVG(
      tri.toSVG, tri.type, (tri as unknown as {id: string}).id, tri);
    const rotationAngle = (startAngle + halfAngle) * radiansToDegrees;
    const slice = new fabric.Group([arc, tri], {
      originX: &#x27;center&#x27;,
      originY: &#x27;center&#x27;,
      top: center.y,
      left: center.x,
      angle: rotationAngle,
    });
    return slice;
  }

  getTextIndex(text: string, lineNum: number, charIndex: number): number {
    return (
      text.split(&#x27;\n&#x27;).slice(0, lineNum).reduce((sum, textLine) =&gt; {
        return sum + textLine.length + 1;
      }, 0) + charIndex
    );
  }

  createChart(): void {
    let total = 0;
    let currentAngle = 0;
    let pieSlices = [];
    let legendText = &#x27;&#x27;;
    const PIE_SLICE_COLOR_INDICATOR = &#x27;\u2587&#x27;;
    for (var i = 0; i &lt; this.pieChartDataInput.length; i++) {
      total += this.pieChartDataInput[i].data;
      legendText += (PIE_SLICE_COLOR_INDICATOR + &#x27; - &#x27;);
      legendText += (
        this.pieChartDataInput[i].name + &#x27; - &#x27; +
        this.pieChartDataInput[i].data + &#x27;\n&#x27;);
    }
    legendText = legendText.slice(0, -1);
    for (var i = 0; i &lt; this.pieChartDataInput.length; i++) {
      this.pieChartDataInput[i].angle = (
        this.pieChartDataInput[i].data / total * Math.PI * 2);
      pieSlices.push(this.getPieSlice(
        new PolyPoint(
          this.defaultTopCoordinate, this.defaultLeftCoordinate
        ), this.defaultRadius, currentAngle,
        currentAngle + this.pieChartDataInput[i].angle,
        this.pieChartDataInput[i].color));
      // If a pie slice has an angle greater than 180, then
      // it should be rendered first, otherwise it will overlap other
      // slices.
      if (this.pieChartDataInput[i].angle &gt; Math.PI) {
        var pieSlice = pieSlices.pop();
        pieSlices.splice(0, 0, pieSlice);
      }
      currentAngle += this.pieChartDataInput[i].angle;
    }
    // The defaultTextSize is to prevent the text from being too small.
    // This can be changed again using editor.
    var defaultTextSize = &#x27;18px&#x27;;
    this.fabricjsOptions.size = defaultTextSize;
    var text = new fabric.Textbox(legendText, {
      top: 100,
      left: 120,
      fontFamily: this.fabricjsOptions.fontFamily,
      fontSize: this.getSize(),
      fill: &#x27;#000000&#x27;,
      fontWeight: this.fabricjsOptions.bold ? &#x27;bold&#x27; : &#x27;normal&#x27;,
      fontStyle: this.fabricjsOptions.italic ? &#x27;italic&#x27; : &#x27;normal&#x27;,
      width: 200
    });
    // Gives the color to the pie slice indicator which
    // is used to indentify the pie slice.
    for (var i = 0; i &lt; this.pieChartDataInput.length; i++) {
      text.setSelectionStart(this.getTextIndex(legendText, i, 0));
      text.setSelectionEnd(this.getTextIndex(legendText, i, 1));
      text.setSelectionStyles({
        stroke: &#x27;#000&#x27;,
        strokeWidth: 2,
        fill: this.pieChartDataInput[i].color,
      });
    }
    this.drawMode = this.DRAW_MODE_NONE;
    this.canvas.add(text);
    this.canvas.add(new fabric.Group(pieSlices));
    this.groupCount += 1;
  }

  createPieChart(): void {
    if (this.drawMode === this.DRAW_MODE_NONE) {
      this.canvas.discardActiveObject();
      this.drawMode = this.DRAW_MODE_PIECHART;
    } else {
      this.createChart();
      // Resets the pie chart form.
      this.pieChartDataInput = [{
        name: &#x27;Data name 1&#x27;,
        data: 10,
        color: &#x27;#ff0000&#x27;,
        angle: 0
      },
      {
        name: &#x27;Data name 2&#x27;,
        data: 10,
        color: &#x27;#00ff00&#x27;,
        angle: 0
      }];
    }
  }

  isPieChartEnabled(): boolean {
    return Boolean(
      this.areAllToolsEnabled() ||
      this.drawMode === this.DRAW_MODE_PIECHART);
  }

  isDrawModePieChart(): boolean {
    return Boolean(this.drawMode === this.DRAW_MODE_PIECHART);
  }

  private loadSvgFile(objects): void {
    if (this.loadType === &#x27;group&#x27;) {
      objects.forEach((obj) =&gt; {
        obj.set({
          id: &#x27;group&#x27; + this.groupCount
        });
        obj.toSVG = this.createCustomToSVG(
          obj.toSVG, obj.type, obj.id, obj);
      });
      this.canvas.add(new fabric.Group(objects));
      this.groupCount += 1;
    } else {
      objects.forEach((obj) =&gt; {
        this.canvas.add(obj);
      });
    }
  }

  uploadSvgFile(): void {
    if (this.drawMode === this.DRAW_MODE_NONE) {
      this.canvas.discardActiveObject();
      this.drawMode = this.DRAW_MODE_SVG_UPLOAD;
    } else {
      this.drawMode = this.DRAW_MODE_NONE;
      if (this.uploadedSvgDataUrl !== null) {
        var svgString = atob(this.uploadedSvgDataUrl.unsafeUrl.split(&#x27;,&#x27;)[1]);
        fabric.loadSVGFromString(svgString, (args) =&gt; this.loadSvgFile(args));
      }
      this.canvas.renderAll();
      this.uploadedSvgDataUrl = null;
    }
  }

  setUploadedFile(file: File): void {
    const reader = new FileReader();
    reader.onload = () =&gt; {
      const img = new Image();
      img.onload = () =&gt; {
        this.uploadedSvgDataUrl = {
          safeUrl: this.svgSanitizerService.getTrustedSvgResourceUrl(
          reader.result as string),
          unsafeUrl: reader.result as string
        };
        //  $scope.$apply();
      };
      img.src = &lt;string&gt;(reader.result);
    };
    reader.readAsDataURL(file);
  }

  onFileChanged(file: File, filename: string): void {
    this.setUploadedFile(file);
  }

  isFileUploaded(): boolean {
    return Boolean(this.uploadedSvgDataUrl !== null);
  }

  isDrawModeSvgUpload(): boolean {
    return Boolean(this.drawMode === this.DRAW_MODE_SVG_UPLOAD);
  }

  isSvgUploadEnabled(): boolean {
    return Boolean(
      this.areAllToolsEnabled() ||
      this.drawMode === this.DRAW_MODE_SVG_UPLOAD);
  }

  bringObjectForward(): void {
    this.canvas.bringForward(this.canvas.getActiveObject());
    if (this.layerNum &lt; this.canvas._objects.length) {
      this.layerNum += 1;
    }
  }

  sendObjectBackward(): void {
    this.canvas.sendBackwards(this.canvas.getActiveObject());
    if (this.layerNum &gt; 1) {
      this.layerNum -= 1;
    }
  }

  private undoStackPush(object): void {
    if (this.objectUndoStack.length === this.undoLimit) {
      this.objectUndoStack.shift();
    }
    this.objectUndoStack.push(object);
  }

  onUndo(): void {
    this.canvas.discardActiveObject();
    if (this.objectUndoStack.length &gt; 0) {
      var undoObj = this.objectUndoStack.pop();
      if (undoObj.action === &#x27;add&#x27;) {
        var shape = this.canvasObjects.pop();
        var index = this.canvas._objects.indexOf(shape);
        this.canvas._objects.splice(index, 1);
        this.objectRedoStack.push({
          action: &#x27;add&#x27;,
          object: shape
        });
      } else {
        this.isRedo = true;
        this.objectRedoStack.push({
          action: &#x27;remove&#x27;,
          object: undoObj.object
        });
        // Adding the object in the correct position according to initial
        // order.
        this.undoFlag = true;
        this.canvasObjects.splice(undoObj.index, 0, undoObj.object);
        this.canvas.add(undoObj.object);
      }
      this.canvas.renderAll();
    }
  }

  isUndoEnabled(): boolean {
    return (
      this.drawMode === this.DRAW_MODE_NONE &amp;&amp; this.objectUndoStack.length &gt; 0);
  }

  onRedo(): void {
    this.canvas.discardActiveObject();
    if (this.objectRedoStack.length &gt; 0) {
      var redoObj = this.objectRedoStack.pop();
      this.undoStackPush(redoObj);
      if (redoObj.action === &#x27;add&#x27;) {
        this.isRedo = true;
        // Not adding the shape to canvasObjects because it is added by the
        // event function.
        this.canvas.add(redoObj.object);
      } else {
        var shape = redoObj.object;
        var index = this.canvasObjects.indexOf(shape);
        this.canvasObjects.splice(index, 1);
        index = this.canvas._objects.indexOf(shape);
        this.canvas._objects.splice(index, 1);
      }
    }
    this.canvas.renderAll();
  }

  isRedoEnabled(): boolean {
    return (
      this.drawMode === this.DRAW_MODE_NONE &amp;&amp; this.objectRedoStack.length &gt; 0);
  }

  removeShape(): void {
    var shape = this.canvas.getActiveObject();
    var index = this.canvasObjects.indexOf(shape);
    if (shape) {
      this.undoStackPush({
        action: &#x27;remove&#x27;,
        object: shape,
        index: index
      });
      this.objectRedoStack = [];
      this.canvasObjects.splice(index, 1);
      this.canvas.remove(shape);
    }
  }

  onClear(): void {
    this.groupCount = 0;
    this.objectUndoStack = [];
    this.objectRedoStack = [];
    this.canvasObjects = [];
    if (this.canvas) {
      this.canvas.clear();
      this.onBgChange();
    }
  }

  isClearEnabled(): boolean {
    return (
      this.canvasObjects.length &gt; 0 &amp;&amp; this.drawMode === this.DRAW_MODE_NONE);
  }

  onStrokeChange(): void {
    if (this.drawMode === this.DRAW_MODE_BEZIER) {
      this.getQuadraticBezierCurve().set({
        stroke: this.fabricjsOptions.stroke
      });
      this.canvas.renderAll();
    } else {
      var shape = this.canvas.getActiveObject();
      var strokeShapes = [&#x27;rect&#x27;, &#x27;circle&#x27;, &#x27;path&#x27;, &#x27;line&#x27;, &#x27;polyline&#x27;];
      this.canvas.freeDrawingBrush.color = this.fabricjsOptions.stroke;
      if (shape &amp;&amp; strokeShapes.indexOf(shape.get(&#x27;type&#x27;)) !== -1) {
        shape.set({
          stroke: this.fabricjsOptions.stroke
        });
        this.canvas.renderAll();
      }
    }
  }

  onFillChange(): void {
    // Fetches the bezier curve and then the fill color.
    if (this.drawMode === this.DRAW_MODE_BEZIER) {
      this.getQuadraticBezierCurve().set({
        fill: this.fabricjsOptions.fill
      });
      this.canvas.renderAll();
    } else {
      var shape = this.canvas.getActiveObject();
      var fillShapes = [&#x27;rect&#x27;, &#x27;circle&#x27;, &#x27;path&#x27;, &#x27;textbox&#x27;, &#x27;polyline&#x27;];
      if (shape &amp;&amp; fillShapes.indexOf(shape.get(&#x27;type&#x27;)) !== -1) {
        shape.set({
          fill: this.fabricjsOptions.fill
        });
        this.canvas.renderAll();
      }
    }
  }

  onBgChange(): void {
    this.canvas.setBackgroundColor(
      this.fabricjsOptions.bg, () =&gt; {
        // This is a call back that runs when background is set.
        // This is needed for ts checks.
      });
    this.canvas.renderAll();
  }

  onItalicToggle(): void {
    var shape = this.canvas.getActiveObject();
    if (shape &amp;&amp; shape.get(&#x27;type&#x27;) === &#x27;textbox&#x27;) {
      shape.set({
        fontStyle: this.fabricjsOptions.italic ? &#x27;italic&#x27; : &#x27;normal&#x27;,
      } as unknown as Partial&lt;fabric.Object&gt;);
      this.canvas.renderAll();
    }
  }

  onBoldToggle(): void {
    var shape = this.canvas.getActiveObject();
    if (shape &amp;&amp; shape.get(&#x27;type&#x27;) === &#x27;textbox&#x27;) {
      shape.set({
        fontWeight: this.fabricjsOptions.bold ? &#x27;bold&#x27; : &#x27;normal&#x27;,
      } as unknown as Partial&lt;fabric.Object&gt;);
      this.canvas.renderAll();
    }
  }

  onFontChange(): void {
    var shape = this.canvas.getActiveObject();
    if (shape &amp;&amp; shape.get(&#x27;type&#x27;) === &#x27;textbox&#x27;) {
      shape.set({
        fontFamily: this.fabricjsOptions.fontFamily,
      } as unknown as Partial&lt;fabric.Object&gt;);
      this.canvas.renderAll();
    }
  }

  onSizeChange(): void {
    // Ensures that the size change is applied only to the curve and
    // not to all the control points.
    if (this.drawMode === this.DRAW_MODE_BEZIER) {
      var numberOfEdgeControlPoints = 2;
      // Changes the radius of the edge control points.
      // A size 2 is added so that the control circles is not rendered
      // too small.
      this.canvas.getObjects().slice(-numberOfEdgeControlPoints).forEach(
        (object) =&gt; {
          object.set({
            radius: this.getSize() + 2
          } as unknown as Partial&lt;fabric.Object&gt;);
        });
      this.getQuadraticBezierCurve().set({
        strokeWidth: this.getSize()
      } as unknown as Partial&lt;fabric.Object&gt;);
      this.canvas.renderAll();
    } else {
      var shape = this.canvas.getActiveObject();
      this.canvas.freeDrawingBrush.width = this.getSize();
      var strokeWidthShapes = [
        &#x27;rect&#x27;, &#x27;circle&#x27;, &#x27;path&#x27;, &#x27;line&#x27;, &#x27;polyline&#x27;];
      if (shape &amp;&amp; strokeWidthShapes.indexOf(shape.get(&#x27;type&#x27;)) !== -1) {
        shape.set({
          strokeWidth: this.getSize()
        } as unknown as Partial&lt;fabric.Object&gt;);
        this.canvas.renderAll();
      } else if (shape &amp;&amp; shape.get(&#x27;type&#x27;) === &#x27;textbox&#x27;) {
        shape.set({
          fontSize: this.getSize()
        } as unknown as Partial&lt;fabric.Object&gt;);
        this.canvas.renderAll();
      }
    }
  }

  isSizeVisible(): boolean {
    return Boolean(
      this.objectIsSelected || this.drawMode !== this.DRAW_MODE_NONE);
  }

  createColorPicker(value: string): void {
    var parent = document.getElementById(value + &#x27;-color&#x27;);

    var onChangeFunc = {
      stroke: () =&gt; this.onStrokeChange(),
      fill: () =&gt; this.onFillChange(),
      bg: () =&gt; this.onBgChange()
    };
    let onOpen = () =&gt; {
      // This DOM manipulation is necessary because the color picker is not
      // configurable in the third-party module.
      let alphaSliders = document.querySelectorAll(
        &#x27;.picker_alpha .picker_selector&#x27;);
      alphaSliders.forEach((element) =&gt; {
        element.setAttribute(&#x27;title&#x27;, &#x27;Transparency Slider&#x27;);
      });
    };
    let onChange = (color) =&gt; {
      parent.style.background = color.rgbaString;
      var topAlphaSquare = document.getElementById(
        &#x27;top-&#x27; + value + &#x27;-alpha&#x27;);
      var bottomAlphaSquare = document.getElementById(
        &#x27;bottom-&#x27; + value + &#x27;-alpha&#x27;);
      var opacity = 1 - color.rgba[3];
      topAlphaSquare.style.opacity = opacity.toString();
      bottomAlphaSquare.style.opacity = opacity.toString();
      this.fabricjsOptions[value] = color.rgbaString;
      onChangeFunc[value]();
    };
    var picker = new Picker({
      parent: parent,
      color: this.fabricjsOptions[value],
      onOpen: onOpen,
      onChange: onChange
    });
    parent.style.background = this.fabricjsOptions[value];
    if (value === &#x27;stroke&#x27;) {
      this.strokePicker = picker;
    }
    if (value === &#x27;fill&#x27;) {
      this.fillPicker = picker;
    }
    if (value === &#x27;bg&#x27;) {
      this.bgPicker = picker;
    }
  }

  initializeMouseEvents(): void {
    // Adding event listener for polygon tool.
    this.canvas.on(&#x27;mouse:dblclick&#x27;, () =&gt; {
      if (this.drawMode === this.DRAW_MODE_POLY) {
        this.drawMode = this.DRAW_MODE_NONE;
        this.createPolyShape();
      }
    });

    this.canvas.on(&#x27;mouse:down&#x27;, (options) =&gt; {
      // Used to detect the mouse clicks when drawing the polygon.
      if (this.drawMode === this.DRAW_MODE_POLY) {
        this.setPolyStartingPoint(options);
        var x = this.polyOptions.x;
        var y = this.polyOptions.y;
        this.polyOptions.bboxPoints.push(new PolyPoint(x, y));
        var points = [x, y, x, y];
        var stroke = this.fabricjsOptions.stroke;
        // Ensures that the polygon lines are visible when
        // creating the polygon.
        stroke = stroke.slice(0, -2) + &#x27;1)&#x27;;
        var line = new fabric.Line(points, {
          strokeWidth: this.getSize(),
          selectable: false,
          stroke: stroke,
          strokeLineCap: &#x27;round&#x27;
        });
        // Enables drawing a polygon in a device with touch support.
        if (
          this.polyOptions.lines.length !== 0 &amp;&amp;
          this.drawMode === this.DRAW_MODE_POLY &amp;&amp;
          this.isTouchDevice
        ) {
          this.setPolyStartingPoint(options);
          this.polyOptions.lines[this.polyOptions.lineCounter - 1].set({
            x2: this.polyOptions.x,
            y2: this.polyOptions.y,
          });
          this.canvas.renderAll();
        }
        this.polyOptions.lines.push(line);
        this.canvas.add(
          this.polyOptions.lines[this.polyOptions.lineCounter]);
        this.polyOptions.lineCounter++;
      }
    });

    this.canvas.on(&#x27;mouse:move&#x27;, (options) =&gt; {
      // Detects the mouse movement while drawing the polygon.
      if (
        this.polyOptions.lines.length !== 0 &amp;&amp;
        this.drawMode === this.DRAW_MODE_POLY &amp;&amp;
        !this.isTouchDevice
      ) {
        this.setPolyStartingPoint(options);
        this.polyOptions.lines[this.polyOptions.lineCounter - 1].set({
          x2: this.polyOptions.x,
          y2: this.polyOptions.y,
        });
        this.canvas.renderAll();
      }
    });

    this.canvas.on(&#x27;object:moving&#x27;, (e) =&gt; {
      // Detects the movement in the control points when
      // drawing the bezier curve.
      if (this.drawMode === this.DRAW_MODE_BEZIER) {
        var pt = e.target;
        var curve = this.getQuadraticBezierCurve() as unknown as {
          path: number[][]};
        if (e.target.name === &#x27;p0&#x27;) {
          curve.path[0][1] = pt.left;
          curve.path[0][2] = pt.top;
        } else if (e.target.name === &#x27;p1&#x27;) {
          curve.path[1][1] = pt.left;
          curve.path[1][2] = pt.top;
        } else if (e.target.name === &#x27;p2&#x27;) {
          curve.path[1][3] = pt.left;
          curve.path[1][4] = pt.top;
        }
        this.canvas.renderAll();
      }
    });

    this.canvas.on(&#x27;object:added&#x27;, () =&gt; {
      // Ensures that the quadratic bezier control points are
      // not added to the undoStack.
      if (
        this.drawMode === this.DRAW_MODE_NONE ||
        this.drawMode === this.DRAW_MODE_PENCIL
      ) {
        var shape = this.canvas._objects[this.canvas._objects.length - 1];
        if (!this.undoFlag) {
          this.canvasObjects.push(shape);
        }
        this.undoFlag = false;
        if (!this.isRedo) {
          this.undoStackPush({
            action: &#x27;add&#x27;,
            object: shape
          });
          this.objectRedoStack = [];
        }
        this.isRedo = false;
      }
    });

    this.canvas.on(&#x27;object:scaling&#x27;, () =&gt; {
      // Prevents the textbox from scaling.
      if (this.canvas.getActiveObject().get(&#x27;type&#x27;) === &#x27;textbox&#x27;) {
        var text = this.canvas.getActiveObject();
        var scaleX = text.get(&#x27;scaleX&#x27;);
        var scaleY = text.get(&#x27;scaleY&#x27;);
        var width = text.get(&#x27;width&#x27;);
        var height = text.get(&#x27;height&#x27;);
        this.canvas.getActiveObject().set({
          width: width * scaleX,
          height: height * scaleY,
          scaleX: 1,
          scaleY: 1
        });
      }
    });

    var onSelection = () =&gt; {
      // Ensures that the fabricjsOptions doesn&#x27;t change when the user
      // selects the quadratic bezier control points.
      if (
        this.drawMode === this.DRAW_MODE_NONE ||
            this.drawMode === this.DRAW_MODE_PENCIL) {
        var shape = this.canvas.getActiveObject();
        this.layerNum = this.canvas._objects.indexOf(shape) + 1;
        this.fillPicker.setOptions({
          color: shape.get(&#x27;fill&#x27;)
        });
        this.strokePicker.setOptions({
          color: shape.get(&#x27;stroke&#x27;)
        });
        this.objectIsSelected = true;
        var strokeWidthShapes = [
          &#x27;rect&#x27;, &#x27;circle&#x27;, &#x27;path&#x27;, &#x27;line&#x27;, &#x27;polyline&#x27;];
        if (strokeWidthShapes.indexOf(shape.get(&#x27;type&#x27;)) !== -1) {
          this.fabricjsOptions.size = (
            shape.get(&#x27;strokeWidth&#x27;).toString() + &#x27;px&#x27;);
          this.displayFontStyles = false;
        } else if (shape.get(&#x27;type&#x27;) === &#x27;textbox&#x27;) {
          this.displayFontStyles = true;
          this.fabricjsOptions.size = (
            shape.get(&#x27;fontSize&#x27; as keyof fabric.Object).toString() + &#x27;px&#x27;);
          this.fabricjsOptions.fontFamily = shape.get(
            &#x27;fontFamily&#x27; as keyof fabric.Object);
          this.fabricjsOptions.italic = shape.get(
            &#x27;fontStyle&#x27; as keyof fabric.Object) === &#x27;italic&#x27;;
          this.fabricjsOptions.bold = shape.get(
            &#x27;fontWeight&#x27; as keyof fabric.Object) === &#x27;bold&#x27;;
        } else {
          this.displayFontStyles = false;
        }
      }
    };

    this.canvas.on(&#x27;selection:created&#x27;, () =&gt; {
      onSelection();
    });

    this.canvas.on(&#x27;selection:updated&#x27;, () =&gt; {
      onSelection();
    });

    this.canvas.on(&#x27;selection:cleared&#x27;, () =&gt; {
      this.objectIsSelected = false;
      this.displayFontStyles = false;
    });
  }

  setCanvasDimensions(): void {
    this.canvas.setHeight(this.CANVAS_HEIGHT);
    this.canvas.setWidth(this.CANVAS_WIDTH);
    this.canvas.renderAll();
  }

  initializeFabricJs(): void {
    this.canvas = new fabric.Canvas(this.canvasID);
    this.setCanvasDimensions();
    this.canvas.selection = false;
    this.initializeMouseEvents();
    this.createColorPicker(&#x27;stroke&#x27;);
    this.createColorPicker(&#x27;fill&#x27;);
    this.createColorPicker(&#x27;bg&#x27;);
    // This is used to change the origin of shapes from top left corner
    // to center of the shape. This is used to align the quadratic bezier
    // control points correctly to the curve.
    fabric.Object.prototype.originX = &#x27;center&#x27;;
    fabric.Object.prototype.originY = &#x27;center&#x27;;
  }
}

angular.module(&#x27;oppia&#x27;).directive(&#x27;svgFilenameEditor&#x27;, downgradeComponent({
  component: SvgFilenameEditorComponent
}));
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:52,&quot;character&quot;:11,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:53,&quot;character&quot;:12,&quot;text&quot;:&quot;valueChanged&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:111,&quot;character&quot;:2,&quot;text&quot;:&quot;fillPicker&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:112,&quot;character&quot;:2,&quot;text&quot;:&quot;strokePicker&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:113,&quot;character&quot;:2,&quot;text&quot;:&quot;bgPicker&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:127,&quot;character&quot;:2,&quot;text&quot;:&quot;objectUndoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:128,&quot;character&quot;:2,&quot;text&quot;:&quot;objectRedoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:129,&quot;character&quot;:2,&quot;text&quot;:&quot;canvasObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:198,&quot;character&quot;:13,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:199,&quot;character&quot;:36,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:201,&quot;character&quot;:61,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:278,&quot;character&quot;:9,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:279,&quot;character&quot;:9,&quot;text&quot;:&quot;valueChanged&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:279,&quot;character&quot;:32,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:290,&quot;character&quot;:8,&quot;text&quot;:&quot;this.data.savedSvgUrl as string&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:315,&quot;character&quot;:24,&quot;text&quot;:&quot;reader.result as string&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:422,&quot;character&quot;:12,&quot;text&quot;:&quot;parsedResponse&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:425,&quot;character&quot;:12,&quot;text&quot;:&quot;parsedResponse&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:425,&quot;character&quot;:27,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:425,&quot;character&quot;:33,&quot;text&quot;:&quot;error&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:439,&quot;character&quot;:12,&quot;text&quot;:&quot;svgString&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:465,&quot;character&quot;:30,&quot;text&quot;:&quot;obj as unknown as {id: string}&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:475,&quot;character&quot;:10,&quot;text&quot;:&quot;childNodes&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:477,&quot;character&quot;:10,&quot;text&quot;:&quot;coloredTextIndex&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:480,&quot;character&quot;:4,&quot;text&quot;:&quot;childNodes&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:480,&quot;character&quot;:15,&quot;text&quot;:&quot;forEach&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:480,&quot;character&quot;:24,&quot;text&quot;:&quot;el&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:480,&quot;character&quot;:28,&quot;text&quot;:&quot;index&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:481,&quot;character&quot;:10,&quot;text&quot;:&quot;el&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:481,&quot;character&quot;:13,&quot;text&quot;:&quot;nodeName&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:482,&quot;character&quot;:17,&quot;text&quot;:&quot;el&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:482,&quot;character&quot;:20,&quot;text&quot;:&quot;childNodes&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:482,&quot;character&quot;:34,&quot;text&quot;:&quot;nodeValue&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:483,&quot;character&quot;:12,&quot;text&quot;:&quot;el&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:483,&quot;character&quot;:15,&quot;text&quot;:&quot;style&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:483,&quot;character&quot;:21,&quot;text&quot;:&quot;fill&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:486,&quot;character&quot;:10,&quot;text&quot;:&quot;coloredTextIndex&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:488,&quot;character&quot;:29,&quot;text&quot;:&quot;el&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:488,&quot;character&quot;:32,&quot;text&quot;:&quot;childNodes&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:488,&quot;character&quot;:46,&quot;text&quot;:&quot;nodeValue&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:488,&quot;character&quot;:56,&quot;text&quot;:&quot;length&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:490,&quot;character&quot;:12,&quot;text&quot;:&quot;fill&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:490,&quot;character&quot;:18,&quot;text&quot;:&quot;el&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:490,&quot;character&quot;:21,&quot;text&quot;:&quot;style&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:490,&quot;character&quot;:27,&quot;text&quot;:&quot;fill&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:491,&quot;character&quot;:12,&quot;text&quot;:&quot;stroke&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:491,&quot;character&quot;:20,&quot;text&quot;:&quot;el&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:491,&quot;character&quot;:23,&quot;text&quot;:&quot;style&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:491,&quot;character&quot;:29,&quot;text&quot;:&quot;stroke&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:492,&quot;character&quot;:12,&quot;text&quot;:&quot;strokeWidth&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:492,&quot;character&quot;:25,&quot;text&quot;:&quot;el&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:492,&quot;character&quot;:28,&quot;text&quot;:&quot;style&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:492,&quot;character&quot;:34,&quot;text&quot;:&quot;strokeWidth&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:494,&quot;character&quot;:19,&quot;text&quot;:&quot;index&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:494,&quot;character&quot;:27,&quot;text&quot;:&quot;childNodes&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:494,&quot;character&quot;:38,&quot;text&quot;:&quot;length&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:508,&quot;character&quot;:7,&quot;text&quot;:&quot;obj as unknown as {text: string}&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:524,&quot;character&quot;:4,&quot;text&quot;:&quot;coloredTextIndex&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:524,&quot;character&quot;:30,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:525,&quot;character&quot;:29,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:525,&quot;character&quot;:33,&quot;text&quot;:&quot;startIndex&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:526,&quot;character&quot;:27,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:526,&quot;character&quot;:31,&quot;text&quot;:&quot;endIndex&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:528,&quot;character&quot;:8,&quot;text&quot;:&quot;stroke&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:528,&quot;character&quot;:16,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:528,&quot;character&quot;:20,&quot;text&quot;:&quot;stroke&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:529,&quot;character&quot;:8,&quot;text&quot;:&quot;strokeWidth&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:529,&quot;character&quot;:21,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:529,&quot;character&quot;:25,&quot;text&quot;:&quot;strokeWidth&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:530,&quot;character&quot;:8,&quot;text&quot;:&quot;fill&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:530,&quot;character&quot;:14,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:530,&quot;character&quot;:18,&quot;text&quot;:&quot;fill&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:563,&quot;character&quot;:30,&quot;text&quot;:&quot;((objects, options, elements) =&gt; {\n          let groupedObjects = [];\n          objects.forEach((obj, index) =&gt; {\n            const objId = elements[index].id;\n            if (objId !== &#x27;&#x27;) {\n              groupedObjects = this.loadGroupedObject(\n                objId, obj, groupedObjects);\n            } else {\n              // Detects the background color from the rectangle.\n              if (\n                obj.get(&#x27;type&#x27;) === &#x27;rect&#x27; &amp;&amp;\n                this.isFullRectangle(elements[index])) {\n                this.canvas.setBackgroundColor(obj.get(&#x27;fill&#x27;), () =&gt; {});\n                this.fabricjsOptions.bg = obj.get(&#x27;fill&#x27;);\n                this.bgPicker.setOptions({\n                  color: obj.get(&#x27;fill&#x27;)\n                });\n              } else if (obj.type === &#x27;text&#x27;) {\n                this.loadTextObject(elements[index], obj);\n              } else {\n                this.canvas.add(obj);\n              }\n            }\n          });\n          groupedObjects.forEach((objs) =&gt; {\n            this.canvas.add(new fabric.Group(objs));\n            this.groupCount += 1;\n          });\n        }) as unknown as (results: Object[], options) =&gt; void&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:563,&quot;character&quot;:32,&quot;text&quot;:&quot;objects&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:563,&quot;character&quot;:41,&quot;text&quot;:&quot;options&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:563,&quot;character&quot;:50,&quot;text&quot;:&quot;elements&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:564,&quot;character&quot;:14,&quot;text&quot;:&quot;groupedObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:565,&quot;character&quot;:10,&quot;text&quot;:&quot;objects&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:565,&quot;character&quot;:18,&quot;text&quot;:&quot;forEach&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:565,&quot;character&quot;:27,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:565,&quot;character&quot;:32,&quot;text&quot;:&quot;index&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:566,&quot;character&quot;:18,&quot;text&quot;:&quot;objId&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:566,&quot;character&quot;:26,&quot;text&quot;:&quot;elements&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:566,&quot;character&quot;:35,&quot;text&quot;:&quot;index&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:566,&quot;character&quot;:42,&quot;text&quot;:&quot;id&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:567,&quot;character&quot;:16,&quot;text&quot;:&quot;objId&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:568,&quot;character&quot;:14,&quot;text&quot;:&quot;groupedObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:573,&quot;character&quot;:16,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:573,&quot;character&quot;:20,&quot;text&quot;:&quot;get&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:574,&quot;character&quot;:37,&quot;text&quot;:&quot;elements&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:574,&quot;character&quot;:46,&quot;text&quot;:&quot;index&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:575,&quot;character&quot;:47,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:575,&quot;character&quot;:51,&quot;text&quot;:&quot;get&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:576,&quot;character&quot;:42,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:576,&quot;character&quot;:46,&quot;text&quot;:&quot;get&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:577,&quot;character&quot;:21,&quot;text&quot;:&quot;bgPicker&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:577,&quot;character&quot;:30,&quot;text&quot;:&quot;setOptions&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:578,&quot;character&quot;:18,&quot;text&quot;:&quot;color&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:578,&quot;character&quot;:25,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:578,&quot;character&quot;:29,&quot;text&quot;:&quot;get&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:580,&quot;character&quot;:25,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:580,&quot;character&quot;:29,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:581,&quot;character&quot;:36,&quot;text&quot;:&quot;elements&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:581,&quot;character&quot;:45,&quot;text&quot;:&quot;index&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:587,&quot;character&quot;:10,&quot;text&quot;:&quot;groupedObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:587,&quot;character&quot;:34,&quot;text&quot;:&quot;objs&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:591,&quot;character&quot;:45,&quot;text&quot;:&quot;options&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:664,&quot;character&quot;:9,&quot;text&quot;:&quot;fillPicker&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:664,&quot;character&quot;:20,&quot;text&quot;:&quot;setOptions&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:706,&quot;character&quot;:10,&quot;text&quot;:&quot;startPt&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:706,&quot;character&quot;:37,&quot;text&quot;:&quot;bboxPoints&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:708,&quot;character&quot;:23,&quot;text&quot;:&quot;bboxPoints&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:709,&quot;character&quot;:22,&quot;text&quot;:&quot;startPt&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:709,&quot;character&quot;:30,&quot;text&quot;:&quot;x&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:709,&quot;character&quot;:33,&quot;text&quot;:&quot;startPt&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:709,&quot;character&quot;:41,&quot;text&quot;:&quot;y&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:711,&quot;character&quot;:53,&quot;text&quot;:&quot;bboxPoints&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:723,&quot;character&quot;:21,&quot;text&quot;:&quot;lines&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:723,&quot;character&quot;:36,&quot;text&quot;:&quot;value&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:726,&quot;character&quot;:25,&quot;text&quot;:&quot;bboxPoints&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:727,&quot;character&quot;:23,&quot;text&quot;:&quot;shape&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:728,&quot;character&quot;:39,&quot;text&quot;:&quot;shape&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:738,&quot;character&quot;:21,&quot;text&quot;:&quot;bboxPoints&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:739,&quot;character&quot;:21,&quot;text&quot;:&quot;lines&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:743,&quot;character&quot;:31,&quot;text&quot;:&quot;options&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:744,&quot;character&quot;:39,&quot;text&quot;:&quot;options&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:744,&quot;character&quot;:47,&quot;text&quot;:&quot;e&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:873,&quot;character&quot;:12,&quot;text&quot;:&quot;path&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:874,&quot;character&quot;:8,&quot;text&quot;:&quot;&#x27;path&#x27; as keyof fabric.Object&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:942,&quot;character&quot;:26,&quot;text&quot;:&quot;arc as unknown as {id: string}&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:953,&quot;character&quot;:28,&quot;text&quot;:&quot;tri as unknown as {id: string}&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:976,&quot;character&quot;:8,&quot;text&quot;:&quot;pieSlices&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:990,&quot;character&quot;:6,&quot;text&quot;:&quot;pieSlices&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1000,&quot;character&quot;:12,&quot;text&quot;:&quot;pieSlice&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1000,&quot;character&quot;:23,&quot;text&quot;:&quot;pieSlices&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1001,&quot;character&quot;:8,&quot;text&quot;:&quot;pieSlices&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1001,&quot;character&quot;:31,&quot;text&quot;:&quot;pieSlice&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1068,&quot;character&quot;:22,&quot;text&quot;:&quot;objects&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1070,&quot;character&quot;:6,&quot;text&quot;:&quot;objects&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1070,&quot;character&quot;:14,&quot;text&quot;:&quot;forEach&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1070,&quot;character&quot;:23,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1071,&quot;character&quot;:8,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1071,&quot;character&quot;:12,&quot;text&quot;:&quot;set&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1074,&quot;character&quot;:8,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1074,&quot;character&quot;:12,&quot;text&quot;:&quot;toSVG&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1075,&quot;character&quot;:10,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1075,&quot;character&quot;:14,&quot;text&quot;:&quot;toSVG&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1075,&quot;character&quot;:21,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1075,&quot;character&quot;:25,&quot;text&quot;:&quot;type&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1075,&quot;character&quot;:31,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1075,&quot;character&quot;:35,&quot;text&quot;:&quot;id&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1080,&quot;character&quot;:6,&quot;text&quot;:&quot;objects&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1080,&quot;character&quot;:14,&quot;text&quot;:&quot;forEach&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1080,&quot;character&quot;:23,&quot;text&quot;:&quot;obj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1108,&quot;character&quot;:10,&quot;text&quot;:&quot;reader.result as string&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1109,&quot;character&quot;:21,&quot;text&quot;:&quot;reader.result as string&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1113,&quot;character&quot;:16,&quot;text&quot;:&quot;&lt;string&gt;(reader.result)&quot;,&quot;kind&quot;:4},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1150,&quot;character&quot;:24,&quot;text&quot;:&quot;object&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1151,&quot;character&quot;:13,&quot;text&quot;:&quot;objectUndoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1152,&quot;character&quot;:11,&quot;text&quot;:&quot;objectUndoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1154,&quot;character&quot;:9,&quot;text&quot;:&quot;objectUndoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1154,&quot;character&quot;:30,&quot;text&quot;:&quot;object&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1159,&quot;character&quot;:13,&quot;text&quot;:&quot;objectUndoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1160,&quot;character&quot;:10,&quot;text&quot;:&quot;undoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1160,&quot;character&quot;:25,&quot;text&quot;:&quot;objectUndoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1161,&quot;character&quot;:10,&quot;text&quot;:&quot;undoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1161,&quot;character&quot;:18,&quot;text&quot;:&quot;action&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1162,&quot;character&quot;:12,&quot;text&quot;:&quot;shape&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1162,&quot;character&quot;:25,&quot;text&quot;:&quot;canvasObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1165,&quot;character&quot;:13,&quot;text&quot;:&quot;objectRedoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1167,&quot;character&quot;:10,&quot;text&quot;:&quot;object&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1167,&quot;character&quot;:18,&quot;text&quot;:&quot;shape&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1171,&quot;character&quot;:13,&quot;text&quot;:&quot;objectRedoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1173,&quot;character&quot;:10,&quot;text&quot;:&quot;object&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1173,&quot;character&quot;:18,&quot;text&quot;:&quot;undoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1173,&quot;character&quot;:26,&quot;text&quot;:&quot;object&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1178,&quot;character&quot;:13,&quot;text&quot;:&quot;canvasObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1178,&quot;character&quot;:34,&quot;text&quot;:&quot;undoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1178,&quot;character&quot;:42,&quot;text&quot;:&quot;index&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1178,&quot;character&quot;:52,&quot;text&quot;:&quot;undoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1178,&quot;character&quot;:60,&quot;text&quot;:&quot;object&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1179,&quot;character&quot;:24,&quot;text&quot;:&quot;undoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1179,&quot;character&quot;:32,&quot;text&quot;:&quot;object&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1187,&quot;character&quot;:52,&quot;text&quot;:&quot;objectUndoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1192,&quot;character&quot;:13,&quot;text&quot;:&quot;objectRedoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1193,&quot;character&quot;:10,&quot;text&quot;:&quot;redoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1193,&quot;character&quot;:25,&quot;text&quot;:&quot;objectRedoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1194,&quot;character&quot;:25,&quot;text&quot;:&quot;redoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1195,&quot;character&quot;:10,&quot;text&quot;:&quot;redoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1195,&quot;character&quot;:18,&quot;text&quot;:&quot;action&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1199,&quot;character&quot;:24,&quot;text&quot;:&quot;redoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1199,&quot;character&quot;:32,&quot;text&quot;:&quot;object&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1201,&quot;character&quot;:12,&quot;text&quot;:&quot;shape&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1201,&quot;character&quot;:20,&quot;text&quot;:&quot;redoObj&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1201,&quot;character&quot;:28,&quot;text&quot;:&quot;object&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1202,&quot;character&quot;:25,&quot;text&quot;:&quot;canvasObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1202,&quot;character&quot;:47,&quot;text&quot;:&quot;shape&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1203,&quot;character&quot;:13,&quot;text&quot;:&quot;canvasObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1213,&quot;character&quot;:52,&quot;text&quot;:&quot;objectRedoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1218,&quot;character&quot;:21,&quot;text&quot;:&quot;canvasObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1225,&quot;character&quot;:11,&quot;text&quot;:&quot;objectRedoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1226,&quot;character&quot;:11,&quot;text&quot;:&quot;canvasObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1233,&quot;character&quot;:9,&quot;text&quot;:&quot;objectUndoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1234,&quot;character&quot;:9,&quot;text&quot;:&quot;objectRedoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1235,&quot;character&quot;:9,&quot;text&quot;:&quot;canvasObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1244,&quot;character&quot;:11,&quot;text&quot;:&quot;canvasObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1383,&quot;character&quot;:20,&quot;text&quot;:&quot;color&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1384,&quot;character&quot;:32,&quot;text&quot;:&quot;color&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1384,&quot;character&quot;:38,&quot;text&quot;:&quot;rgbaString&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1389,&quot;character&quot;:24,&quot;text&quot;:&quot;color&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1389,&quot;character&quot;:30,&quot;text&quot;:&quot;rgba&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1392,&quot;character&quot;:36,&quot;text&quot;:&quot;color&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1392,&quot;character&quot;:42,&quot;text&quot;:&quot;rgbaString&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1403,&quot;character&quot;:11,&quot;text&quot;:&quot;strokePicker&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1406,&quot;character&quot;:11,&quot;text&quot;:&quot;fillPicker&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1409,&quot;character&quot;:11,&quot;text&quot;:&quot;bgPicker&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1428,&quot;character&quot;:25,&quot;text&quot;:&quot;bboxPoints&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1442,&quot;character&quot;:27,&quot;text&quot;:&quot;lines&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1447,&quot;character&quot;:27,&quot;text&quot;:&quot;lines&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1447,&quot;character&quot;:67,&quot;text&quot;:&quot;set&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1453,&quot;character&quot;:25,&quot;text&quot;:&quot;lines&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1455,&quot;character&quot;:27,&quot;text&quot;:&quot;lines&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1463,&quot;character&quot;:25,&quot;text&quot;:&quot;lines&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1468,&quot;character&quot;:25,&quot;text&quot;:&quot;lines&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1468,&quot;character&quot;:65,&quot;text&quot;:&quot;set&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1481,&quot;character&quot;:20,&quot;text&quot;:&quot;this.getQuadraticBezierCurve() as unknown as {\n          path: number[][]}&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1506,&quot;character&quot;:15,&quot;text&quot;:&quot;canvasObjects&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1514,&quot;character&quot;:15,&quot;text&quot;:&quot;objectRedoStack&quot;,&quot;kind&quot;:2},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1545,&quot;character&quot;:13,&quot;text&quot;:&quot;fillPicker&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1545,&quot;character&quot;:24,&quot;text&quot;:&quot;setOptions&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1548,&quot;character&quot;:13,&quot;text&quot;:&quot;strokePicker&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1548,&quot;character&quot;:26,&quot;text&quot;:&quot;setOptions&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1561,&quot;character&quot;:22,&quot;text&quot;:&quot;&#x27;fontSize&#x27; as keyof fabric.Object&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1563,&quot;character&quot;:12,&quot;text&quot;:&quot;&#x27;fontFamily&#x27; as keyof fabric.Object&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1565,&quot;character&quot;:12,&quot;text&quot;:&quot;&#x27;fontStyle&#x27; as keyof fabric.Object&quot;,&quot;kind&quot;:3},{&quot;file&quot;:&quot;extensions/objects/templates/svg-filename-editor.component.ts&quot;,&quot;line&quot;:1567,&quot;character&quot;:12,&quot;text&quot;:&quot;&#x27;fontWeight&#x27; as keyof fabric.Object&quot;,&quot;kind&quot;:3}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 17 Jun 2021 20:43:56 GMT</p>
    </body>
  </html>
  