{% extends 'pages/base.html' %}

{% block maintitle %}
  Learner Dashboard - Oppia
{% endblock maintitle %}

{% block navbar_breadcrumb %}
  <ul class="nav navbar-nav oppia-navbar-breadcrumb">
    <li>
      <span class="oppia-navbar-breadcrumb-separator"></span>
      <span translate="I18N_TOPNAV_LEARNER_DASHBOARD"></span>
    </li>
  </ul>
{% endblock navbar_breadcrumb %}

{% block content %}
  <background-banner></background-banner>
  <div class="oppia-learner-dashboard-container" ng-controller="LearnerDashboard" style="position: relative;">
    <div>
      <h2 class="oppia-learner-dashboard-title"
          translate="I18N_TOPNAV_LEARNER_DASHBOARD"
          ng-class="{'oppia-learner-dashboard-title-mobile': checkMobileView()}">
      </h2>
    </div>

    <div class="oppia-dashboard-aggregated-stats oppia-learner-dashboard-main-content"
         style="padding-top: 10px; margin: auto;"
         ng-class="{'oppia-learner-dashboard-mobile-mode': checkMobileView()}"
         ng-if="!noActivity">
      <md-card layout="row"
               ng-style="checkMobileView() ? {'margin-bottom': '10px'} : {'margin-bottom': '40px'}">
        <div class="stats-card">
          <p class="stat-description">Completed Explorations</p>
          <h1 class="stat-value"><[completedExplorationsList.length]></h1>
        </div>
        <div class="stats-card">
          <p class="stat-description">Completed Collections</p>
          <h1 class="stat-value"><[completedCollectionsList.length]></h1>
        </div>
        <div class="stats-card">
          <p class="stat-description">Subscriptions</p>
          <h1 class="stat-value"><[subscriptionsList.length]></h1>
        </div>
      </md-card>
    </div>

    <div class="row"
         ng-style="checkMobileView() ? {'display': 'block'} : {'display': 'flex'}"
         style="display: flex;"
         ng-if="noActivity">
      <div class="col-sm-2">
        <div style="height: 100%;"></div>
        <img ng-src="<[getStaticImageUrl('/general/collection_mascot.svg')]>"
             ng-class="{'oppia-learner-dashboard-mascot-mobile': checkMobileView()}"
             class="oppia-learner-dashboard-mascot">
      </div>

      <div class="col-sm-8">
        <blockquote class="oppia-learner-dashboard-intro-card ">
          <p class="oppia-learner-dashboard-intro-card-message" style="padding-top: 6px;"
             translate="I18N_LEARNER_DASHBOARD_INTRO_MESSAGE_PART_ONE">
          </p>
          <p class="oppia-learner-dashboard-intro-card-message" style="padding-top: 9px;"
             translate="I18N_LEARNER_DASHBOARD_INTRO_MESSAGE_PART_TWO">
          </p>
          <a class="btn oppia-learner-dashboard-intro-button oppia-transition-200"
             translate="I18N_ACTION_BROWSE_LESSONS"
             ng-href="/library">
          </a>
        </blockquote>
      </div>

      <div class="col-sm-2">

      </div>
    </div>

    <div class="row"
         ng-style="checkMobileView() ? {'display': 'block'} : {'display': 'flex'}"
         ng-class="{'oppia-learner-dashboard-mobile-mode': checkMobileView()}"
         style="display: flex;"
         ng-if="!noActivity">
      <div class="col-sm-2 oppia-learner-dashboard-side-content"
           ng-class="{'oppia-learner-dashboard-mobile-mode': checkMobileView()}">
        <md-card class="oppia-learner-dashboard-main-menu">
          <h4 class="oppia-learner-dashboard-menu"
              ng-class="{'oppia-learner-dashboard-section-active': activeSection === 'In Progress'}"
              ng-click="setActiveSection('In Progress')">
            In Progress
            <span class="caret"></span>
          </h4>
          <div ng-show="activeSection === 'In Progress'" class="menu-sub-section">
            <div class="oppia-learner-dashboard-submenu"
                 ng-class="{'oppia-learner-dashboard-sub-section-active': activeSubSection === 'Explorations'}"
                 ng-click="setActiveSubSection('Explorations')"
                 translate="I18N_DASHBOARD_EXPLORATIONS">
            </div>
            <div class="oppia-learner-dashboard-submenu"
                 ng-class="{'oppia-learner-dashboard-sub-section-active': activeSubSection === 'Collections'}"
                 ng-click="setActiveSubSection('Collections')"
                 translate="I18N_DASHBOARD_COLLECTIONS">
            </div>
          </div>
          <h4 class="oppia-learner-dashboard-menu"
              ng-class="{'oppia-learner-dashboard-section-active': activeSection === 'Completed'}"
              ng-click="setActiveSection('Completed')">
            Completed
            <span class="caret"></span>
          </h4>
          <div ng-show="activeSection === 'Completed'" class="menu-sub-section">
            <div class="oppia-learner-dashboard-submenu"
                 ng-class="{'oppia-learner-dashboard-sub-section-active': activeSubSection === 'Explorations'}"
                 ng-click="setActiveSubSection('Explorations')"
                 translate="I18N_DASHBOARD_EXPLORATIONS">
            </div>
            <div class="oppia-learner-dashboard-submenu"
                 ng-class="{'oppia-learner-dashboard-sub-section-active': activeSubSection === 'Collections'}"
                 ng-click="setActiveSubSection('Collections')"
                 translate="I18N_DASHBOARD_COLLECTIONS">
            </div>
          </div>
          <h4 class="oppia-learner-dashboard-menu"
              ng-class="{'oppia-learner-dashboard-section-active': activeSection === 'Subscriptions'}"
              ng-click="setActiveSection('Subscriptions')">
            Subscriptions
          </h4>
        </md-card>
      </div>

      <div class="col-sm-8 oppia-learner-dashboard-main-content"
           ng-class="{'oppia-learner-dashboard-mobile-mode': checkMobileView()}">
        <div>
          <span class="oppia-learner-dashboard-main-content-title">
            <[activeSection]>
            <span ng-if="activeSection !== 'Subscriptions'">
              <span class="oppia-navbar-breadcrumb-separator"
                    style="margin: 0 1px;">
              </span>
              <[activeSubSection]>
            </span>
          </span>

          <span class="sort-explorations-select oppia-learner-dashboard-sort"
                ng-class="{'oppia-learner-dashboard-sort-mobile': checkMobileView()}"
                ng-if="activeSubSection === 'Explorations' && activeSection !== 'Subscriptions'">
            <p class="sort-by-text" style="margin-top: 0;">Sort By</p>
            <select ng-model="currentExpSortType"
                    class="sort-options"
                    style="margin-top: 0;"
                    ng-change="setExplorationsSortingOptions(currentExpSortType)"
                    ng-options="EXPLORATIONS_SORT_BY_KEYS[key] as value | translate for (key, value) in HUMAN_READABLE_EXPLORATIONS_SORT_BY_KEYS">
            </select>
            <span class="sort-order fa"
                  ng-click="setExplorationsSortingOptions(currentExpSortType)"
                  ng-class="isCurrentExpSortDescending ? 'fa-long-arrow-up': 'fa-long-arrow-down'">
            </span>
          </span>
        </div>
        <div style="padding-left: 11px;">
          <div ng-repeat="tile in incompleteExplorationsList | orderBy:currentExpSortType:isCurrentExpSortDescending track by tile.id"
               style="display: inline-block; margin-left: 1px;"
               ng-if="activeSection === 'In Progress' && activeSubSection === 'Explorations'"
               ng-mouseenter="showRemoveIcon=true" ng-mouseleave="showRemoveIcon=false">
            <img class="remove-icon"
                 ng-show="showRemoveIcon"
                 ng-src="<[getStaticImageUrl('/icons/remove.png')]>"
                 ng-click="openRemoveEntityModal(activeSection, activeSubSection, tile)"
                 tooltip="Remove"
                 tooltip-placement="top">
            <exploration-summary-tile
                                    exploration-id="tile.id"
                                    exploration-title="tile.title"
                                    last-updated-msec="tile.last_updated_msec"
                                    objective="tile.objective"
                                    category="tile.category"
                                    ratings="tile.ratings"
                                    num-views="tile.num_views"
                                    thumbnail-icon-url="tile.thumbnail_icon_url"
                                    thumbnail-bg-color="tile.thumbnail_bg_color"
                                    class="protractor-test-exp-summary-tile">
            </exploration-summary-tile>
          </div>

          <div ng-repeat="tile in completedExplorationsList | orderBy:currentExpSortType:isCurrentExpSortDescending track by tile.id"
              style="display: inline-block; margin-left: 1px;"
              ng-if="activeSection === 'Completed' && activeSubSection === 'Explorations'">
            <exploration-summary-tile
                                    exploration-id="tile.id"
                                    exploration-title="tile.title"
                                    last-updated-msec="tile.last_updated_msec"
                                    objective="tile.objective"
                                    category="tile.category"
                                    ratings="tile.ratings"
                                    num-views="tile.num_views"
                                    thumbnail-icon-url="tile.thumbnail_icon_url"
                                    thumbnail-bg-color="tile.thumbnail_bg_color"
                                    class="protractor-test-exp-summary-tile">
            </exploration-summary-tile>
          </div>

          <div ng-repeat="tile in incompleteCollectionsList"
              style="display: inline-block; margin-left: 1px;"
              ng-if="activeSection === 'In Progress' && activeSubSection === 'Collections'"
              ng-mouseenter="showRemoveIcon=true" ng-mouseleave="showRemoveIcon=false">
            <img class="remove-icon"
                 ng-show="showRemoveIcon"
                 ng-src="<[getStaticImageUrl('/icons/remove.png')]>"
                 ng-click="openRemoveEntityModal(activeSection, activeSubSection, tile)"
                 tooltip="Remove"
                 tooltip-placement="top">
            <collection-summary-tile
                                     collection-id="tile.id"
                                     collection-title="tile.title"
                                     last-updated-msec="tile.last_updated_msec"
                                     objective="tile.objective"
                                     node-count="tile.node_count"
                                     category="tile.category"
                                     thumbnail-icon-url="tile.thumbnail_icon_url"
                                     thumbnail-bg-color="tile.thumbnail_bg_color">
            </collection-summary-tile>
          </div>

          <div ng-repeat="tile in completedCollectionsList"
              style="display: inline-block; margin-left: 1px;"
              ng-if="activeSection === 'Completed' && activeSubSection === 'Collections'">
            <collection-summary-tile
                                     collection-id="tile.id"
                                     collection-title="tile.title"
                                     last-updated-msec="tile.last_updated_msec"
                                     objective="tile.objective"
                                     node-count="tile.node_count"
                                     category="tile.category"
                                     thumbnail-icon-url="tile.thumbnail_icon_url"
                                     thumbnail-bg-color="tile.thumbnail_bg_color">
            </collection-summary-tile>
          </div>

          <md-card class="oppia-subscription-card"
                   ng-if="activeSection === 'Subscriptions'"
                   ng-repeat="subscription in subscriptionsList"
                   style="margin: 0 8px 0 4px; width: 197px;">
            <a class="oppia-subscription-profile-link" href="/profile/<[subscription.creator_username]>" target="_blank">
              <img ng-src="<[subscription.creator_picture_data_url]>" class="oppia-subscription-card-profile-picture img-circle">
              <span class="oppia-subscription-card-summary" style="color: black;">
                <div style="margin-bottom: 5px; font-size: 17.5px;">
                  <strong class="protractor-test-subscription-name"
                          popover-append-to-body
                          popover-trigger="<[showUsernamePopover(subscription.creator_username)]>"
                          ng-attr-popover="<[subscription.creator_username]>">
                    <[subscription.creator_username| truncate:10]>
                  </strong>
                </div>
                <div style="font-size: 14.5px;">
                  <span>Impact</span>
                  <span><[subscription.creator_impact || 0]></span>
                </div>
              </span>
            </a>
          </md-card>
        </div>
      </div>

      <div class="col-sm-2 oppia-learner-dashboard-side-content"
           ng-class="{'oppia-learner-dashboard-mobile-mode': checkMobileView()}">

      </div>
    </div>
  </div>

  <script type="text/ng-template" id="modals/removeEntity">
    <div class="modal-header">
      <h3>Remove from '<[sectionName]>' list?</h3>
    </div>

    <div class="modal-body">
      <p>
        Are you sure you want to remove '<[entityTitle]>' from your '<[sectionName]>' list?
      </p>
    </div>

    <div class="modal-footer">
      <button class="btn btn-default" ng-click="cancel()">Cancel</button>
      <button class="btn btn-danger protractor-test-confirm-delete-interaction"
              ng-click="remove()">
        Remove
      </button>
    </div>
  </script>
{% endblock %}

{% block footer_js %}
  {{ super() }}
  <script src="{{TEMPLATE_DIR_PREFIX}}/components/background/BackgroundBannerDirective.js"></script>
  <script src="{{TEMPLATE_DIR_PREFIX}}/components/summary_tile/CollectionSummaryTileDirective.js"></script>
  <script src="{{TEMPLATE_DIR_PREFIX}}/components/summary_tile/ExplorationSummaryTileDirective.js"></script>
  <script src="{{TEMPLATE_DIR_PREFIX}}/components/RatingComputationService.js"></script>

  <script src="{{TEMPLATE_DIR_PREFIX}}/domain/learner_dashboard/LearnerDashboardBackendApiService.js"></script>
  <script src="{{TEMPLATE_DIR_PREFIX}}/pages/learner_dashboard/LearnerDashboard.js"></script>
{% endblock footer_js %}
