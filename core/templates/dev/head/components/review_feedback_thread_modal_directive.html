<div style="padding: 16px">
  <h3><[getTitle()]></h3>

  <div class="pull-right">
    <span ng-if="activeThread.stateName" class="label label-info">
      state: <[activeThread.stateName]>
    </span>
    <span ng-class="getLabelClass(activeThread.status)">
      <[getHumanReadableStatus(activeThread.status)]>
    </span>
  </div>
  <div style="clear: both"></div>

  <ul ng-if="activeThread.messages">
    <li ng-repeat="m in activeThread.messages|orderBy:'message_id'">
      <span ng-if="$index !== 0">#<[m.message_id]></span>

      <span ng-if="m.author_username">by <strong><[m.author_username]></strong></span>
      <span ng-if="!m.author_username">(anonymously submitted)</span>

      <span><[getLocaleAbbreviatedDatetimeString(m.created_on)]></span>

      <div><[m.text]></div>
      <span ng-if="m.message_id !== 0">
        <span ng-if="m.updated_status">
          <em>Status changed to '<[getHumanReadableStatus(m.updated_status)]>'</em>
        </span>
        <span ng-if="m.updated_subject">
          <em>Subject changed to '<[m.updated_subject]>'</em>
        </span>
      </span>

      <div ng-if="activeThread.isSuggestionThread() && $index == 0">
        <button class="btn btn-<[getSuggestionButtonType()]> protractor-test-view-suggestion-btn"
                ng-click="showSuggestionModal()">
          View Suggestion
        </button>
      </div>
    </li>
  </ul>

  <hr>

  <div ng-if="userIsLoggedIn">
    <label for="tmpMessageText">
      Add new message
      <span ng-if="EditabilityService.isEditable() && !activeThread.isSuggestionThread()">
        (and/or change status)
      </span>
    </label>
    <textarea class="form-control protractor-test-feedback-response-textarea"
              ng-model="tmpMessage.text" id="tmpMessageText" rows="6"
              ng-disabled="messageSendingInProgress">
    </textarea>

    <div ng-show="EditabilityService.isEditable() && !activeThread.isSuggestionThread()">
      Change status (optional):
      <select ng-model="tmpMessage.status"
        ng-options="choice.id as choice.text for choice in STATUS_CHOICES"
        ng-disabled="messageSendingInProgress">
      </select>
      <div ng-if="!tmpMessage.text && (tmpMessage.status === 'ignored' || tmpMessage.status === 'not_actionable')">
        <span class="material-icons">&#xE88F;</span>
        Please specify a reason for setting the status to "<[getHumanReadableStatus(tmpMessage.status)]>".
      </div>
    </div>

    <div class="text-right">
      <button class="btn btn-default protractor-test-oppia-feedback-response-send-btn"
              ng-click="close()" ng-disabled="messageSendingInProgress">
        Close
      </button>
      <button class="btn btn-success protractor-test-oppia-feedback-response-send-btn"
              ng-click="addNewMessage(activeThread.threadId, tmpMessage.text, tmpMessage.status)"
              ng-disabled="messageSendingInProgress || (!tmpMessage.text && activeThread.status === tmpMessage.status) || (!tmpMessage.text && (tmpMessage.status === 'ignored' || tmpMessage.status === 'not_actionable'))">
        <span ng-if="messageSendingInProgress">Sending...</span>
        <span ng-if="!messageSendingInProgress">Send</span>
      </button>
    </div>
  </div>
  <em ng-if="!userIsLoggedIn">To respond to a feedback thread, please log in.</em>
</div>
