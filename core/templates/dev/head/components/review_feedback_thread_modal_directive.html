<div style="padding: 32px">
  <h3 style="float: left; width: 85%; margin-top: 0"><[getTitle()]></h3>

  <div class="text-right" style="float: right; width: 15%">
    <span ng-if="activeThread.stateName" class="label label-info">
      state: <[activeThread.stateName]>
    </span>
    <span ng-class="getLabelClass(activeThread.status)">
      <[getHumanReadableStatus(activeThread.status)]>
    </span>
  </div>
</div>

<hr style="clear: both; margin: 1em 0 0.5em 0">

<ol ng-if="activeThread.messages" class="thread-messages" style="padding: 0 32px">
  <li ng-repeat="m in activeThread.messages | orderBy:'message_id'">
    <div style="float: left">
      <span ng-if="$index !== 0">#<[m.message_id]></span>
      <span ng-if="m.author_username">by <strong><[m.author_username]></strong></span>
      <span ng-if="!m.author_username">(anonymously submitted)</span>
    </div>

    <div class="text-right" style="float: right; margin-left: 2ch">
      <[getLocaleAbbreviatedDatetimeString(m.created_on)]>
    </div>

    <div ng-if="m.message_id !== 0" style="float: right; width: 28ch">
      <span ng-if="m.updated_status">
        <em>Status changed to '<[getHumanReadableStatus(m.updated_status)]>'</em>
      </span>
      <span ng-if="m.updated_subject">
        <em>Subject changed to '<[m.updated_subject]>'</em>
      </span>
    </div>

    <p style="clear: both; text-indent: 4ch"><[m.text]></p>

    <div ng-if="activeThread.isSuggestionThread() && $index == 0">
      <button ng-click="showSuggestionModal()"
              class="btn btn-<[getSuggestionButtonType()]> protractor-test-view-suggestion-btn">
        View Suggestion
      </button>
    </div>
  </li>
</ol>

<hr style="margin-top: 0">

<div ng-if="userIsLoggedIn" style="padding: 0 32px 32px 32px">
  <label for="tmpMessageText">
    Add new message
    <span ng-if="EditabilityService.isEditable() && !activeThread.isSuggestionThread()">
      (and/or change status)
    </span>
  </label>
  <textarea ng-model="tmpMessage.text" ng-disabled="messageSendingInProgress"
            class="form-control protractor-test-feedback-response-textarea"
            id="tmpMessageText" rows="6">
  </textarea>

  <div style="margin-top: 12px">
    <div ng-show="EditabilityService.isEditable() && !activeThread.isSuggestionThread()"
         style="float: left">
      Change status (optional):
      <select ng-model="tmpMessage.status"
              ng-options="choice.id as choice.text for choice in STATUS_CHOICES"
              ng-disabled="messageSendingInProgress"
              style="height: 34px; border-color: #ccc">
      </select>
      <div ng-if="!tmpMessage.text && (tmpMessage.status === 'ignored' || tmpMessage.status === 'not_actionable')"
           style="margin: 8px 0; color: red">
        <span style="font-size: 19px" class="material-icons">error_outline</span>
        Please specify a reason for setting the status to "<[getHumanReadableStatus(tmpMessage.status)]>".
      </div>
    </div>

    <div class="text-right" style="float: right">
      <button ng-click="close()" ng-if="activeThread.messages" ng-disabled="messageSendingInProgress"
              class="btn btn-default protractor-test-oppia-feedback-response-send-btn"
              style="margin-right: 0">
        Close
      </button>
      <button ng-click="addNewMessage(activeThread.threadId, tmpMessage.text, tmpMessage.status)"
              ng-disabled="messageSendingInProgress || (!tmpMessage.text && activeThread.status === tmpMessage.status) || (!tmpMessage.text && (tmpMessage.status === 'ignored' || tmpMessage.status === 'not_actionable'))"
              class="btn btn-success protractor-test-oppia-feedback-response-send-btn"
              style="margin-left: 8px">
        <span ng-if="messageSendingInProgress">Sending...</span>
        <span ng-if="!messageSendingInProgress">Send</span>
      </button>
    </div>

    <div style="clear: both"></div>

    <em ng-if="!userIsLoggedIn">To respond to a feedback thread, please log in.</em>
  </div>
</div>


<style>
  ol.thread-messages {
    list-style: none;
    margin: 0;
  }
  ol.thread-messages li {
    padding-top: 0.5em;
    padding-bottom: 1em;
    border-bottom: 1px solid #eee;
  }
  ol.thread-messages li:last-child {
    border-bottom: 0;
  }
  ol.thread-messages li:first-child {
    padding-top: 0;
  }
</style>
