{% extends "base.html" %}

{% block maintitle %}
  Oppia Editor
{% endblock maintitle %}

{% block subtitle %}
  {{ title }}
{% endblock subtitle %}

{% block header_js %}
  {{ super() }}
  <script type="text/javascript">
    GLOBALS.collectionId = JSON.parse('{{collection_id|js_string}}');
    GLOBALS.isPublic = JSON.parse('{{is_public|js_string}}');
    GLOBALS.canEdit = JSON.parse('{{can_edit|js_string}}');
  </script>

  <style>
    html, body {
      background-color: #eee;
    }
  </style>

  {{dependencies_html}}
{% endblock header_js %}

{% block navbar_breadcrumb %}
  <ul class="nav navbar-nav oppia-navbar-breadcrumb ng-cloak" ng-controller="CollectionEditorNavbarBreadcrumb">
    <li>
      <span class="oppia-navbar-breadcrumb-separator"></span>
      <span ng-if="collection">
        <[collection.getTitle()]>
        <span class="oppia-navbar-breadcrumb-separator" style="margin-left: 5px;"></span>
        <span>
          <[getCurrentTabName()]>
        </span>
      </span>
      <span ng-if="!collection">
        Loading...
      </span>
    </li>
  </ul>
{% endblock navbar_breadcrumb %}

{% block local_top_nav_options %}
  <ul class="nav navbar-nav oppia-navbar-nav navbar-right ng-cloak" ng-controller="CollectionEditorNavigation" style="margin-left: 20px;">
    <!-- Editor -->
    {% if SHOW_COLLECTION_NAVIGATION_TAB_MAIN %}
    <li ng-class="{'active': getTabStatuses().active === 'main', 'dropdown': countWarnings()}">
      <a href="#" tooltip="Editor" tooltip-placement="<[countWarnings() ? 'left' : 'bottom']>" ng-click="selectMainTab()" class="protractor-test-main-tab">
        <span class="glyphicon glyphicon-pencil"></span>
      </a>
    </li>
    {% endif %}

    <!-- Preview -->
    {% if SHOW_COLLECTION_NAVIGATION_TAB_PREVIEW %}
    {% if username %}
      <li id="tutorialPreviewTab" ng-class="{'active': getTabStatuses().active === 'preview'}">
        <a href="#" tooltip="Preview" tooltip-placement="bottom" ng-click="selectPreviewTab()" class="protractor-test-preview-tab">
          <span class="glyphicon glyphicon-play"></span>
        </a>
      </li>
    {% endif %}
    {% endif %}

    <!-- Settings -->
    {% if SHOW_COLLECTION_NAVIGATION_TAB_SETTINGS %}
    <li ng-class="{'active': getTabStatuses().active === 'settings'}">
      <a href="#" tooltip="Settings" tooltip-placement="bottom" ng-click="selectSettingsTab()" class="protractor-test-settings-tab">
        <span class="glyphicon glyphicon-cog"></span>
      </a>
    </li>
    {% endif %}

    <!-- History -->
    {% if SHOW_COLLECTION_NAVIGATION_TAB_HISTORY %}
    <li ng-class="{'active': getTabStatuses().active === 'history'}">
      <a href="#" tooltip="History" tooltip-placement="bottom" ng-click="selectHistoryTab()" disabled="explorationRightsService.isCloned()" class="protractor-test-history-tab">
        <span class="glyphicon glyphicon-time"></span>
      </a>
    </li>
    {% endif %}

    <!-- Feedback -->
    {% if SHOW_COLLECTION_NAVIGATION_TAB_FEEDBACK %}
    <li ng-class="{'active': getTabStatuses().active === 'feedback'}">
      <a href="#" tooltip="Feedback" tooltip-placement="bottom" ng-click="selectFeedbackTab()">
        <span class="glyphicon glyphicon-comment"></span>
      </a>
    </li>
    {% endif %}

    <!-- Stats -->
    {% if SHOW_COLLECTION_NAVIGATION_TAB_STATS %}
    {% if username %}
      <li ng-class="{'active': getTabStatuses().active === 'stats'}">
        <a href="#" tooltip="Statistics" tooltip-placement="bottom" ng-click="selectStatsTab()">
          <span class="glyphicon glyphicon-stats"></span>
        </a>
      </li>
    {% endif %}
    {% endif %}

    <!-- Help -->
    {% if SHOW_COLLECTION_NAVIGATION_TAB_HELP %}
    {% if username %}
      <li class="dropdown" popover-is-open="tutorialHelpPopoverIsShown"
          popover-placement="bottom" popover-trigger="none"
          popover="To get help in the future, click here!">
        <a href="#" tooltip="Help" tooltip-placement="bottom">
          <span class="glyphicon glyphicon-question-sign"></span>
        </a>
      </li>
    {% endif %}
    {% endif %}
  </ul>
{% endblock local_top_nav_options %}

{% block content %}
  <div ng-controller="CollectionEditor">
    <div ng-if="collection">
      <!-- Collection details -->
      <collection-details-editor-directive collection="collection">
      </collection-details-editor-directive>
      <a ng-href="/collection/<[collection.getId()]>" target="_blank">Go to Collection</a>

      <!-- List of acquired and pre-requisite skills -->
      <br>
      <br>
      <strong>Skills</strong>
      <collection-skill-list-directive collection-skill-list="collectionSkillList">
      </collection-skill-list-directive>

      <!-- List of explorations -->
      <br>
      <strong>Explorations</strong>
      <ul>
        <li ng-repeat="node in collection.getBindableCollectionNodes()">
          <collection-node-editor-directive collection="collection" collection-node="node" update-skill-list="updateSkillList()">
          </collection-node-editor-directive>
        </li>
      </ul>

      <!-- Collection changes to be commited -->
      <h3><span ng-if="getChangeListCount() > 0"> <em>(<[getChangeListCount()]> changes pending)</em></h3>
      <br>
      <input ng-model="commitMessage" type="text" placeholder="Commit Message"><button ng-click="saveCollection(commitMessage)">Save Collection</button>
      <button ng-click="publishCollection()" ng-if="!isPublic">Publish Collection</button>
    </div>
  </div>

  {% include 'collection_editor/collection_details_editor_directive.html' %}
  {% include 'collection_editor/collection_node_editor_directive.html' %}
  {% include 'collection_editor/collection_skill_list_directive.html' %}
{% endblock content %}

{% block footer_js %}
  {{ super() }}
  <script>
    {{ include_js_file('collection_editor/CollectionEditor.js') }}
    {{ include_js_file('collection_editor/CollectionDetailsEditorDirective.js') }}
    {{ include_js_file('collection_editor/CollectionNodeEditorDirective.js') }}
    {{ include_js_file('collection_editor/CollectionSkillListDirective.js') }}
    {{ include_js_file('domain/collection/CollectionBackendApiService.js') }}
    {{ include_js_file('domain/collection/CollectionNodeObjectFactory.js') }}
    {{ include_js_file('domain/collection/CollectionObjectFactory.js') }}
    {{ include_js_file('domain/collection/CollectionRightsBackendApiService.js') }}
    {{ include_js_file('domain/collection/CollectionUpdateService.js') }}
    {{ include_js_file('domain/collection/SkillListObjectFactory.js') }}
    {{ include_js_file('domain/collection/WritableCollectionBackendApiService.js') }}
    {{ include_js_file('domain/editor/ChangeObjectFactory.js') }}
    {{ include_js_file('domain/editor/UndoRedoService.js') }}
    {{ include_js_file('domain/utilities/UrlInterpolationService.js') }}
    {{ include_js_file('editor/ExplorationEditor.js') }}
    {{ include_js_file('editor/EditorServices.js') }}
    {{ include_js_file('editor/GadgetValidationService.js') }}
    {{ include_js_file('editor/RouterServices.js') }}
    {{ include_js_file('expressions/expressionInterpolationService.js') }}
  </script>
{% endblock footer_js %}
