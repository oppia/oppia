<div class="oppia-story-viewer-container">
  <div ng-if="$ctrl.storyIsLoaded">
    <div style="padding-top: 40px;">
      <background-banner></background-banner>
      <div ng-if="$ctrl.storyPlaythroughObject" class="oppia-story-player-tiles-container">
        <div class="oppia-page-heading oppia-story-title" style="text-align: left; padding-left: 60px; margin-top: 20px; margin-bottom: 0;">
          <[$ctrl.storyTitle]>
        </div>
        <div class="oppia-story-description" style="text-align: left; padding-left: 60px; padding-bottom: 4vh;">
          <[$ctrl.storyDescription]>
        </div>

        <div ng-if="$ctrl.showChapters()" class="d-md-block">
          <a ng-repeat="node in $ctrl.storyPlaythroughObject.getStoryNodes();"
             ng-href="<[$ctrl.getExplorationUrl(node)]>">

            <div>
              <div ng-style="($index > 0 && !$ctrl.storyPlaythroughObject.getStoryNodes()[$index-1].isCompleted() && {'opacity': '0.5', 'display': 'flex'}) || { 'display': 'flex' }">
                <svg  ng-if="!$last" 
                      width="130px"
                      height="300px"
                      ng-style="height: 300px;"
                      class="hide-lesson-track"
                      xmlns="http://www.w3.org/1600/svg">
                  <path fill="none"
                        ng-attr-stroke="{{node.isCompleted() && '#296E5F' || 'rgb(204, 204, 204)' }}"
                        stroke-dasharray="30,16"
                        stroke-linecap="round"
                        stroke-width="10"
                        d="M70 30 L70 300"/>
                </svg>
                <div ng-if="$last" style="width: 150px;" class="hide-lesson-track" />

                <img ng-if="node.isCompleted()" ng-src="<[$ctrl.getStaticImageUrl('/general/collection_paw.svg')]>" class="lesson-icon-completed hide-lesson-track">
                <div ng-if="!node.isCompleted()" class="lesson-icon-uncompleted hide-lesson-track" />

                <div ng-style="{color: 'rgb(51, 51, 51)','font-family': 'Capriola, Roboto, Arial,sans-serif', 'margin-right': '40px', 'flex': '1', 'margin-left': '20px'}">
                  <p style="font-size: 30px; padding-top: 6px;" ng-if="!node.isCompleted()" aria-live="assertive">
                    Chapter {{$index + 1}}: <[node.getTitle()]>
                  </p>
                  <p ng-if="node.isCompleted()" ng-style="font-size: 16px;" aria-live="assertive" translate="I18N_STORY_VIEWER_COMPLETED_CHAPTER" translate-values="{title: node.getTitle()}" />

                  <div style="display: flex; margin-top: 16px; flex-wrap: wrap;">
                    <svg  width="240"
                          height="180"
                          xmlns="http://www.w3.org/1600/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink"
                          version="1.1"
                          style="position:relative; margin-right: 10px; margin-bottom: 10px;">
                      <defs>
                        <pattern id="image<[$index]>" patternUnits="userSpaceOnUse" height="160" width="240">
                          <rect width="240"
                                height="180"
                                ng-attr-fill="<[$ctrl.pathIconParameters[$index].thumbnailBgColor]>"/>
                          
                          <image  ng-if="!node.isCompleted()"
                                  x="0"
                                  y="0"
                                  height="180"
                                  width="240"
                                  ng-attr-xlink:href="<[$ctrl.getStaticImageUrl($ctrl.pathIconParameters[$index].thumbnailIconUrl)]>"
                                  xlink:href="">
                          </image>
                        </pattern>
                      </defs>
                      <a xlink:href="<[$ctrl.getExplorationUrl(node)]>">
                        <circle ng-show="$ctrl.node.getExplorationId() === $ctrl.nextExplorationId &&
                          $index !== $ctrl.activeHighlightedIconIndex"
                                cx="50"
                                cy="70"
                                r="50"
                                id="<['highlight' + $index]>"
                                fill="#FF8C00"
                                fill-opacity="0.5"/>
                        <rect width="240"
                              height="180"
                              fill="url(#image<[$index]>)"
                              rx="8"
                        />
                      </a>
                    </svg>

                    <div style="min-width: 200px; max-height: 180px; overflow-y: scroll; display: flex; flex: 1; padding: 20px; border: rgb(248, 248, 248) 4px solid; border-radius: 8px; margin-bottom: 20px;">
                      <p><[node.getDescription()]></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>
    <attribution-guide></attribution-guide>
  </div>
</div>
<style>
  .oppia-story-node-small-screen {
    left: 50%;
    position: absolute;
    text-align: center;
    transform: translate(-50%, 170px);
    z-index: 1;
  }
  .oppia-story-node-small-screen::before {
    color: #3f7a68;
    content: attr(title-data);
    font-family: "Capriola", "Roboto", Arial, sans-serif;
    font-size: 16px;
    left: -60px;
    position: absolute;
    text-align: center;
    top: -30px;
    width: 220px;
  }
  .oppia-story-node-default-cursor {
    cursor: default;
  }
</style>
