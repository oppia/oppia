<oppia-loading-message [message]="loadingMessage"></oppia-loading-message>
<mat-card class="oppia-page-card oppia-long-text oppia-long-text-card">
  <h3>Topic Similarities</h3>
  <div class="oppia-topic-similarities-container">
    Upload a csv file:<br>
    The first line of data should be a list of topic names. The next lines should be a symmetric adjacency matrix of similarities, which are values between 0 and 1.<br>
    <input type="file" id="topicSimilaritiesFile">
    <button (click)="uploadTopicSimilaritiesFile()">Upload</button>
    <button (click)="downloadTopicSimilaritiesFile()">Download current topic similarities</button>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Search Index</h3>
  <button (click)="clearSearchIndex()">Clear Search Index</button>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Extract Data</h3>
  <div class="oppia-query-form">
    <form class="form" (submit)="submitQuery()">
      <div class="form-group row">
        <label>Exploration ID:</label>
        <input type="text"
               [(ngModel)]="expId"
               [ngModelOptions]="{standalone: true}"
               required="true">
      </div>
      <div class="form-group row">
        <label>Exploration version:</label>
        <input type="number"
               min="0"
               [(ngModel)]="expVersion"
               [ngModelOptions]="{standalone: true}"
               required="true">
      </div>
      <div class="form-group row">
        <label>State name:</label>
        <input type="text"
               [(ngModel)]="stateName"
               [ngModelOptions]="{standalone: true}"
               required="true">
      </div>
      <div class="form-group row">
        <label>Number of answers:</label>
        <input type="number"
               min="0"
               [(ngModel)]="numAnswers"
               [ngModelOptions]="{standalone: true}"
               required="true">
      </div>
      <div class="form-group row">
        <input type="submit" value="submit query">
        <input type="reset" value="reset">
      </div>
    </form>
    <p> (To get all answers set number of answers to 0) </p>
    <p *ngIf="showDataExtractionQueryStatus">Status: {{ dataExtractionQueryStatusMessage }}</p>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Regenerate contribution opportunities for a topic:</h3>
  <div class="oppia-query-form">
    <form class="form" (submit)="regenerateOpportunitiesRelatedToTopic()">
      <div class="form-group row">
        <label>Topic ID:</label>
        <input type="text"
               [(ngModel)]="topicIdForRegeneratingOpportunities"
               [ngModelOptions]="{standalone: true}"
               class="e2e-test-topic-id-input"
               required="true">
      </div>
      <div class="form-group row">
        <input type="submit" value="Regenerate" class="e2e-test-regenerate-opportunities-button">
        <input type="reset" value="reset">
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Regenerate topic summaries:</h3>
  <p>
    Creates new topic summaries to replace the old topic summaries with.
  </p>
  <div class="oppia-query-form">
    <form class="form" (submit)="regenerateTopicSummaries()">
      <div class="form-group row">
        <input type="submit" value="Regenerate" class="e2e-test-regenerate-topic-summaries-button">
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Rollback exploration to latest known safe state:</h3>
  <em>
    Here, a "safe state" refers to the latest version of the exploration for
    which both snapshot content and snapshot metadata models also exist.
  </em>
  <div class="oppia-query-form">
    <form class="form" (submit)="rollbackExploration()">
      <div class="form-group row">
        <label>Exploration ID:</label>
        <input type="text"
               [(ngModel)]="expIdToRollback"
               [ngModelOptions]="{standalone: true}"
               class="e2e-test-exploration-id-input"
               required="true">
      </div>
      <div class="form-group row">
        <input type="submit" value="Rollback Exploration" class="e2e-test-rollback-exploration-button">
        <input type="reset" value="reset">
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Send a Test Mail to Admin</h3>
  <div class="oppia-query-form">
    <form class="form" (submit)="sendDummyMailToAdmin()">
      <div class="form-group row">
        <input type="submit" value="Send" class="e2e-test-send-test-mail-button">
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Update username</h3>
  <div class="oppia-query-form">
    <form class="form" (submit)="updateUsername()">
      <div class="form-group row">
        <label>Old username:</label>
        <input type="text"
               [(ngModel)]="oldUsername"
               [ngModelOptions]="{standalone: true}"
               class="e2e-test-old-username-input"
               required="true">
      </div>
      <div class="form-group row">
        <label>New username:</label>
        <input type="text"
               [(ngModel)]="newUsername"
               [ngModelOptions]="{standalone: true}"
               required="true"
               class="e2e-test-new-username-input"
               [maxlength]="MAX_USERNAME_LENGTH">
      </div>
      <div class="form-group row">
        <input type="submit" value="Update" class="e2e-test-update-username-button">
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Number of pending deletion requests</h3>
  <div class="oppia-query-form">
    <form class="form"
          (submit)="getNumberOfPendingDeletionRequestModels()">
      <div class="form-group row">
        <input type="submit"
               value="Get number of users whose deletion is currently in-progress"
               class="e2e-test-get-deletion-request-button">
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Get models related to a user</h3>
  <div class="oppia-query-form">
    <form class="form" (submit)="getModelsRelatedToUser()">
      <div class="form-group row">
        <label>User ID:</label>
        <input type="text"
               [(ngModel)]="userIdToGet"
               [ngModelOptions]="{standalone: true}"
               required="true">
      </div>
      <div class="form-group row">
        <input type="submit" value="Get">
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Delete user</h3>
  <div class="oppia-query-form">
    <form class="form" (submit)="deleteUser()">
      <div class="form-group row">
        <label>User ID:</label>
        <input type="text"
               [(ngModel)]="userIdToDelete"
               [ngModelOptions]="{standalone: true}"
               required="true">
      </div>
      <div class="form-group row">
        <label>Username:</label>
        <input type="text"
               [(ngModel)]="usernameToDelete"
               [ngModelOptions]="{standalone: true}"
               required="true">
      </div>
      <div class="form-group row">
        <input type="submit" value="Delete">
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Grant super admin privileges to Firebase account</h3>
  <p>The chosen user will be forcibly logged out.</p>
  <p>This operation is idempotent.</p>
  <div class="oppia-query-form">
    <form class="form" (submit)="grantSuperAdminPrivileges()">
      <div class="form-group row">
        <label>Username:</label>
        <input type="text"
               [(ngModel)]="usernameToGrant"
               [ngModelOptions]="{standalone: true}"
               class="e2e-test-username-to-grant-input"
               required="true">
      </div>
      <div class="form-group row">
        <input type="submit" value="Grant" class="e2e-test-grant-super-admin-button">
      </div>
    </form>
  </div>
</mat-card>


<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Update Blog Post Data</h3>
  <div class="oppia-query-form">
    <form class="form" (submit)="updateBlogPostData()">
      <div class="form-group row">
        <label>Blog Post Id:</label>
        <input type="text"
               [(ngModel)]="blogPostId"
               [ngModelOptions]="{standalone: true}"
               class="e2e-test-blog-id-input"
               required="true">
      </div>
      <div class="form-group row">
        <label>Author Username:</label>
        <input type="text"
               [(ngModel)]="authorUsername"
               [ngModelOptions]="{standalone: true}"
               class="e2e-test-blog-author-name-input"
               required="true">
      </div>
      <div class="form-group row">
        <label>Published On:</label>
        <input type="text"
               [(ngModel)]="publishedOn"
               [ngModelOptions]="{standalone: true}"
               required="true"
               class="e2e-test-blog-published-on-input"
               placeholder="Enter in mm/dd/yyyy">
      </div>
      <div class="form-group row">
        <input type="submit" value="Update" class="e2e-test-update-blog-post-button">
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Revoke super admin privileges from Firebase account</h3>
  <p>The chosen user will be forcibly logged out.</p>
  <p>This operation is idempotent.</p>
  <div class="oppia-query-form">
    <form class="form" (submit)="revokeSuperAdminPrivileges()">
      <div class="form-group row">
        <label>Username:</label>
        <input type="text"
               [(ngModel)]="usernameToRevoke"
               [ngModelOptions]="{standalone: true}"
               class="e2e-test-username-to-revoke-input"
               required="true">
      </div>
      <div class="form-group row">
        <input type="submit" value="Revoke" class="e2e-test-revoke-super-admin-button">
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Lookup exploration interactions</h3>
  <div class="oppia-query-form">
    <form class="form" (submit)="retrieveExplorationInteractionIds()">
      <div class="form-group row">
        <label>Exploration ID:</label>
        <input type="text"
               [(ngModel)]="expIdToGetInteractionIdsFor"
               [ngModelOptions]="{standalone: true}"
               class="e2e-test-exploration-id-to-get-interactions-input"
               required="true">
      </div>
      <div class="form-group row">
        <input type="submit" value="Get" class="e2e-test-get-interactions-button">
      </div>
    </form>
  </div>

  <div>
    <p *ngIf="explorationInteractionIds.length > 0">Interaction IDs:</p>
    <ul>
      <li *ngFor="let interactionId of explorationInteractionIds" [innerHTML]="interactionId"></li>
    </ul>
  </div>
</mat-card>

<mat-card class="oppia-admin-page-card oppia-page-card oppia-long-text">
  <h3>Update UserGroups</h3>
  <div>
    <div *ngFor="let userGroup of userGroups">
      <div *ngIf="!(userGroupInEditMode && userGroupIdsToDetailsShowRecord[userGroup.userGroupName])"
           class="oppia-user-group"
           (click)="toggleUserGroupDetailsSection(userGroup.userGroupName)">
        {{ oldUserGroupNameToNewUserGroupNameRecord[userGroup.userGroupName] }}
      </div>
      <div *ngIf="userGroupInEditMode && userGroupIdsToDetailsShowRecord[userGroup.userGroupName]"
           class="oppia-user-group">
        <input placeholder="{{ oldUserGroupNameToNewUserGroupNameRecord[userGroup.userGroupName] }}"
               type="text"
               value="{{ oldUserGroupNameToNewUserGroupNameRecord[userGroup.userGroupName] }}"
               [(ngModel)]="oldUserGroupNameToNewUserGroupNameRecord[userGroup.userGroupName]">
        <button mat-button matSuffix mat-icon-button
                aria-label="Clear"
                (click)="deleteUserGroup(userGroup.userGroupName); $event.stopPropagation()">
          <mat-icon matListIcon>close</mat-icon>
        </button>
      </div>
      <div class="user-group-details" *ngIf="userGroupIdsToDetailsShowRecord[userGroup.userGroupName]">
        <div *ngIf="!userGroupInEditMode">
          <i class="material-icons oppia-edit-icon"
             title="Edit User Group"
             (click)="setUserGroupInEditMode()">
            &#xE254;
          </i>
        </div>
        <div class="row">
          <div class="col-2">Users:</div>
          <div class="col-10">
            <div *ngIf="!userGroupInEditMode">
              <span *ngIf="userGroup.users.length == 0">
                <em>No users, click on edit button to add.</em>
              </span>
              <mat-chip-list #chipList aria-label="Users Associated With The User Group" tabindex="0">
                <mat-chip *ngFor="let user of userGroup.users"
                          [selectable]="false"
                          [removable]="false">
                  <ng-container>
                    <span tabindex="0" [attr.aria-label]="user+', selected'">{{ user }}</span>
                  </ng-container>
                </mat-chip>
              </mat-chip-list>
            </div>
            <div *ngIf="userGroupInEditMode">
              <mat-chip-list #chipList aria-label="Users Associated With The User Group" tabindex="0">
                <mat-chip *ngFor="let user of userGroup.users"
                          [selectable]="true"
                          [removable]="true"
                          (removed)="removeUserFromUserGroup(userGroup, user)">
                  <ng-container>
                    <span tabindex="0" [attr.aria-label]="user+', selected'">{{ user }}</span>
                  </ng-container>
                  <button class="oppia-cancel-button" role="button" tabindex="0" matChipRemove aria-label=". Remove">
                    <mat-icon class="oppia-cancel-button-text">cancel</mat-icon>
                  </button>
                </mat-chip>
                <input placeholder="Add Username"
                       #userInputToAddUserToGroup
                       [matChipInputFor]="chipList"
                       [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                       (matChipInputTokenEnd)="addUserToUserGroup($event, userGroup)"
                       (input)="onUserGroupUserInputChange()">
              </mat-chip-list>
              <p *ngIf="userInUserGroupValidationError.length > 0"
                 class="oppia-warning-text">
                {{ userInUserGroupValidationError }}
              </p>
              <p *ngIf="userGroupSaveError.length > 0"
                 class="oppia-warning-text">
                {{ userGroupSaveError }}
              </p>
            </div>
          </div>
        </div>
        <hr *ngIf="userGroupInEditMode">
        <div *ngIf="userGroupInEditMode" class="row justify-content-end">
          <div class="col-auto">
            <button class="btn btn-success save-user-group-btn"
                    (click)="updateUserGroup(userGroup, oldUserGroupNameToNewUserGroupNameRecord[userGroup.userGroupName])">
              Save
            </button>
          </div>
          <div class="col-auto">
            <button class="btn btn-secondary cancel-user-group-changes"
                    (click)="resetUserGroup(userGroup, oldUserGroupNameToNewUserGroupNameRecord[userGroup.userGroupName])">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="oppia-add-user-group">
    <input placeholder="New UserGroup Name"
           type="text"
           [(ngModel)]="newUserGroupName"
           [ngModelOptions]="{standalone: true}"
           (ngModelChange)="onUserGroupInputChange()">
    <button class="btn oppia-add-new-user-group-btn"
            (click)="addUserGroup()"
            [disabled]="userGroupInEditMode">
      + Add New UserGroup
    </button>
    <p *ngIf="userGroupValidationError.length > 0"
       class="oppia-warning-text">
      {{ userGroupValidationError }}
    </p>
  </div>
</mat-card>

<style>
  /* .cancel-user-group-changes, .save-user-group-btn {
    margin-right: 5px;
    margin-top: 5px;
  } */
  .oppia-add-new-user-group-btn {
    background-color: #00645c;
    color: #fff;
    font-family: "Capriola", "Roboto", Arial, sans-serif;
    font-size: 12px;
    margin-left: 10px;
  }
   .oppia-add-user-group {
    margin-top: 30px;
   }
  .oppia-edit-icon {
    cursor: pointer;
    font-size: 16px;
    position: absolute;
    right: 10%;
    -webkit-transition: all 200ms;
    transition: all 200ms;
  }
  .oppia-warning-text {
    color: #f00;
    font-size: 0.8em;
    width: 500px
  }
  .oppia-user-group {
    align-items: center;
    background: #e0f2f1;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    margin: 10px 20px;
    padding: 10px;
    width: 94%;
  }
  /* .oppia-add-user-group {
    margin: 10px 20px;
    padding: 10px;
  } */
  .user-group-details {
    margin: 10px 20px;
    padding: 0 15px;
  }
  .oppia-admin-page-card {
    max-width: 700px
  }
  .oppia-admin-page-card > button {
    max-width: 30%;
  }
  .oppia-admin-page-card.oppia-long-text p {
    margin: 0 0 1em 0;
  }
  .oppia-admin-page-card .oppia-query-form .form-group {
    margin-left: 0;
  }
  .oppia-admin-page-card .oppia-query-form label {
    font-weight: normal;
    width: 30%;
  }
  .oppia-topic-similarities-container > input,
  .oppia-topic-similarities-container > button {
    display: block;
    margin: 5px 0 5px 0;
  }
  .oppia-long-text-card {
    max-width: 700px;
  }
  .oppia-admin-page-ele-margin {
    margin-bottom: 10px;
    margin-right: 10px;
  }

  .oppia-page-card.mat-card {
    margin-top: 40px;
    padding: 30px 55px 30px 45px;
  }
</style>
